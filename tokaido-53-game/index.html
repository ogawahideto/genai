<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êù±Êµ∑ÈÅì‰∫îÂçÅ‰∏âÊ¨°„Åô„Åî„Çç„Åè„Ç≤„Éº„É†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }

        .game-container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            color: #333;
        }

        .game-title {
            text-align: center;
            font-size: 2.8em;
            color: #8B0000;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .game-subtitle {
            text-align: center;
            font-size: 1.3em;
            color: #8B4513;
            margin-bottom: 30px;
            font-style: italic;
        }

        .game-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-card {
            background: linear-gradient(45deg, #fff8dc, #f0e68c);
            border: 2px solid #DAA520;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .info-card h3 {
            color: #8B4513;
            font-size: 1.1em;
            margin-bottom: 8px;
        }

        .info-card .value {
            font-size: 1.8em;
            font-weight: bold;
            color: #8B0000;
        }

        .game-board {
            background: linear-gradient(45deg, #f5f5dc, #fffacd);
            border: 3px solid #8B4513;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            position: relative;
        }

        .stations-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .station {
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 12px;
            padding: 8px 4px;
            text-align: center;
            font-size: 0.85em;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .station:hover {
            background: #fffacd;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .station.current {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            border-color: #FF8C00;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            transform: scale(1.1);
        }

        .station.visited {
            background: linear-gradient(45deg, #90EE90, #98FB98);
            border-color: #228B22;
        }

        .station.event-station::after {
            content: 'üé™';
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 1.2em;
        }
        
        .station.market-station::before {
            content: 'üí∞';
            position: absolute;
            bottom: 2px;
            left: 2px;
            font-size: 1.2em;
        }

        .station-number {
            font-size: 0.7em;
            color: #666;
            margin-bottom: 2px;
        }

        .station-name {
            font-weight: bold;
            color: #333;
            font-size: 0.9em;
        }

        .player-token {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #FF4500;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .dice-area {
            text-align: center;
            margin: 30px 0;
            padding: 25px;
            background: linear-gradient(45deg, #f0f8ff, #e6f3ff);
            border-radius: 15px;
            border: 2px solid #4169E1;
        }

        .dice {
            font-size: 4em;
            margin: 15px;
            padding: 20px;
            background: white;
            border: 3px solid #333;
            border-radius: 15px;
            display: inline-block;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .dice.rolling {
            animation: roll 0.5s ease-in-out;
        }

        @keyframes roll {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(90deg); }
            50% { transform: rotate(180deg); }
            75% { transform: rotate(270deg); }
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .btn:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .btn-primary {
            background: linear-gradient(45deg, #8B4513, #A0522D);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(45deg, #654321, #8B4513);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #DAA520, #FFD700);
            color: #8B4513;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary:hover:not(:disabled) {
            background: linear-gradient(45deg, #B8860B, #DAA520);
            transform: translateY(-2px);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999;
            display: none;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            border: 4px solid #8B4513;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }

        .modal-content h3 {
            color: #8B0000;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .modal-content p {
            color: #333;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        #modal-choices {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .shop-item, .inventory-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .item-info {
            text-align: left;
        }


        .progress-bar {
            background: #ddd;
            border-radius: 10px;
            padding: 3px;
            margin: 20px 0;
        }

        .progress-fill {
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            height: 20px;
            border-radius: 8px;
            transition: width 1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9em;
            font-weight: bold;
        }

        .rules-section {
            background: linear-gradient(45deg, #f9f5dc, #fff8dc);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            border-left: 5px solid #8B4513;
        }

        .rules-section h3 {
            color: #8B4513;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .rules-section ul {
            margin-left: 20px;
            color: #654321;
        }

        .rules-section li {
            margin-bottom: 8px;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .game-title {
                font-size: 2.2em;
            }
            
            .stations-grid {
                grid-template-columns: repeat(6, 1fr);
                gap: 6px;
            }
            
            .station {
                font-size: 0.75em;
                min-height: 50px;
                padding: 6px 2px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <!--
    AI Model: Gemini
    User Prompt: tokaido-53-game„Çí„ÇÇ„Å£„Å®Èù¢ÁôΩ„Åè„Åó„Å¶„Åè„Å†„Åï„ÅÑ (A&C), Êàª„Å£„Å¶„Åó„Åæ„ÅÜ„Ç§„Éô„É≥„Éà„ÇÇÂä†„Åà„Å¶„Åè„Å†„Åï„ÅÑ, ÂÆøÂ†¥„ÅÆÁâπÂæ¥„ÇíÊ¥ª„Åã„Åó„ÅüË®≠ÂÆö„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ
    AI Approach: Êó¢Â≠ò„ÅÆ„Åô„Åî„Çç„Åè„Ç≤„Éº„É†„Å´„ÄÅÊ°àA„Äå„Ç¢„Ç§„ÉÜ„É†Â±ã„Å®„Äé‰Ωø„ÅÜ„Äè„Ç¢„Ç§„ÉÜ„É†„ÅÆÂ∞éÂÖ•„Äç„Å®Ê°àC„ÄåÂÆøÂ†¥„Åî„Å®„ÅÆ„É¶„Éã„Éº„ÇØ„Ç§„Éô„É≥„Éà„Äç„ÇíÂÆüË£Ö„ÄÇ„Åï„Çâ„Å´„ÄÅÂÆøÂ†¥„ÅÆÁâπÂæ¥„Å´Âêà„Çè„Åõ„Åü„ÄåÂæåÈÄÄ„Ç§„Éô„É≥„Éà„Äç„ÇíËøΩÂä†„ÄÇ
    JavaScript„ÅÆ„Éá„Éº„ÇøÊßãÈÄ†„ÇíÂ§ßÂπÖ„Å´Â§âÊõ¥„Åó„ÄÅ„Ç§„Éô„É≥„Éà„Å®„Ç¢„Ç§„ÉÜ„É†„ÅÆÁÆ°ÁêÜ„ÇíÂº∑Âåñ„ÄÇ„Éó„É¨„Ç§„É§„Éº„ÅÆÈÅ∏ÊäûËÇ¢„Å®„ÄÅ‰∫àÊúü„Åõ„Å¨ÂæåÈÄÄ„ÅÆ„É™„Çπ„ÇØ„ÇíÂä†„Åà„Å¶Êà¶Áï•ÊÄß„ÇíÈ´ò„ÇÅ„Çã„ÄÇ
    Implementation Intent: „Ç≤„Éº„É†„ÅÆÂçòË™ø„Åï„Çí„Å™„Åè„Åó„ÄÅ„É™„Éó„É¨„Ç§ÊÄß„ÇíÂêë‰∏ä„Åï„Åõ„Çã„ÄÇ„ÅäÈáë„ÅÆ‰Ωø„ÅÑÈÅì„ÄÅ„Ç¢„Ç§„ÉÜ„É†‰ΩøÁî®„ÄÅ„Ç§„Éô„É≥„ÉàÈÅ∏Êäû„ÅÆÈáçË¶ÅÊÄß„ÇíÈ´ò„ÇÅ„ÄÅ„Çà„Çä„Çπ„É™„É™„É≥„Ç∞„Å™„Ç≤„Éº„É†‰ΩìÈ®ì„ÇíÊèê‰æõ„Åô„Çã„ÄÇ
    -->

    <div class="game-container">
        <h1 class="game-title">üèÆ Êù±Êµ∑ÈÅì‰∫îÂçÅ‰∏âÊ¨°„Åô„Åî„Çç„Åè üèÆ</h1>
        <p class="game-subtitle">Ê±üÊà∏„Åã„Çâ‰∫¨ÈÉΩ„Åæ„Åß53„ÅÆÂÆøÂ†¥Áî∫„ÇíÂ∑°„ÇãÂ§ßÂÜíÈô∫ÔºÅ</p>

        <div class="game-info">
            <div class="info-card">
                <h3>ÁèæÂú®Âú∞</h3>
                <div class="value" id="current-station">Ê±üÊà∏„ÉªÊó•Êú¨Ê©ã</div>
            </div>
            <div class="info-card">
                <h3>ÂÆøÂ†¥Êï∞</h3>
                <div class="value"><span id="station-count">1</span>/55</div>
            </div>
            <div class="info-card">
                <h3>ÊâÄÊåÅÈáë</h3>
                <div class="value" id="money">1000‰∏°</div>
            </div>
            <div class="info-card">
                <h3>Êó•Êï∞</h3>
                <div class="value" id="days">0Êó•</div>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progress" style="width: 2%;">
                ÊóÖË∑ØÈÄ≤Ë°åÂ∫¶
            </div>
        </div>

        <div class="game-board">
            <div class="stations-grid" id="stations-grid">
                <!-- ÂÆøÂ†¥Áî∫„ÅØJavaScript„ÅßÂãïÁöÑÁîüÊàê -->
            </div>
        </div>

        <div class="dice-area">
            <div class="dice" id="dice">üé≤</div>
            <div style="margin-top: 15px;">
                <button class="btn btn-primary" id="roll-btn" onclick="rollDice()">üé≤ „Çµ„Ç§„Ç≥„É≠„ÇíÊåØ„Çã</button>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-secondary" onclick="showStationInfo()">üóæ ÂÆøÂ†¥ÊÉÖÂ†±</button>
            <button class="btn btn-secondary" id="shop-btn" onclick="showShop()" style="display: none;">üí∞ „Ç¢„Ç§„ÉÜ„É†Â±ã</button>
            <button class="btn btn-secondary" onclick="showInventory()">üéí ÊåÅ„Å°Áâ©</button>
            <button class="btn btn-primary" onclick="resetGame()">üîÑ Êñ∞„Åó„ÅÑÊóÖ</button>
        </div>

        <div class="rules-section">
            <h3>üéØ „Ç≤„Éº„É†„É´„Éº„É´</h3>
            <ul>
                <li>üé≤ „Çµ„Ç§„Ç≥„É≠„ÇíÊåØ„Å£„Å¶Êù±Êµ∑ÈÅì„ÇíÈÄ≤„Åø„Åæ„Åô</li>
                <li>üè® ÂÆøÂ†¥Áî∫„Åß„ÅØ„Ç¢„Ç§„ÉÜ„É†„ÅÆÂ£≤Ë≤∑„Åå„Åß„Åç„Åæ„Åô</li>
                <li>üí∞ „ÅäÈáë„ÇíÁÆ°ÁêÜ„Åó„Å™„Åå„Çâ‰∫¨ÈÉΩ„ÇíÁõÆÊåá„Åó„Åæ„Åô</li>
                <li>üé™ ÁâπÂÆö„ÅÆÂÆøÂ†¥„Åß„ÅØ„É¶„Éã„Éº„ÇØ„Å™„Ç§„Éô„É≥„Éà„ÅåÁô∫Áîü„Åó„Åæ„Åô</li>
                <li>‚õ©Ô∏è ÂÖ®55Âú∞ÁÇπÂà∂Ë¶á„ÅßÂãùÂà©ÔºÅ</li>
            </ul>
        </div>
    </div>

    <!-- Ê±éÁî®„É¢„Éº„ÉÄ„É´ -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h3 id="modal-title">„Çø„Ç§„Éà„É´</h3>
            <p id="modal-description">Ë™¨Êòé</p>
            <div id="modal-list"></div>
            <div id="modal-choices"></div>
        </div>
    </div>

    <script>
        const TOKAIDO_STATIONS = [
            { name: "Ê±üÊà∏„ÉªÊó•Êú¨Ê©ã", description: "ÊóÖ„ÅÆÂá∫Áô∫ÁÇπ", market: true, event: 'start' },
            { name: "ÂìÅÂ∑ùÂÆø", description: "Ê±üÊà∏ÂõõÂÆø„ÅÆ‰∏Ä„Å§" },
            { name: "Â∑ùÂ¥éÂÆø", description: "Â§öÊë©Â∑ù„ÅÆÊ∏°„ÅóÂ†¥", event: 'kawasaki_ferry' },
            { name: "Á•ûÂ•àÂ∑ùÂÆø", description: "Ê®™ÊµúÊ∏Ø„Å´Ëøë„ÅÑÂÆøÂ†¥", market: true },
            { name: "‰øùÂúü„É∂Ë∞∑ÂÆø", description: "ÂùÇÈÅì„ÅÆÂ§ö„ÅÑÂÆøÂ†¥", event: 'hodogaya_slope' },
            { name: "Êà∏Â°öÂÆø", description: "ÁÆ±Ê†πË∑Ø„Å∏„ÅÆÂàÜÂ≤êÁÇπ" },
            { name: "Ëó§Ê≤¢ÂÆø", description: "ÈÅäË°åÂØ∫„ÅßÊúâÂêç", market: true },
            { name: "Âπ≥Â°öÂÆø", description: "‰∏ÉÂ§ï„Åæ„Å§„Çä„ÅÆË°ó" },
            { name: "Â§ßÁ£ØÂÆø", description: "Êµ∑Ê≤ø„ÅÑ„ÅÆÁæé„Åó„ÅÑÂÆøÂ†¥" },
            { name: "Â∞èÁî∞ÂéüÂÆø", description: "Â∞èÁî∞ÂéüÂüé„ÅÆÂüé‰∏ãÁî∫", market: true, event: 'castle' },
            { name: "ÁÆ±Ê†πÂÆø", description: "Â§©‰∏ã„ÅÆÈô∫„ÄÅÁÆ±Ê†πÂÖ´Èáå", event: 'hakone' },
            { name: "‰∏âÂ≥∂ÂÆø", description: "‰ºäË±ÜÂõΩ„ÅÆÁéÑÈñ¢Âè£" },
            { name: "Ê≤ºÊ¥•ÂÆø", description: "ÈßøÊ≤≥Êπæ„Å´Èù¢„Åó„ÅüÂÆøÂ†¥" },
            { name: "ÂéüÂÆø", description: "ÂØåÂ£´Â±±„Åå„Çà„ÅèË¶ã„Åà„Çã", event: 'fuji' },
            { name: "ÂêâÂéüÂÆø", description: "ÂØåÂ£´Â±±„ÅÆÁµ∂ÊôØ„Çπ„Éù„ÉÉ„Éà", market: true },
            { name: "Ëí≤ÂéüÂÆø", description: "Èõ™ÊôØËâ≤„ÅßÊúâÂêç" },
            { name: "Áî±ÊØîÂÆø", description: "Ëñ©ÂüµÂ≥†„ÅÆÈõ£ÊâÄ" },
            { name: "ËààÊ¥•ÂÆø", description: "Ê∏ÖË¶ãÂØ∫„ÅßÊúâÂêç" },
            { name: "Ê±üÂ∞ªÂÆø", description: "Ê∏ÖÊ∞¥Ê∏Ø„Å´Ëøë„ÅÑ" },
            { name: "Â∫ú‰∏≠ÂÆø", description: "ÈßøÂ∫úÂüé„ÅÆÂüé‰∏ãÁî∫", market: true, event: 'castle' },
            { name: "Èû†Â≠êÂÆø", description: "„Å®„Çç„ÇçÊ±Å„ÅßÊúâÂêç", event: 'food' },
            { name: "Â≤°ÈÉ®ÂÆø", description: "ÂÆáÊ¥•„ÉéË∞∑Â≥†Ë∂ä„Åà" },
            { name: "Ëó§ÊûùÂÆø", description: "Áî∞‰∏≠Âüé„Å´Ëøë„ÅÑ" },
            { name: "Â≥∂Áî∞ÂÆø", description: "Â§ß‰∫ïÂ∑ù„ÅÆÂ∑ùË∂ä„Åó", event: 'ooi_river' },
            { name: "ÈáëË∞∑ÂÆø", description: "Áâß„ÉéÂéüÂè∞Âú∞„ÅÆÂÖ•Âè£" },
            { name: "Êó•ÂùÇÂÆø", description: "Â∞èÂ§ú„ÅÆ‰∏≠Â±±Ë∂ä„Åà", event: 'nissaka_pass' },
            { name: "ÊéõÂ∑ùÂÆø", description: "ÊéõÂ∑ùÂüé„ÅÆÂüé‰∏ãÁî∫", market: true },
            { name: "Ë¢ã‰∫ïÂÆø", description: "Êù±Êµ∑ÈÅì„ÅÆ„Å©Áúü„Çì‰∏≠" },
            { name: "Ë¶ã‰ªòÂÆø", description: "Â§©Á´úÂ∑ù„Å´Ëøë„ÅÑ", event: 'river' },
            { name: "ÊµúÊùæÂÆø", description: "ÊµúÊùæÂüé„ÅÆÂüé‰∏ãÁî∫", market: true, event: 'castle' },
            { name: "ËàûÂùÇÂÆø", description: "ÊµúÂêçÊπñÁïî„ÅÆÂÆøÂ†¥" },
            { name: "Êñ∞Â±ÖÂÆø", description: "Êñ∞Â±ÖÈñ¢ÊâÄ„ÅßÊúâÂêç", event: 'sekisho' },
            { name: "ÁôΩÈ†àË≥ÄÂÆø", description: "ÊΩÆË¶ãÂùÇ„ÅÆÁµ∂ÊôØ" },
            { name: "‰∫åÂ∑ùÂÆø", description: "Êú¨Èô£„ÅåÁèæÂ≠ò" },
            { name: "ÂêâÁî∞ÂÆø", description: "ÂêâÁî∞Âüé„ÅÆÂüé‰∏ãÁî∫" },
            { name: "Âæ°Ê≤πÂÆø", description: "Êùæ‰∏¶Êú®„ÅåÁæé„Åó„ÅÑ" },
            { name: "Ëµ§ÂùÇÂÆø", description: "Êùâ‰∏¶Êú®„ÅÆÂÆøÂ†¥" },
            { name: "Ëó§Â∑ùÂÆø", description: "„ÇÄ„Çâ„Åï„ÅçÈ∫¶„ÅßÊúâÂêç" },
            { name: "Â≤°Â¥éÂÆø", description: "Âæ≥Â∑ùÂÆ∂Â∫∑ÁîüË™ï„ÅÆÂú∞", market: true, event: 'ieyasu' },
            { name: "Ê±†ÈØâÈÆíÂÆø", description: "È¶¨Â∏Ç„ÅßË≥ë„Çè„ÅÜ" },
            { name: "È≥¥Êµ∑ÂÆø", description: "ÊúâÊùæÁµû„Çä„ÅßÊúâÂêç", event: 'narumi_shibori' },
            { name: "ÂÆÆÂÆø", description: "ÁÜ±Áî∞Á•ûÂÆÆ„ÅÆÈñÄÂâçÁî∫", event: 'miya' },
            { name: "Ê°ëÂêçÂÆø", description: "‰∏ÉÈáå„ÅÆÊ∏°„Åó", market: true },
            { name: "ÂõõÊó•Â∏ÇÂÆø", description: "Ê∏ØÁî∫„Å®„Åó„Å¶Ê†Ñ„Åà„Çã" },
            { name: "Áü≥Ëñ¨Â∏´ÂÆø", description: "Ëñ¨Â∏´Â¶ÇÊù•„ÅßÊúâÂêç" },
            { name: "Â∫ÑÈáéÂÆø", description: "ÁôΩÈõ®„ÅÆÂêçÊâÄ" },
            { name: "‰∫ÄÂ±±ÂÆø", description: "‰∫ÄÂ±±Âüé„ÅÆÂüé‰∏ãÁî∫" },
            { name: "Èñ¢ÂÆø", description: "Êù±Êµ∑ÈÅì„ÅÆÈñ¢ÊâÄ", event: 'sekisho' },
            { name: "ÂùÇ‰∏ãÂÆø", description: "Èà¥ÈπøÂ≥†„ÅÆÈ∫ì" },
            { name: "ÂúüÂ±±ÂÆø", description: "Èà¥ÈπøÂ≥†Ë∂ä„Åà„ÅÆÂÆøÂ†¥", event: 'suzuka' },
            { name: "Ê∞¥Âè£ÂÆø", description: "Ê∞¥Âè£Âüé„ÅÆÂüé‰∏ãÁî∫" },
            { name: "Áü≥ÈÉ®ÂÆø", description: "Áî∞Ê•Ω„ÅßÊúâÂêç", event: 'food' },
            { name: "ËçâÊ¥•ÂÆø", description: "‰∏≠Â±±ÈÅì„Å®„ÅÆÂêàÊµÅÁÇπ", market: true, event: 'kusatsu_junction' },
            { name: "Â§ßÊ¥•ÂÆø", description: "ÁêµÁê∂ÊπñÁïî„ÅÆÂÆøÂ†¥" },
            { name: "‰∫¨ÈÉΩ„Éª‰∏âÊù°Â§ßÊ©ã", description: "ÊóÖ„ÅÆÁµÇÁùÄÁÇπ", event: 'goal' }
        ];

        const ITEMS = {
            'dango': { name: 'ÂêçÁâ©„ÅÆÂõ£Â≠ê', cost: 50, description: 'Ê¨°„ÅÆ„Çµ„Ç§„Ç≥„É≠„ÅÆÁõÆ„Çí+1„Åô„Çã„ÄÇ' },
            'waraji': { name: '‰∏àÂ§´„Å™ËçâÈûã', cost: 100, description: '3„Çø„Éº„É≥„ÅÆÈñì„ÄÅÁßªÂãï„Ç≥„Çπ„Éà(‰∏°)„ÅåÂçäÈ°ç„Å´„Å™„Çã„ÄÇ' },
            'omamori': { name: '„ÅäÂÆà„Çä', cost: 200, description: 'ÊÇ™„ÅÑ„Ç§„Éô„É≥„Éà„ÅÆÁµêÊûú„Çí1Âõû„Å†„ÅëÂõûÈÅø„Åß„Åç„Çã„ÄÇ' },
            'map': { name: 'Âè§Âú∞Âõ≥', cost: 300, description: 'Ê¨°„ÅÆÁßªÂãï„Åß1ÔΩû3„ÅÆÂ•Ω„Åç„Å™Êï∞„Å†„ÅëÈÄ≤„ÇÅ„Çã„ÄÇ' },
            'shibori': { name: 'ÊúâÊùæÁµû', cost: 0, description: 'È≥¥Êµ∑ÂÆø„ÅÆÁæé„Åó„ÅÑÁâπÁî£ÂìÅ„ÄÇÊóÖ„ÅÆË©ï‰æ°„Å´ÂΩ±Èüø„Åô„Çã„Åã„ÇÇ„Åó„Çå„Å™„ÅÑ„ÄÇ' }
        };
        
        const EVENTS = {
            'hodogaya_slope': {
                title: "Ê®©Â§™ÂùÇ„ÅÆÊÇ≤Âäá",
                description: "Ê®©Â§™ÂùÇ„ÅÆÊÄ•„Å™‰∏ã„ÇäÂùÇ„ÅßË∂≥„ÇíÊªë„Çâ„Åõ„ÄÅËç∑Áâ©„ÇíËêΩ„Å®„Åó„Å¶„Åó„Åæ„Å£„ÅüÔºÅ Ëç∑Áâ©„ÇíÊãæ„ÅÜ„Åü„ÇÅ„ÄÅ1„Å§ÊâãÂâç„ÅÆÁ•ûÂ•àÂ∑ùÂÆø„Åæ„ÅßÊàª„ÇãÁæΩÁõÆ„Å´„Å™„Å£„Åü„ÄÇ",
                choices: [
                    { text: "‰ªïÊñπ„Å™„ÅÑ„ÄÅÊàª„Çç„ÅÜ (-1„Éû„Çπ)", effect: { steps: -1 } }
                ]
            },
            'nissaka_pass': {
                title: "Â∞èÂ§ú„ÅÆ‰∏≠Â±±„ÅÆËø∑„ÅÑÈÅì",
                description: "Â∞èÂ§ú„ÅÆ‰∏≠Â±±„Åß‰∏çÊ∞óÂë≥„Å™Èõ∞Âõ≤Ê∞ó„ÇíÊÑü„Åò„ÄÅÈÅì„ÇíÈñìÈÅï„Åà„Å¶„Åó„Åæ„Å£„ÅüÔºÅ Ê∞ó„Å•„Åë„Å∞2„Å§ÊâãÂâç„ÅÆÈáëË∞∑ÂÆø„Åæ„ÅßÊàª„Å£„Å¶„Åç„Å¶„Åó„Åæ„Å£„Åü„ÄÇ",
                choices: [
                    { text: "ÈÅì„ÇíÈñìÈÅï„Åà„Åü„Åã‚Ä¶ (-2„Éû„Çπ, +1Êó•)", effect: { steps: -2, days: 1 } }
                ]
            },
            'kawasaki_ferry': {
                title: "Â§öÊë©Â∑ù„ÅÆÊ∏°„Åó",
                description: "Â§öÊë©Â∑ù„ÇíÊ∏°„ÇãÊ∏°„ÅóËàπ„Å†„ÄÇËàπÈ†≠„ÅåÊñôÈáë(50‰∏°)„ÇíÊèêÁ§∫„Åó„Å¶„ÅÑ„Çã„ÄÇ",
                choices: [
                    { text: "Ê≠£Ë¶èÊñôÈáë„ÇíÊâï„ÅÜ (-50‰∏°)", effect: { money: -50 }, cost: 50 },
                    { text: "ÂÄ§Âàá„Çä‰∫§Ê∏â„Åô„Çã", type: 'haggle', success: { text: "‰∫§Ê∏âÊàêÂäüÔºÅ(-30‰∏°)", effect: { money: -30 } }, failure: { text: "‰∫§Ê∏âÂ§±Êïó‚Ä¶(+1Êó•)", effect: { days: 1 } }, cost: 0 }
                ]
            },
            'narumi_shibori': {
                title: "ÊúâÊùæÁµû„Çä„ÅÆË™òÊÉë",
                description: "Áæé„Åó„ÅÑÊúâÊùæÁµû„Çä„ÅÆÂ∫ó„ÅåÁõÆ„Å´ÂÖ•„Å£„Åü„ÄÇË¶ã‰∫ã„Å™Â∏É„Å†„Åå„ÄÅ„Åã„Å™„ÇäÈ´ò‰æ°„Å†„ÄÇ",
                choices: [
                    { text: "Ë®òÂøµ„Å´Ë≥ºÂÖ•„Åô„Çã (-250‰∏°)", effect: { item: 'shibori' }, cost: 250 },
                    { text: "È´ò„Åô„Åé„Çã„ÅÆ„ÅßË´¶„ÇÅ„Çã", effect: {} }
                ]
            },
            'kusatsu_junction': {
                title: "‰∏≠Â±±ÈÅì„Å®„ÅÆÂêàÊµÅÁÇπ",
                description: "‰∏≠Â±±ÈÅì„Åã„ÇâÊù•„Åü„Å®„ÅÑ„ÅÜÊóÖ‰∫∫„Å®Âá∫‰ºö„Å£„Åü„ÄÇ‰Ωï„ÅãÊÉÖÂ†±„Çí‰∫§Êèõ„Åó„Å™„ÅÑ„Åã„ÄÅ„Å®ÊåÅ„Å°„Åã„Åë„Çâ„Çå„Åü„ÄÇ",
                choices: [
                    { text: "ÊÉÖÂ†±‰∫§Êèõ„Åô„Çã", type: 'gamble', success: { text: "ËøëÈÅìÁô∫Ë¶ãÔºÅ(-1Êó•)", effect: { days: -1 } }, failure: { text: "„Åª„ÇâË©±„Å†„Å£„Åü‚Ä¶(-50‰∏°)", effect: { money: -50 } } },
                    { text: "Èñ¢„Çè„Çâ„Åö„Å´ÂÖà„ÇíÊÄ•„Åê", effect: {} }
                ]
            },
            'hakone': {
                title: "Â§©‰∏ã„ÅÆÈô∫„ÄÅÁÆ±Ê†πÂÖ´Èáå",
                description: "Èô∫„Åó„ÅÑÂ±±ÈÅì„ÅåÁõÆ„ÅÆÂâç„Å´ÔºÅ„Å©„ÅÜ„ÇÑ„Å£„Å¶Ë∂ä„Åà„Åæ„Åô„ÅãÔºü",
                choices: [
                    { text: "Ëá™Âäõ„ÅßË∂ä„Åà„Çã (+2Êó•)", effect: { days: 2 } },
                    { text: "ÈßïÁ±†„ÇíÈõá„ÅÜ (-150‰∏°)", effect: { money: -150 }, cost: 150 },
                    { text: "‰∏àÂ§´„Å™ËçâÈûã„Çí‰Ωø„ÅÜ", effect: { days: 1 }, requiredItem: 'waraji' }
                ]
            },
            'ooi_river': {
                title: "Â§ß‰∫ïÂ∑ù„ÅÆÂ∑ùÁïô„ÇÅ",
                description: "Â∑ù„ÅåÂ¢óÊ∞¥„Åó„Å¶Ê∏°„Çå„Åæ„Åõ„ÇìÔºÅ„Å©„ÅÜ„Åó„Åæ„Åô„ÅãÔºü",
                choices: [
                    { text: "Êï∞Êó•ÂæÖ„Å§ (+3Êó•)", effect: { days: 3 } },
                    { text: "Â∑ùË∂ä‰∫∫Ë∂≥„ÇíÈõá„ÅÜ (-200‰∏°)", effect: { money: -200 }, cost: 200 },
                    { text: "Âè§Âú∞Âõ≥„ÅÆË£èÈÅì„ÇíË°å„Åè", effect: { days: 1, money: -50 }, requiredItem: 'map', cost: 50 }
                ]
            },
            'ieyasu': {
                title: "Âæ≥Â∑ùÂÆ∂Â∫∑ÁîüË™ï„ÅÆÂú∞",
                description: "Â≤°Â¥éÂüé‰∏ã„ÅßÂ∞ÜËªçÂÆ∂„ÇÜ„Åã„Çä„ÅÆÂìÅ„ÇíÁô∫Ë¶ãÔºÅÂπ∏ÈÅã„ÅåËàû„ÅÑËæº„Çì„Å†ÔºÅ",
                choices: [
                    { text: "„ÅÇ„Çä„Åå„Åü„ÅèÈ†ÇÊà¥„Åô„Çã (+200‰∏°)", effect: { money: 200 } }
                ]
            },
            'food': {
                title: "ÂêçÁâ©ÊñôÁêÜ",
                description: "ÁæéÂë≥„Åó„Åù„ÅÜ„Å™ÂêçÁâ©ÊñôÁêÜ„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÈ£ü„Åπ„Å¶„ÅÑ„Åç„Åæ„Åô„ÅãÔºü",
                choices: [
                    { text: "È£ü„Åπ„Çã (-50‰∏°, +1Êó•)", effect: { money: -50, days: 1 }, cost: 50 },
                    { text: "ÂÖà„ÇíÊÄ•„Åê", effect: {} }
                ]
            },
             'sekisho': {
                title: "Èñ¢ÊâÄ„Åß„ÅÆÊ§úÂïè",
                description: "Èñ¢ÊâÄ„ÅßÂΩπ‰∫∫„Å´„Çà„ÇãÂé≥„Åó„ÅÑÊ§úÂïè„ÅåË°å„Çè„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                choices: [
                    { text: "Á¥†Áõ¥„Å´ÈÄö„Çã (-20‰∏°, +1Êó•)", effect: { money: -20, days: 1 }, cost: 20 },
                    { text: "Ë¢ñ„ÅÆ‰∏ã„Çí‰Ωø„ÅÜ (-100‰∏°)", effect: { money: -100 }, cost: 100 }
                ]
            }
        };

        let gameState;

        function initGame() {
            gameState = {
                currentPosition: 0,
                money: 1000,
                days: 0,
                inventory: [],
                visitedStations: [0],
                isGameBlocked: false,
                activeEffects: {} // { 'waraji': 3, 'dice_bonus': 1 }
            };
            
            renderStations();
            updateGameInfo();
            updateControls();
        }

        function renderStations() {
            const grid = document.getElementById('stations-grid');
            grid.innerHTML = '';
            
            TOKAIDO_STATIONS.forEach((station, index) => {
                const stationDiv = document.createElement('div');
                stationDiv.className = 'station';
                
                if (index === gameState.currentPosition) {
                    stationDiv.classList.add('current');
                    stationDiv.innerHTML = `<div class="player-token">üö∂</div>`;
                } else if (gameState.visitedStations.includes(index)) {
                    stationDiv.classList.add('visited');
                }
                
                if (station.event) stationDiv.classList.add('event-station');
                if (station.market) stationDiv.classList.add('market-station');
                
                stationDiv.innerHTML += `
                    <div class="station-number">${index + 1}</div>
                    <div class="station-name">${station.name}</div>
                `;
                
                stationDiv.onclick = () => showStationDetail(index);
                grid.appendChild(stationDiv);
            });
        }

        function rollDice() {
            if (gameState.isGameBlocked) return;
            
            gameState.isGameBlocked = true;
            const dice = document.getElementById('dice');
            
            dice.classList.add('rolling');
            updateControls();
            
            let animationCount = 0;
            const animationInterval = setInterval(() => {
                dice.textContent = ['‚öÄ', '‚öÅ', '‚öÇ', '‚öÉ', '‚öÑ', '‚öÖ'][Math.floor(Math.random() * 6)];
                animationCount++;
                
                if (animationCount > 10) {
                    clearInterval(animationInterval);
                    
                    let result = Math.floor(Math.random() * 6) + 1;
                    
                    if (gameState.activeEffects['dice_bonus']) {
                        result += gameState.activeEffects['dice_bonus'];
                        delete gameState.activeEffects['dice_bonus'];
                        showModal("„Ç¢„Ç§„ÉÜ„É†ÂäπÊûúÔºÅ", `ÂêçÁâ©„ÅÆÂõ£Â≠ê„ÅÆ„Åä„Åã„Åí„Åß„Çµ„Ç§„Ç≥„É≠„ÅÆÁõÆ„Åå+1„Åï„Çå„ÅüÔºÅ`);
                    }

                    dice.textContent = ['‚öÄ', '‚öÅ', '‚öÇ', '‚öÉ', '‚öÑ', '‚öÖ'][Math.min(5, result - 1)];
                    
                    setTimeout(() => {
                        dice.classList.remove('rolling');
                        movePlayer(result);
                    }, 500);
                }
            }, 100);
        }

        function movePlayer(steps) {
            gameState.isGameBlocked = true;
            updateControls();

            let newPosition = gameState.currentPosition + steps;
            newPosition = Math.max(0, newPosition);
            newPosition = Math.min(newPosition, TOKAIDO_STATIONS.length - 1);

            if (steps > 0) {
                let moveCost = steps * 10;
                if (gameState.activeEffects['cost_reduction']) {
                    moveCost /= 2;
                }
                gameState.money -= moveCost;
                gameState.days += Math.ceil(steps / 2);
            }
            
            gameState.currentPosition = newPosition;
            if (!gameState.visitedStations.includes(newPosition)) {
                gameState.visitedStations.push(newPosition);
            }

            Object.keys(gameState.activeEffects).forEach(effect => {
                if (effect === 'cost_reduction') {
                    gameState.activeEffects[effect]--;
                    if (gameState.activeEffects[effect] <= 0) {
                        delete gameState.activeEffects[effect];
                    }
                }
            });
            
            renderStations();
            updateGameInfo();
            
            const currentStation = TOKAIDO_STATIONS[newPosition];
            if (currentStation.event && EVENTS[currentStation.event] && steps > 0) {
                setTimeout(() => triggerEvent(currentStation.event), 500);
            } else {
                 gameState.isGameBlocked = false;
                 updateControls();
            }
            
            if (newPosition === TOKAIDO_STATIONS.length - 1) {
                setTimeout(showVictory, 1500);
            }
        }

        function triggerEvent(eventType) {
            const event = EVENTS[eventType];
            if (!event) {
                gameState.isGameBlocked = false;
                updateControls();
                return;
            }
            showModal(event.title, event.description, event.choices);
        }
        
        function resolveChoice(choice) {
            // Handle special choice types first
            if (choice.type === 'haggle' || choice.type === 'gamble') {
                const isSuccess = Math.random() < 0.5; // 50% chance
                const outcome = isSuccess ? choice.success : choice.failure;
                showModal(isSuccess ? "ÊàêÂäüÔºÅ" : "Â§±Êïó‚Ä¶", outcome.text);
                choice = { effect: outcome.effect }; // Overwrite choice with the outcome
            }

            const isBadEvent = (choice.effect.money && choice.effect.money < 0) || (choice.effect.days && choice.effect.days > 0) || (choice.effect.steps && choice.effect.steps < 0);
            if (isBadEvent) {
                const omamoriIndex = gameState.inventory.findIndex(item => item === 'omamori');
                if (omamoriIndex !== -1) {
                    if (confirm("„ÅäÂÆà„Çä„Çí‰Ωø„ÅÑ„Åæ„Åô„ÅãÔºüÊÇ™„ÅÑÁµêÊûú„ÇíÊâì„Å°Ê∂à„Åõ„Åæ„Åô„ÄÇ")) {
                        gameState.inventory.splice(omamoriIndex, 1);
                        showModal("„ÅäÂÆà„Çä„ÅÆÂäπÊûú", "„ÅäÂÆà„Çä„ÅåÊÇ™„ÅÑÂá∫Êù•‰∫ã„Åã„Çâ„ÅÇ„Å™„Åü„ÇíÂÆà„Å£„ÅüÔºÅ");
                        return;
                    }
                }
            }

            if (choice.effect.money) gameState.money += choice.effect.money;
            if (choice.effect.days) gameState.days += choice.effect.days;
            if (choice.effect.item) gameState.inventory.push(choice.effect.item);
            
            if (choice.requiredItem) {
                const itemIndex = gameState.inventory.findIndex(item => item === choice.requiredItem);
                if (itemIndex > -1) {
                    gameState.inventory.splice(itemIndex, 1);
                }
            }

            updateGameInfo();

            if (choice.effect.steps) {
                const stepsToMove = choice.effect.steps;
                // Do not close modal here, let the following modal call handle it
                setTimeout(() => movePlayer(stepsToMove), 500);
            } else {
                // For non-movement effects, we might have already shown a result modal
                if (!choice.type) {
                    closeModal();
                }
            }
        }

        function showModal(title, description, choices = []) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-description').innerHTML = description;
            
            const choicesDiv = document.getElementById('modal-choices');
            const listDiv = document.getElementById('modal-list');
            choicesDiv.innerHTML = '';
            listDiv.innerHTML = '';

            if (choices.length > 0) {
                choices.forEach(choice => {
                    const button = document.createElement('button');
                    button.className = 'btn btn-primary';
                    button.textContent = choice.text;
                    
                    const hasItem = choice.requiredItem ? gameState.inventory.includes(choice.requiredItem) : true;
                    const hasMoney = choice.cost ? gameState.money >= choice.cost : true;

                    if (hasItem && hasMoney) {
                        button.onclick = () => resolveChoice(choice);
                    } else {
                        button.disabled = true;
                        let reason = [];
                        if (!hasMoney) reason.push("„ÅäÈáë„ÅåË∂≥„Çä„Å™„ÅÑ");
                        if (!hasItem) reason.push(`${ITEMS[choice.requiredItem].name}„Åå„Å™„ÅÑ`);
                        button.textContent += ` (${reason.join(', ')})`;
                    }
                    choicesDiv.appendChild(button);
                });
            } else {
                 const button = document.createElement('button');
                 button.className = 'btn btn-primary';
                 button.textContent = 'Á∂ö„Åë„Çã';
                 button.onclick = closeModal;
                 choicesDiv.appendChild(button);
            }

            document.getElementById('modal').style.display = 'flex';
            gameState.isGameBlocked = true;
            updateControls();
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            gameState.isGameBlocked = false;
            updateControls();
        }
        
        function showShop() {
            const station = TOKAIDO_STATIONS[gameState.currentPosition];
            if (!station.market) return;

            document.getElementById('modal-title').textContent = 'üí∞ „Ç¢„Ç§„ÉÜ„É†Â±ã';
            document.getElementById('modal-description').textContent = '„ÅÑ„Çâ„Å£„Åó„ÇÉ„ÅÑÔºÅÊóÖ„ÅÆÂä©„Åë„Å´„Å™„Çã„ÇÇ„ÅÆ„Åå„ÅÇ„Çã„Çà„ÄÇ';
            
            const listDiv = document.getElementById('modal-list');
            listDiv.innerHTML = '';

            Object.keys(ITEMS).forEach(id => {
                const item = ITEMS[id];
                if (id === 'shibori') return; // Don't sell special items
                const itemDiv = document.createElement('div');
                itemDiv.className = 'shop-item';
                itemDiv.innerHTML = `
                    <div class="item-info">
                        <strong>${item.name}</strong> (${item.cost}‰∏°)<br>
                        <small>${item.description}</small>
                    </div>
                    <button class="btn btn-secondary" onclick="buyItem('${id}')" ${gameState.money < item.cost ? 'disabled' : ''}>Ë≤∑„ÅÜ</button>
                `;
                listDiv.appendChild(itemDiv);
            });

            const choicesDiv = document.getElementById('modal-choices');
            choicesDiv.innerHTML = `<button class="btn btn-primary" onclick="closeModal()">Â∫ó„ÇíÂá∫„Çã</button>`;

            document.getElementById('modal').style.display = 'flex';
            gameState.isGameBlocked = true;
            updateControls();
        }
        
        function buyItem(itemId) {
            const item = ITEMS[itemId];
            if (gameState.money >= item.cost) {
                gameState.money -= item.cost;
                gameState.inventory.push(itemId);
                updateGameInfo();
                showShop(); // Refresh shop view
            }
        }

        function showInventory() {
            document.getElementById('modal-title').textContent = 'üéí ÊåÅ„Å°Áâ©';
            document.getElementById('modal-description').textContent = 'ÊåÅ„Å£„Å¶„ÅÑ„Çã„Ç¢„Ç§„ÉÜ„É†„ÇíÁ¢∫Ë™ç„Éª‰ΩøÁî®„Åó„Åæ„Åô„ÄÇ';
            
            const listDiv = document.getElementById('modal-list');
            listDiv.innerHTML = '';

            if (gameState.inventory.length === 0) {
                listDiv.innerHTML = '<p>ÊåÅ„Å°Áâ©„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>';
            } else {
                gameState.inventory.forEach((itemId, index) => {
                    const item = ITEMS[itemId];
                    if (!item) return;
                    
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'inventory-item';
                    let useButton = '<button class="btn btn-secondary" onclick="useItem(\'${itemId}\', ${index})">‰Ωø„ÅÜ</button>';
                    if (itemId === 'shibori' || itemId === 'omamori') {
                        useButton = ''; // Cannot be used directly
                    }

                    itemDiv.innerHTML = `
                        <div class="item-info">
                            <strong>${item.name}</strong><br>
                            <small>${item.description}</small>
                        </div>
                        ${useButton}
                    `;
                    listDiv.appendChild(itemDiv);
                });
            }

            const choicesDiv = document.getElementById('modal-choices');
            choicesDiv.innerHTML = `<button class="btn btn-primary" onclick="closeModal()">Èñâ„Åò„Çã</button>`;

            document.getElementById('modal').style.display = 'flex';
            gameState.isGameBlocked = true;
            updateControls();
        }
        
        function useItem(itemId, index) {
            const item = ITEMS[itemId];
            
            switch(itemId) {
                case 'dango':
                    gameState.activeEffects['dice_bonus'] = (gameState.activeEffects['dice_bonus'] || 0) + 1;
                    break;
                case 'waraji':
                    gameState.activeEffects['cost_reduction'] = (gameState.activeEffects['cost_reduction'] || 0) + 3;
                    break;
                case 'map':
                     const move = prompt("1ÔΩû3„ÅÆÂ•Ω„Åç„Å™Êï∞„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ", "1");
                     const steps = parseInt(move, 10);
                     if (!isNaN(steps) && steps >= 1 && steps <= 3) {
                         closeModal();
                         setTimeout(() => movePlayer(steps), 300);
                     } else {
                         alert("ÁÑ°Âäπ„Å™ÂÖ•Âäõ„Åß„Åô");
                         return;
                     }
                    break;
            }
            
            gameState.inventory.splice(index, 1);
            showInventory();
        }

        function updateGameInfo() {
            const currentStation = TOKAIDO_STATIONS[gameState.currentPosition];
            document.getElementById('current-station').textContent = currentStation.name;
            document.getElementById('station-count').textContent = gameState.currentPosition + 1;
            document.getElementById('money').textContent = `${gameState.money}‰∏°`;
            document.getElementById('days').textContent = `${gameState.days}Êó•`;
            
            const progress = (gameState.currentPosition / (TOKAIDO_STATIONS.length - 1)) * 100;
            document.getElementById('progress').style.width = `${progress}%`;
        }
        
        function updateControls() {
            const rollBtn = document.getElementById('roll-btn');
            const shopBtn = document.getElementById('shop-btn');
            
            rollBtn.disabled = gameState.isGameBlocked;
            rollBtn.textContent = gameState.isGameBlocked ? '„Ç§„Éô„É≥„Éà‰∏≠...' : 'üé≤ „Çµ„Ç§„Ç≥„É≠„ÇíÊåØ„Çã';

            const station = TOKAIDO_STATIONS[gameState.currentPosition];
            shopBtn.style.display = station.market && !gameState.isGameBlocked ? 'inline-block' : 'none';
        }

        function showStationInfo() {
            if(gameState.isGameBlocked) return;
            const currentStation = TOKAIDO_STATIONS[gameState.currentPosition];
            let info = `üìç ÁèæÂú®Âú∞: ${currentStation.name}

`;
            info += `üìù Ë™¨Êòé: ${currentStation.description}

`;
            let type = [];
            if(currentStation.market) type.push('„Ç¢„Ç§„ÉÜ„É†Â±ã„ÅÇ„Çä');
            if(currentStation.event) type.push('„Ç§„Éô„É≥„Éà„ÅÇ„Çä');
            if(type.length === 0) type.push('ÊôÆÈÄö„ÅÆÂÆøÂ†¥');
            info += `üè® ÂÆøÂ†¥„Çø„Ç§„Éó: ${type.join(', ')}

`;
            info += `üìä ÈÄ≤Ë°åÂ∫¶: ${gameState.currentPosition + 1}/${TOKAIDO_STATIONS.length} (${Math.round((gameState.currentPosition / (TOKAIDO_STATIONS.length - 1)) * 100)}%)`;
            alert(info);
        }

        function showVictory() {
            let message = 'üéâ Êù±Êµ∑ÈÅì‰∫îÂçÅ‰∏âÊ¨°Âà∂Ë¶á„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ üéâ

';
            message += `üìÖ ÊóÖË°åÊúüÈñì: ${gameState.days}Êó•
`;
            message += `üí∞ ÊÆã„ÇäÊâÄÊåÅÈáë: ${gameState.money}‰∏°
`;
            
            let score = gameState.money - (gameState.days * 10);
            if (gameState.inventory.includes('shibori')) {
                message += "ÊóÖ„ÅÆË®òÂøµ„Å´Ë≤∑„Å£„ÅüÊúâÊùæÁµû„Çä„ÅØ„ÄÅÁ¥†Êô¥„Çâ„Åó„ÅÑÊÄù„ÅÑÂá∫„Å®„Å™„Å£„Åü„ÄÇ
";
                score += 300; // Bonus for the special item
            }

            let rank = '';
            if (score >= 1000) {
                rank = 'üèÜ ÊóÖ„ÅÆÈÅî‰∫∫';
            } else if (score >= 500) {
                rank = 'ü•â ÁÜüÁ∑¥ÊóÖ‰∫∫';
            } else if (score >= 100) {
                rank = 'ü•à ÊôÆÈÄö„ÅÆÊóÖ‰∫∫';
            } else {
                rank = 'ü•á „ÅÆ„Çì„Å≥„ÇäÊóÖ‰∫∫';
            }
            
            message += `
Á∑èÂêàË©ï‰æ°: ${rank}`;
            showModal("ÊóÖ„ÅÆÁµÇ„Çè„Çä", message);
        }

        function resetGame() {
            if (confirm('Êñ∞„Åó„ÅÑÊóÖ„ÇíÂßã„ÇÅ„Åæ„Åô„ÅãÔºü')) {
                initGame();
            }
        }

        // „Ç≤„Éº„É†ÈñãÂßã
        initGame();
    </script>
</body>
</html>