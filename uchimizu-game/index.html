<!--
AI Model: Claude 3.5 Sonnet
User Prompt: 新しいフォルダーを作り、打ち水で世界を冷やすゲームを作ってください
AI Approach: HTML5 Canvasを使用したクリックベースの打ち水ゲーム。温度システムと水しぶきエフェクトを実装
Implementation Intent: 日本の夏の文化である打ち水をテーマにした涼しげなゲーム体験を提供
-->
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>打ち水で世界を冷やすゲーム</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom, #ff4444 0%, #ff8888 50%, #ffcccc 100%);
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            transition: background 0.5s ease;
        }

        h1 {
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin: 10px 0;
            font-size: clamp(1.5rem, 4vw, 2rem);
        }

        canvas {
            border: 3px solid #333;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            cursor: crosshair;
            max-width: 100%;
            height: auto;
        }

        .ui {
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            margin: 10px 0;
            font-size: 1.2rem;
            text-align: center;
        }

        .temperature-bar {
            width: min(300px, 80vw);
            height: 20px;
            background: linear-gradient(to right, #0066ff, #00ccff, #ffff00, #ff6600, #ff0000);
            border: 2px solid #333;
            border-radius: 10px;
            position: relative;
            margin: 10px 0;
        }

        .temperature-indicator {
            width: 4px;
            height: 24px;
            background: white;
            border: 1px solid #333;
            position: absolute;
            top: -2px;
            transition: left 0.3s ease;
        }

        .instructions {
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            margin: 10px;
            text-align: center;
            font-size: 1rem;
        }

        .emoticon-display {
            background: rgba(255, 255, 255, 0.9);
            border: 3px solid #333;
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            transition: all 0.5s ease;
        }

        .emoticon-face {
            font-size: 2.5rem;
            margin: 5px 0;
            transition: transform 0.3s ease;
        }

        .emoticon-face.bounce {
            animation: bounce 0.6s ease-in-out;
        }

        .emoticon-message {
            font-size: 1.1rem;
            color: #333;
            font-weight: bold;
            margin: 5px 0;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
    </style>
</head>
<body>
    <h1>🌊 打ち水で世界を冷やそう 🌊</h1>
    
    <div class="ui">
        <div>世界の温度: <span id="temperature">35</span>°C</div>
        <div class="temperature-bar">
            <div class="temperature-indicator" id="tempIndicator"></div>
        </div>
        <div>スコア: <span id="score">0</span></div>
        <div>打ち水回数: <span id="splashCount">0</span></div>
        <div>多様性ボーナス: <span id="diversityBonus">0</span>%</div>
    </div>

    <div class="emoticon-display">
        <div class="emoticon-face" id="emoticonFace">(>_<)</div>
        <div class="emoticon-message" id="emoticonMessage">猛暑だ...</div>
    </div>

    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <div class="instructions">
        クリックして打ち水をして、世界を冷やそう！<br>
        目標：温度を20°C以下にしよう<br>
        <small>💡 違う場所に打ち水するほど効果が高くなります！</small>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let gameState = {
            temperature: 35,
            score: 0,
            splashCount: 0,
            particles: [],
            heatSpots: [],
            gameWon: false,
            splashHistory: [],
            maxHistorySize: 5,
            diversityBonus: 0
        };

        // 熱スポットを初期化
        function initHeatSpots() {
            gameState.heatSpots = [];
            for (let i = 0; i < 8; i++) {
                gameState.heatSpots.push({
                    x: Math.random() * (canvas.width - 60) + 30,
                    y: Math.random() * (canvas.height - 60) + 30,
                    intensity: 0.5 + Math.random() * 0.5,
                    radius: 20 + Math.random() * 30,
                    cooled: false
                });
            }
        }

        // 水しぶきパーティクルクラス
        class WaterParticle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 8;
                this.vy = (Math.random() - 0.5) * 8;
                this.size = Math.random() * 6 + 2;
                this.alpha = 1;
                this.life = 60;
                this.maxLife = 60;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vx *= 0.98;
                this.vy *= 0.98;
                this.life--;
                this.alpha = this.life / this.maxLife;
                this.size *= 0.99;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = `rgba(64, 164, 255, ${this.alpha})`;
                ctx.shadowColor = 'rgba(64, 164, 255, 0.5)';
                ctx.shadowBlur = 5;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }

            isDead() {
                return this.life <= 0;
            }
        }

        // 温度に応じた顔文字を取得する関数
        function getEmoticonByTemperature(temp) {
            if (temp >= 38) {
                return { face: "(;´Д`)", message: "暑すぎる..." };
            } else if (temp >= 35) {
                return { face: "(>_<)", message: "猛暑だ..." };
            } else if (temp >= 32) {
                return { face: "(´・ω・`)", message: "暑いなぁ" };
            } else if (temp >= 28) {
                return { face: "(-_-)", message: "まだ暑い" };
            } else if (temp >= 25) {
                return { face: "(・ω・)", message: "少し涼しい" };
            } else if (temp >= 22) {
                return { face: "(´∀`)", message: "いい感じ！" };
            } else if (temp >= 20) {
                return { face: "(^o^)", message: "涼しい〜♪" };
            } else {
                return { face: "ヽ(´▽`)/", message: "最高に涼しい！" };
            }
        }

        // 多様性ボーナスを計算する関数
        function calculateDiversityBonus(x, y) {
            if (gameState.splashHistory.length === 0) {
                return 1.0; // 最初の打ち水は通常効果
            }

            let minDistance = Infinity;
            let totalDistance = 0;

            // 過去の打ち水地点との距離を計算
            gameState.splashHistory.forEach(splash => {
                const distance = Math.sqrt((x - splash.x) ** 2 + (y - splash.y) ** 2);
                minDistance = Math.min(minDistance, distance);
                totalDistance += distance;
            });

            // 近すぎる場合は効果減少、遠い場合は効果増加
            const avgDistance = totalDistance / gameState.splashHistory.length;
            
            let multiplier = 1.0;
            if (minDistance < 50) {
                // 50px以内に前回の打ち水がある場合は効果減少
                multiplier = 0.7 + (minDistance / 50) * 0.3;
            } else if (avgDistance > 150) {
                // 平均距離が150px以上の場合は軽微なボーナス
                multiplier = Math.min(1.3, 1.0 + (avgDistance - 150) / 400);
            }

            return multiplier;
        }

        // 打ち水履歴を更新
        function updateSplashHistory(x, y) {
            gameState.splashHistory.push({ x, y, timestamp: Date.now() });
            
            // 履歴サイズを制限
            if (gameState.splashHistory.length > gameState.maxHistorySize) {
                gameState.splashHistory.shift();
            }
        }

        // 顔文字を更新する関数
        let lastEmoticon = null;
        function updateEmoticon(temperature) {
            const emoticon = getEmoticonByTemperature(temperature);
            const faceElement = document.getElementById('emoticonFace');
            const messageElement = document.getElementById('emoticonMessage');
            
            // 顔文字が変わった場合のみ更新とアニメーション
            if (!lastEmoticon || lastEmoticon.face !== emoticon.face) {
                faceElement.textContent = emoticon.face;
                messageElement.textContent = emoticon.message;
                
                // バウンスアニメーション
                faceElement.classList.remove('bounce');
                setTimeout(() => {
                    faceElement.classList.add('bounce');
                }, 10);
                
                // 背景色を温度に応じて変更
                const emoticonDisplay = document.querySelector('.emoticon-display');
                if (temperature >= 35) {
                    emoticonDisplay.style.background = 'rgba(255, 200, 200, 0.9)';
                } else if (temperature >= 28) {
                    emoticonDisplay.style.background = 'rgba(255, 240, 200, 0.9)';
                } else if (temperature >= 22) {
                    emoticonDisplay.style.background = 'rgba(200, 255, 200, 0.9)';
                } else {
                    emoticonDisplay.style.background = 'rgba(200, 230, 255, 0.9)';
                }
                
                lastEmoticon = emoticon;
            }
        }

        // クリック・タッチイベント処理
        function handleInteraction(event) {
            event.preventDefault();
            const rect = canvas.getBoundingClientRect();
            let x, y;
            
            if (event.type === 'touchstart' || event.type === 'touchmove') {
                const touch = event.touches[0];
                x = touch.clientX - rect.left;
                y = touch.clientY - rect.top;
            } else {
                x = event.clientX - rect.left;
                y = event.clientY - rect.top;
            }
            
            // キャンバスのスケールを考慮
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            x *= scaleX;
            y *= scaleY;
            
            // 多様性ボーナスを計算
            const diversityMultiplier = calculateDiversityBonus(x, y);
            gameState.diversityBonus = Math.round((diversityMultiplier - 1) * 100);

            // 水しぶきエフェクト生成（効果に応じて数を調整）
            const particleCount = Math.floor(20 * diversityMultiplier);
            for (let i = 0; i < particleCount; i++) {
                gameState.particles.push(new WaterParticle(x, y));
            }

            // 熱スポットとの衝突判定
            gameState.heatSpots.forEach(spot => {
                const distance = Math.sqrt((x - spot.x) ** 2 + (y - spot.y) ** 2);
                if (distance < spot.radius && !spot.cooled) {
                    spot.cooled = true;
                    const heatSpotCooling = 2 * diversityMultiplier;
                    gameState.temperature -= heatSpotCooling;
                    gameState.score += Math.floor(100 * diversityMultiplier);
                    
                    // 追加の冷却エフェクト
                    const bonusParticles = Math.floor(15 * diversityMultiplier);
                    for (let i = 0; i < bonusParticles; i++) {
                        gameState.particles.push(new WaterParticle(spot.x, spot.y));
                    }
                }
            });

            // 履歴を更新
            updateSplashHistory(x, y);

            gameState.splashCount++;
            const baseCooling = 0.5 * diversityMultiplier;
            gameState.temperature -= baseCooling;
            gameState.score += Math.floor(10 * diversityMultiplier);

            // 温度の下限設定
            if (gameState.temperature < 15) {
                gameState.temperature = 15;
            }

            // 勝利条件チェック
            if (gameState.temperature <= 20 && !gameState.gameWon) {
                gameState.gameWon = true;
                setTimeout(() => {
                    alert('🎉 おめでとうございます！世界を涼しくしました！ 🎉');
                }, 500);
            }

            updateUI();
        }

        // イベントリスナーの追加
        canvas.addEventListener('click', handleInteraction);
        canvas.addEventListener('touchstart', handleInteraction);
        canvas.addEventListener('touchmove', handleInteraction);

        // UI更新
        function updateUI() {
            const currentTemp = Math.round(gameState.temperature);
            document.getElementById('temperature').textContent = currentTemp;
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('splashCount').textContent = gameState.splashCount;
            document.getElementById('diversityBonus').textContent = gameState.diversityBonus;
            
            // 顔文字を更新
            updateEmoticon(currentTemp);
            
            // 温度バーの更新
            const tempPercent = Math.max(0, Math.min(100, (gameState.temperature - 15) / 25 * 100));
            const barWidth = document.querySelector('.temperature-bar').offsetWidth;
            document.getElementById('tempIndicator').style.left = `${tempPercent * (barWidth - 4) / 100}px`;
            
            // 背景色の変更
            const hue = Math.max(200, 360 - (gameState.temperature - 15) * 8);
            document.body.style.background = `linear-gradient(to bottom, 
                hsl(${hue}, 70%, 50%) 0%, 
                hsl(${hue}, 50%, 70%) 50%, 
                hsl(${hue}, 30%, 85%) 100%)`;
        }

        // 描画関数
        function draw() {
            // 背景をクリア
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            const temp = gameState.temperature;
            if (temp > 30) {
                gradient.addColorStop(0, '#ff6b6b');
                gradient.addColorStop(1, '#ffa8a8');
            } else if (temp > 25) {
                gradient.addColorStop(0, '#ffd93d');
                gradient.addColorStop(1, '#ffe66d');
            } else {
                gradient.addColorStop(0, '#74b9ff');
                gradient.addColorStop(1, '#a7e6ff');
            }
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 熱スポットを描画
            gameState.heatSpots.forEach(spot => {
                if (!spot.cooled) {
                    const gradient = ctx.createRadialGradient(
                        spot.x, spot.y, 0,
                        spot.x, spot.y, spot.radius
                    );
                    gradient.addColorStop(0, `rgba(255, 100, 100, ${spot.intensity})`);
                    gradient.addColorStop(1, 'rgba(255, 100, 100, 0)');
                    
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(spot.x, spot.y, spot.radius, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    // 冷却されたスポット
                    const gradient = ctx.createRadialGradient(
                        spot.x, spot.y, 0,
                        spot.x, spot.y, spot.radius
                    );
                    gradient.addColorStop(0, 'rgba(100, 200, 255, 0.3)');
                    gradient.addColorStop(1, 'rgba(100, 200, 255, 0)');
                    
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(spot.x, spot.y, spot.radius, 0, Math.PI * 2);
                    ctx.fill();
                }
            });

            // パーティクルを描画
            gameState.particles.forEach(particle => {
                particle.draw();
            });

            // 勝利メッセージ
            if (gameState.gameWon) {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                ctx.fillRect(canvas.width / 2 - 200, canvas.height / 2 - 50, 400, 100);
                ctx.fillStyle = '#0066cc';
                ctx.font = 'bold 24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('🎉 世界が涼しくなりました！ 🎉', canvas.width / 2, canvas.height / 2);
            }
        }

        // ゲームループ
        function gameLoop() {
            // パーティクルの更新
            gameState.particles.forEach(particle => particle.update());
            gameState.particles = gameState.particles.filter(particle => !particle.isDead());

            // 時間経過による温度上昇
            if (gameState.splashCount > 0 && !gameState.gameWon) {
                gameState.temperature += 0.02;
                if (gameState.temperature > 40) {
                    gameState.temperature = 40;
                }
            }

            draw();
            updateUI();
            requestAnimationFrame(gameLoop);
        }

        // ゲーム初期化
        initHeatSpots();
        updateUI();
        gameLoop();
    </script>
</body>
</html>