<!--
AI Model: OpenAI Codex CLI Assistant
Codex CLI Version: 2025-09-02
Created: 2025-09-02
User Prompt: æ–°ã—ã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œã‚Šã€ãã“ã«HTMLã§æç«œå¤§å›³é‘‘ã‚’ä½œã£ã¦ãã ã•ã„ã€‚ã‚²ãƒ¼ãƒ è¦ç´ ãªã©ã‚¨ãƒ³ã‚¿ãƒ¡æ€§ã‚’ãŸãã•ã‚“å…¥ã‚Œè¾¼ã‚“ã§ãã ã•ã„
AI Approach: Single-file, no deps, multiple mini-games (quiz, dig, audio)
Implementation Intent: Fun-first encyclopedia with unlockables and localStorage
-->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æç«œå¤§å›³é‘‘ - ã‚¨ãƒ³ã‚¿ãƒ¡æº€è¼‰</title>
  <style>
    :root{
      --bg:#0b1d26;
      --panel:#0f2732;
      --accent:#ffcf33;
      --accent2:#69e6a6;
      --text:#e6f2f7;
      --muted:#9fb7c1;
      --danger:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", Meiryo, sans-serif;
      color:var(--text);
      background: radial-gradient(1200px 600px at 80% -10%, #12394a 0%, #0d2633 40%, var(--bg) 70%) fixed, url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="140" height="140"><text x="10" y="90" font-size="100">ğŸ¦–</text></svg>');
      background-blend-mode: overlay;
    }
    header{
      display:flex;gap:16px;align-items:center;justify-content:space-between;
      padding:14px 16px;position:sticky;top:0;z-index:10;
      background: linear-gradient(180deg, rgba(11,29,38,.95), rgba(11,29,38,.7));
      backdrop-filter:saturate(1.2) blur(6px);
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .title{display:flex;gap:10px;align-items:center}
    .title .logo{font-size:28px}
    .title h1{font-size:18px;margin:0 0 2px 0;letter-spacing:.02em}
    .title p{margin:0;color:var(--muted);font-size:12px}
    nav{display:flex;gap:8px;flex-wrap:wrap}
    nav button{
      background:var(--panel);color:var(--text);border:1px solid rgba(255,255,255,.08);
      padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600;
    }
    nav button.active{outline:2px solid var(--accent);background:linear-gradient(180deg,#143545,#0f2a36)}
    main{max-width:1200px;margin:16px auto;padding:0 16px 80px}
    .panel{
      background:linear-gradient(180deg, rgba(15,39,50,.9), rgba(10,29,38,.9));
      border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
    .card{
      background:#0f2632;border:1px solid rgba(255,255,255,.07);border-radius:14px;padding:12px;position:relative;overflow:hidden
    }
    .badge{position:absolute;top:8px;right:8px;background:var(--accent2);color:#063b25;font-weight:800;font-size:11px;padding:2px 8px;border-radius:999px}
    .dino-emoji{font-size:48px;filter:drop-shadow(0 4px 10px rgba(0,0,0,.3))}
    .muted{color:var(--muted)}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    input,select{
      background:#0f2632;color:var(--text);border:1px solid rgba(255,255,255,.1);
      padding:8px 10px;border-radius:10px
    }
    .cta{background:var(--accent);color:#2b2200;font-weight:900;border:none;padding:10px 14px;border-radius:12px;cursor:pointer}
    .cta.secondary{background:#2fd0f6;color:#072933}
    .statbar{height:8px;background:#0c2130;border:1px solid rgba(255,255,255,.08);border-radius:999px;overflow:hidden}
    .statbar>div{height:100%;background:linear-gradient(90deg,#ffcf33,#ff8f33)}

    /* Tabs */
    section{display:none;margin-top:14px}
    section.active{display:block}

    /* Quiz */
    .quiz-q{font-size:18px;margin:8px 0}
    .choices{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .choice{background:#113244;border:1px solid rgba(255,255,255,.08);padding:10px;border-radius:10px;cursor:pointer}
    .choice.correct{outline:2px solid #65f0a6}
    .choice.wrong{outline:2px solid var(--danger)}

    /* Dig */
    #digWrap{position:relative}
    #digCanvas{width:100%;max-width:800px;border-radius:12px;border:1px solid rgba(255,255,255,.08);display:block}
    .dig-ui{position:absolute;inset:auto 12px 12px 12px;display:flex;gap:8px}
    .progress{min-width:160px;background:#0c2130;border:1px solid rgba(255,255,255,.08);border-radius:10px;overflow:hidden}
    .progress>div{height:18px;background:linear-gradient(90deg,#69e6a6,#2fd0f6)}

    /* Runner */
    #runnerCanvas{width:100%;max-width:900px;height:160px;background:#0f2430;border:1px solid rgba(255,255,255,.07);border-radius:10px}
    .keyhint{font-size:12px;color:var(--muted)}

    /* Achievements */
    .achv{display:inline-flex;align-items:center;gap:8px;background:#123447;border:1px solid rgba(255,255,255,.08);padding:6px 10px;border-radius:999px;margin:4px 6px 0 0}
    .achv.lock{opacity:.6;filter:grayscale(1)}
  </style>
</head>
<body>
  <header>
    <div class="title">
      <div class="logo">ğŸ¦–</div>
      <div>
        <h1>æç«œå¤§å›³é‘‘ - ã‚¨ãƒ³ã‚¿ãƒ¡æº€è¼‰</h1>
        <p class="muted">å›³é‘‘ Ã— ã‚¯ã‚¤ã‚º Ã— ç™ºæ˜ Ã— ãƒ©ãƒ³ãƒŠãƒ¼ Ã— ã‚µã‚¦ãƒ³ãƒ‰</p>
      </div>
    </div>
    <nav>
      <button data-tab="encyc" class="active">å›³é‘‘</button>
      <button data-tab="quiz">ã‚¯ã‚¤ã‚º</button>
      <button data-tab="dig">åŒ–çŸ³ç™ºæ˜</button>
      <button data-tab="runner">ãƒ€ãƒƒã‚·ãƒ¥</button>
      <button data-tab="roar">é³´ãå£°ãƒ©ãƒœ</button>
      <button data-tab="badges">ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</button>
    </nav>
  </header>
  <main>
    <div class="panel row" style="justify-content:space-between">
      <div class="row">
        <label>æ¤œç´¢ <input id="search" placeholder="åå‰ãƒ»æ™‚ä»£ãƒ»ç‰¹å¾´ã§æ¤œç´¢"/></label>
        <label>æ™‚ä»£ 
          <select id="filter-era">
            <option value="">ã™ã¹ã¦</option>
            <option>ä¸‰ç•³ç´€</option>
            <option>ã‚¸ãƒ¥ãƒ©ç´€</option>
            <option>ç™½äºœç´€</option>
          </select>
        </label>
        <label>å±æ€§ 
          <select id="filter-diet">
            <option value="">ã™ã¹ã¦</option>
            <option>è‰é£Ÿ</option>
            <option>è‚‰é£Ÿ</option>
            <option>é›‘é£Ÿ</option>
          </select>
        </label>
      </div>
      <div class="row">
        <button class="cta" id="shuffle">ä»Šæ—¥ã®ãŠã™ã™ã‚</button>
        <button class="cta secondary" id="surprise">ã‚µãƒ—ãƒ©ã‚¤ã‚º!</button>
      </div>
    </div>

    <!-- Encyclopedia -->
    <section id="encyc" class="active">
      <div class="grid" id="cards"></div>
    </section>

    <!-- Quiz -->
    <section id="quiz">
      <div class="panel">
        <div class="row" style="justify-content:space-between">
          <div>ã‚¹ã‚³ã‚¢: <b id="score">0</b> / é€£ç¶šæ­£è§£: <b id="streak">0</b></div>
          <div class="keyhint">ãƒ’ãƒ³ãƒˆ: æ™‚é–“åˆ¶é™ãªã—ã€‚è½ã¡ç€ã„ã¦é¸ã¼ã†ã€‚</div>
        </div>
        <hr style="border-color:rgba(255,255,255,.06)"/>
        <div class="quiz-q" id="quizQ">å•é¡ŒãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
        <div class="choices" id="choices"></div>
        <div class="row" style="margin-top:10px">
          <button class="cta" id="nextQ">æ¬¡ã®å•é¡Œ</button>
          <button class="cta secondary" id="resetQ">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
      </div>
    </section>

    <!-- Dig -->
    <section id="dig">
      <div class="panel">
        <div class="row" style="justify-content:space-between;align-items:flex-end">
          <div>
            <div style="font-weight:800">åŒ–çŸ³ç™ºæ˜ãƒŸãƒ‹ã‚²ãƒ¼ãƒ </div>
            <div class="muted">ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ç ‚ã‚’æ‰•ã„ã€éª¨æ ¼ã‚’è¦‹ã¤ã‘ã‚ˆã†ï¼ˆ70%ã§ç™ºè¦‹ï¼‰ã€‚</div>
          </div>
          <div class="row">
            ãƒ–ãƒ©ã‚·: <input type="range" id="brush" min="8" max="60" value="28"/>
            <button class="cta" id="resetDig">åŸ‹ã‚æˆ»ã™</button>
          </div>
        </div>
        <div id="digWrap" style="margin-top:10px">
          <canvas id="digCanvas" width="900" height="480"></canvas>
          <div class="dig-ui">
            <div class="progress"><div id="digProg" style="width:0%"></div></div>
            <button class="cta" id="newFossil">åˆ¥ã®åŒ–çŸ³</button>
            <div id="digStatus" class="muted"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Runner -->
    <section id="runner">
      <div class="panel">
        <div class="row" style="justify-content:space-between;align-items:flex-end">
          <div>
            <div style="font-weight:800">ã‚¸ãƒ¥ãƒ©ç´€ãƒ€ãƒƒã‚·ãƒ¥</div>
            <div class="muted">ã‚¹ãƒšãƒ¼ã‚¹ã§ã‚¸ãƒ£ãƒ³ãƒ—ã€‚éšœå®³ç‰©ã‚’é¿ã‘ã¦ã‚¹ã‚³ã‚¢ã‚’ä¼¸ã°ãã†ã€‚</div>
          </div>
          <div class="row">ã‚¹ã‚³ã‚¢: <b id="runScore">0</b></div>
        </div>
        <canvas id="runnerCanvas" width="900" height="160"></canvas>
        <div class="keyhint">ã‚¹ãƒãƒ›ã¯ã‚¿ãƒƒãƒ—ã§ã‚¸ãƒ£ãƒ³ãƒ—</div>
        <div class="row" style="margin-top:8px">
          <button class="cta" id="runStart">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
          <button class="cta secondary" id="runStop">ã‚¹ãƒˆãƒƒãƒ—</button>
        </div>
      </div>
    </section>

    <!-- Roar Lab -->
    <section id="roar">
      <div class="panel">
        <div class="row" style="justify-content:space-between;align-items:flex-end">
          <div>
            <div style="font-weight:800">é³´ãå£°ãƒ©ãƒœ</div>
            <div class="muted">åˆæˆã‚µã‚¦ãƒ³ãƒ‰ã‚’è´ã„ã¦æç«œã‚’å½“ã¦ã‚ˆã†ï¼ˆãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³æ¨å¥¨ï¼‰ã€‚</div>
          </div>
          <button class="cta" id="playRoar">é³´ãå£°å†ç”Ÿ</button>
        </div>
        <div id="roarQ" class="quiz-q" style="margin-top:6px">ã“ã®é³´ãå£°ã®ä¸»ã¯ï¼Ÿ</div>
        <div class="choices" id="roarChoices"></div>
        <div id="roarResult" class="muted" style="margin-top:8px"></div>
      </div>
    </section>

    <!-- Badges -->
    <section id="badges">
      <div class="panel">
        <div style="font-weight:800">ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ / å®Ÿç¸¾</div>
        <div id="badgeList" style="margin-top:6px"></div>
      </div>
    </section>
  </main>

  <script>
    // ---------- Data ----------
    const DINOS = [
      { id:'trex',      name:'ãƒ†ã‚£ãƒ©ãƒã‚µã‚¦ãƒ«ã‚¹', era:'ç™½äºœç´€', diet:'è‚‰é£Ÿ', size:12, weight:8000, emoji:'ğŸ¦–', trivia:'åã¯ã€Œæš´å›ãƒˆã‚«ã‚²ã€ã€‚å™›ã‚€åŠ›ã¯æœ€å¼·ã‚¯ãƒ©ã‚¹ã€‚' },
      { id:'velo',      name:'ãƒ´ã‚§ãƒ­ã‚­ãƒ©ãƒ—ãƒˆãƒ«', era:'ç™½äºœç´€', diet:'è‚‰é£Ÿ', size:2,  weight:15,   emoji:'ğŸ¦–', trivia:'å®Ÿã¯å°å‹ã§ç¾½æ¯›ãŒã‚ã£ãŸèª¬ãŒæœ‰åŠ›ã€‚' },
      { id:'tricera',   name:'ãƒˆãƒªã‚±ãƒ©ãƒˆãƒ—ã‚¹',   era:'ç™½äºœç´€', diet:'è‰é£Ÿ', size:9,  weight:6000, emoji:'ğŸ¦•', trivia:'3æœ¬ã®è§’ã¨å¤§ããªãƒ•ãƒªãƒ«ãŒç‰¹å¾´ã€‚' },
      { id:'brachio',   name:'ãƒ–ãƒ©ã‚­ã‚ªã‚µã‚¦ãƒ«ã‚¹', era:'ã‚¸ãƒ¥ãƒ©ç´€', diet:'è‰é£Ÿ', size:25, weight:30000,emoji:'ğŸ¦•', trivia:'å‰è„šãŒé•·ãã€é¦–ã‚’é«˜ãä¸Šã’ã¦æ¡é£Ÿã€‚' },
      { id:'stego',     name:'ã‚¹ãƒ†ã‚´ã‚µã‚¦ãƒ«ã‚¹',   era:'ã‚¸ãƒ¥ãƒ©ç´€', diet:'è‰é£Ÿ', size:9,  weight:3000, emoji:'ğŸ¦•', trivia:'èƒŒä¸­ã®æ¿ã¯ä½“æ¸©èª¿ç¯€ã‚„å¨åš‡ã«å½¹ç«‹ã£ãŸã€‚' },
      { id:'ankyl',     name:'ã‚¢ãƒ³ã‚­ãƒ­ã‚µã‚¦ãƒ«ã‚¹', era:'ç™½äºœç´€', diet:'è‰é£Ÿ', size:8,  weight:6000, emoji:'ğŸ¦•', trivia:'å°¾ã®ãƒãƒ³ãƒãƒ¼ã§æ•é£Ÿè€…ã«åæ’ƒã€‚' },
      { id:'spino',     name:'ã‚¹ãƒ”ãƒã‚µã‚¦ãƒ«ã‚¹',   era:'ç™½äºœç´€', diet:'è‚‰é£Ÿ', size:15, weight:7000, emoji:'ğŸ¦–', trivia:'èƒŒä¸­ã®å¸†ã¨åŠæ°´ç”Ÿã®ç”Ÿæ´»ã§çŸ¥ã‚‰ã‚Œã‚‹ã€‚' },
      { id:'allo',      name:'ã‚¢ãƒ­ã‚µã‚¦ãƒ«ã‚¹',     era:'ã‚¸ãƒ¥ãƒ©ç´€', diet:'è‚‰é£Ÿ', size:9,  weight:2000, emoji:'ğŸ¦–', trivia:'ç¾¤ã‚Œã§ç‹©ã‚Šã‚’ã—ãŸå¯èƒ½æ€§ãŒã‚ã‚‹ã€‚' },
      { id:'para',      name:'ãƒ‘ãƒ©ã‚µã‚¦ãƒ­ãƒ­ãƒ•ã‚¹', era:'ç™½äºœç´€', diet:'è‰é£Ÿ', size:10, weight:2500, emoji:'ğŸ¦•', trivia:'é ­ã®é•·ã„ãƒˆã‚µã‚«ã§éŸ³ã‚’å…±é³´ã•ã›ãŸèª¬ã€‚' },
      { id:'iguan',     name:'ã‚¤ã‚°ã‚¢ãƒãƒ‰ãƒ³',     era:'ç™½äºœç´€', diet:'è‰é£Ÿ', size:10, weight:3500, emoji:'ğŸ¦•', trivia:'è¦ªæŒ‡ã®ã¨ã’ã¯é˜²å¾¡ã‚„æ¡é£Ÿã«ä½¿ç”¨ã€‚' },
      { id:'compy',     name:'ã‚³ãƒ³ãƒ—ã‚½ã‚°ãƒŠãƒˆã‚¥ã‚¹', era:'ã‚¸ãƒ¥ãƒ©ç´€', diet:'è‚‰é£Ÿ', size:1.2,weight:3,    emoji:'ğŸ¦–', trivia:'å°å‹ã§ç´ æ—©ã„ãƒãƒ³ã‚¿ãƒ¼ã€‚' },
      { id:'plateo',    name:'ãƒ—ãƒ©ãƒ†ã‚ªã‚µã‚¦ãƒ«ã‚¹', era:'ä¸‰ç•³ç´€', diet:'è‰é£Ÿ', size:9,  weight:4000, emoji:'ğŸ¦•', trivia:'åˆæœŸã®å¤§å‹è‰é£Ÿæç«œã®ã²ã¨ã¤ã€‚' },

      // --- ç¦äº•çœŒã§ç™ºè¦‹ã•ã‚ŒãŸæç«œï¼ˆç™½äºœç´€å‰æœŸï¼‰ ---
      { id:'fukuiraptor', name:'ãƒ•ã‚¯ã‚¤ãƒ©ãƒ—ãƒˆãƒ«',   era:'ç™½äºœç´€', diet:'è‚‰é£Ÿ', size:4.5, weight:600, emoji:'ğŸ¦–', trivia:'ç¦äº•çœŒå‹å±±å¸‚ãƒ»åŒ—è°·å±¤ã§ç™ºè¦‹ã€‚ä¸­å‹ã®ç£è„šé¡ã§é‹­ã„çˆªãŒç‰¹å¾´ã€‚' },
      { id:'fukuisaurus', name:'ãƒ•ã‚¯ã‚¤ã‚µã‚¦ãƒ«ã‚¹',   era:'ç™½äºœç´€', diet:'è‰é£Ÿ', size:5.0, weight:700, emoji:'ğŸ¦•', trivia:'ç¦äº•çœŒç”£ã®é³¥è„šé¡ã€‚ãã¡ã°ã—çŠ¶ã®å£ã§æ¤ç‰©ã‚’é£Ÿã¹ãŸã¨è€ƒãˆã‚‰ã‚Œã‚‹ã€‚' },
      { id:'fukuititan',  name:'ãƒ•ã‚¯ã‚¤ãƒ†ã‚£ã‚¿ãƒ³',   era:'ç™½äºœç´€', diet:'è‰é£Ÿ', size:10,  weight:12000,emoji:'ğŸ¦•', trivia:'ç¦äº•çœŒã§è¦‹ã¤ã‹ã£ãŸç«œè„šé¡ã€‚é•·ã„é¦–ã¨å°¾ã‚’ã‚‚ã¤å¤§å‹è‰é£Ÿæç«œã€‚' },
      { id:'fukuivenator',name:'ãƒ•ã‚¯ã‚¤ãƒ´ã‚§ãƒŠãƒˆãƒ«', era:'ç™½äºœç´€', diet:'é›‘é£Ÿ', size:2.5, weight:25,  emoji:'ğŸ¦–', trivia:'å°å‹ã®ç£è„šé¡ã€‚å¤šæ§˜ãªç‰¹å¾´ã‚’ä½µã›æŒã¤â€œè¬ã‚ã„ãŸâ€æç«œã¨ã—ã¦çŸ¥ã‚‰ã‚Œã‚‹ï¼ˆç¦äº•çœŒï¼‰ã€‚' },
      { id:'koshisaurus', name:'ã‚³ã‚·ã‚µã‚¦ãƒ«ã‚¹',     era:'ç™½äºœç´€', diet:'è‰é£Ÿ', size:4.0, weight:150, emoji:'ğŸ¦•', trivia:'ã€Œè¶Šï¼ˆã“ã—ï¼‰ã€ã«ç”±æ¥ã™ã‚‹åã€‚ç¦äº•çœŒå‹å±±å¸‚ã®åœ°å±¤ã‹ã‚‰å ±å‘Šã•ã‚ŒãŸå°å‹é³¥è„šé¡ã€‚' },
      { id:'tyrannomimus',name:'ãƒ†ã‚£ãƒ©ãƒãƒŸãƒ ã‚¹',   era:'ç™½äºœç´€', diet:'é›‘é£Ÿ', size:2.8, weight:40,  emoji:'ğŸ¦–', trivia:'ãƒ†ã‚£ãƒ©ãƒã‚µã‚¦ãƒ«ã‚¹é¡ã«è¿‘ç¸ãªèµ°é³¥é¡ã¨è€ƒãˆã‚‰ã‚Œã‚‹æ–°å±æ–°ç¨®ï¼ˆç¦äº•çœŒï¼‰ã€‚' },
    ];

    // ---------- Tabs ----------
    document.querySelectorAll('nav button').forEach(btn=>{
      btn.addEventListener('click',()=>{
        document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'))
        btn.classList.add('active')
        const tab = btn.dataset.tab
        document.querySelectorAll('main section').forEach(s=>s.classList.toggle('active', s.id===tab))
      })
    })

    // ---------- Encyclopedia rendering ----------
    const $cards = document.getElementById('cards')
    const $search = document.getElementById('search')
    const $era = document.getElementById('filter-era')
    const $diet = document.getElementById('filter-diet')

    function renderCards(){
      const q = ($search.value||'').toLowerCase()
      const e = $era.value
      const d = $diet.value
      const filtered = DINOS.filter(x=>
        (!e || x.era===e) && (!d || x.diet===d) &&
        (x.name.includes($search.value) || x.era.includes($search.value) || x.trivia.includes($search.value) || x.id.includes(q))
      )
      $cards.innerHTML = filtered.map(x=>`<div class="card">
        <span class="badge">${x.era}</span>
        <div class="dino-emoji" aria-hidden="true">${x.emoji}</div>
        <div style="font-weight:800">${x.name}</div>
        <div class="muted" style="font-size:12px">${x.diet}ãƒ»å…¨é•·ç´„${x.size}m</div>
        <div class="statbar" style="margin:8px 0"><div style="width:${Math.min(100, x.size*4)}%"></div></div>
        <details>
          <summary>è©³ç´°</summary>
          <div style="font-size:13px">${x.trivia}</div>
        </details>
        <div class="row" style="margin-top:8px">
          <button class="cta" onclick="startQuizWith('${x.id}')">ã“ã®æç«œã§ã‚¯ã‚¤ã‚º</button>
          <button class="cta secondary" onclick="unlockBadge('view_${x.id}','${x.name}ã‚’è©³ã—ãè¦‹ãŸ')">ãŠæ°—ã«å…¥ã‚Š</button>
        </div>
      </div>`).join('')
    }
    [$search,$era,$diet].forEach(el=>el.addEventListener('input',renderCards))
    document.getElementById('shuffle').onclick=()=>{
      $search.value = ''
      $era.selectedIndex = 0
      $diet.selectedIndex = 0
      DINOS.sort(()=>Math.random()-.5)
      renderCards()
      toast('ä»Šæ—¥ã®ãŠã™ã™ã‚ã‚’æ›´æ–°ï¼')
    }
    document.getElementById('surprise').onclick=()=>{
      const d = DINOS[Math.floor(Math.random()*DINOS.length)]
      toast(`ä»Šæ—¥ã¯ã€Œ${d.name}ã€ã®æ—¥ï¼`)
      unlockBadge('surprise','ã‚µãƒ—ãƒ©ã‚¤ã‚ºã‚’ä½¿ã£ãŸ')
    }

    // ---------- Quiz ----------
    const $quizQ = document.getElementById('quizQ')
    const $choices = document.getElementById('choices')
    const $score = document.getElementById('score')
    const $streak = document.getElementById('streak')
    let score=0, streak=0, quizAnswer=null, quizLock=false

    function mkChoices(items, answer){
      $choices.innerHTML = ''
      items.forEach(txt=>{
        const div = document.createElement('div')
        div.className='choice'
        div.textContent=txt
        div.onclick=()=>{
          if(quizLock) return
          quizLock=true
          if(txt===answer){
            div.classList.add('correct')
            score++; streak++; $score.textContent=score; $streak.textContent=streak
            unlockBadge('quiz_correct','ã‚¯ã‚¤ã‚ºæ­£è§£ï¼')
            if(streak>=5) unlockBadge('quiz_streak5','é€£ç¶šæ­£è§£5')
            ping('#69e6a6')
          }else{
            div.classList.add('wrong')
            streak=0; $streak.textContent=streak
            ping('#ff6b6b')
          }
        }
        $choices.appendChild(div)
      })
    }

    function nextQuiz(){
      quizLock=false
      const mode = Math.random()<.5 ? 'era' : 'diet'
      const d = DINOS[Math.floor(Math.random()*DINOS.length)]
      if(mode==='era'){
        $quizQ.textContent = `${d.name} ãŒç”ŸããŸæ™‚ä»£ã¯ï¼Ÿ`
        const pool = ['ä¸‰ç•³ç´€','ã‚¸ãƒ¥ãƒ©ç´€','ç™½äºœç´€','ãƒšãƒ«ãƒ ç´€','ãƒ‡ãƒœãƒ³ç´€','æ–°ç”Ÿä»£']
        const set = new Set([d.era])
        while(set.size < 4){
          const pick = pool[Math.floor(Math.random()*pool.length)]
          set.add(pick)
        }
        const opts = [...set]
        mkChoices(shuffle(opts), d.era)
      }else{
        $quizQ.textContent = `${d.name} ã®é£Ÿæ€§ã¯ï¼Ÿ`
        const opts = Array.from(new Set([d.diet,'è‰é£Ÿ','è‚‰é£Ÿ','é›‘é£Ÿ']))
        mkChoices(shuffle(opts), d.diet)
      }
    }
    document.getElementById('nextQ').onclick=nextQuiz
    document.getElementById('resetQ').onclick=()=>{score=0;streak=0;$score.textContent=0;$streak.textContent=0;nextQuiz()}
    function startQuizWith(id){
      const d = DINOS.find(x=>x.id===id)
      document.querySelector('nav button[data-tab="quiz"]').click()
      $quizQ.textContent = `${d.name} ã®ãƒˆãƒªãƒ“ã‚¢ã¯ã©ã‚Œï¼Ÿ`
      const wrongs = shuffle(DINOS.filter(x=>x.id!==id)).slice(0,3).map(x=>x.trivia)
      mkChoices(shuffle([d.trivia, ...wrongs]), d.trivia)
    }

    // ---------- Dig game (scratch) ----------
    const digCanvas = document.getElementById('digCanvas')
    const g = digCanvas.getContext('2d')
    const $digProg = document.getElementById('digProg')
    const $digStatus = document.getElementById('digStatus')
    let digging=false, brush=28
    document.getElementById('brush').oninput=(e)=>brush=+e.target.value

    const fossils = [
      (ctx,w,h)=>{ // Triceratops skull style
        ctx.strokeStyle='#ffd966';ctx.lineWidth=3;ctx.lineCap='round'
        ctx.beginPath(); ctx.arc(w*0.35,h*0.55,w*0.18,Math.PI*.2,Math.PI*1.7); ctx.stroke()
        ctx.beginPath(); ctx.moveTo(w*0.42,h*0.55); ctx.lineTo(w*0.55,h*0.45); ctx.lineTo(w*0.62,h*0.5); ctx.stroke()
        // horns
        tri(w*.33,h*.48,w*.29,h*.35)
        tri(w*.40,h*.50,w*.36,h*.38)
        // frill plates
        for(let i=0;i<7;i++){tri(w*(.26+i*.03),h*.58,w*(.25+i*.03),h*.64)}
        function tri(x1,y1,x2,y2){ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke()}
      },
      (ctx,w,h)=>{ // T-rex skull
        ctx.strokeStyle='#ffd966';ctx.lineWidth=3;ctx.lineCap='round'
        ctx.beginPath(); ctx.moveTo(w*.2,h*.6); ctx.quadraticCurveTo(w*.45,h*.35,w*.7,h*.5); ctx.stroke()
        ctx.beginPath(); ctx.moveTo(w*.22,h*.63); ctx.quadraticCurveTo(w*.48,h*.6,w*.75,h*.62); ctx.stroke()
        for(let i=0;i<9;i++){ctx.beginPath();ctx.moveTo(w*(.35+i*.04),h*.59);ctx.lineTo(w*(.34+i*.04),h*.64);ctx.stroke()}
      },
      (ctx,w,h)=>{ // Stegosaurus plates & vertebrae
        ctx.strokeStyle='#ffd966';ctx.lineWidth=3
        for(let i=0;i<8;i++){ctx.beginPath();ctx.moveTo(w*(.2+i*.1),h*.55);ctx.lineTo(w*(.25+i*.1),h*.45);ctx.stroke()}
        ctx.beginPath();ctx.moveTo(w*.18,h*.65);ctx.lineTo(w*.85,h*.65);ctx.stroke()
      }
    ]
    let fossilIndex=0
    function drawFossil(){
      const w=digCanvas.width,h=digCanvas.height
      // background rock
      g.fillStyle='#0b1f29';g.fillRect(0,0,w,h)
      // light gradient
      const grd = g.createLinearGradient(0,0,0,h)
      grd.addColorStop(0,'#0d2732');grd.addColorStop(1,'#0a1d26')
      g.fillStyle=grd;g.fillRect(0,0,w,h)
      fossils[fossilIndex](g,w,h)
    }
    function bury(){
      drawFossil()
      // sand layer
      g.globalCompositeOperation='source-over'
      const w=digCanvas.width,h=digCanvas.height
      g.fillStyle='rgba(222, 193, 137, 0.94)'
      g.fillRect(0,0,w,h)
      g.fillStyle='rgba(140,110,70,0.12)'
      for(let i=0;i<200;i++) g.fillRect(Math.random()*w,Math.random()*h,2,2)
      g.globalCompositeOperation='destination-out'
      updateProgress()
      $digStatus.textContent=''
    }
    function scratch(x,y){
      g.beginPath();g.arc(x,y,brush,0,Math.PI*2);g.fill()
    }
    function updateProgress(){
      // estimate cleared area by sampling
      const {width:w,height:h}=digCanvas
      const data = g.getImageData(0,0,w,h).data
      // in destination-out mode, cleared pixels are transparent -> alpha==0
      let transparent=0, total=w*h
      for(let i=3;i<data.length;i+=4){ if(data[i]===0) transparent++ }
      const ratio = Math.min(100, Math.round((transparent/total)*100))
      $digProg.style.width=ratio+'%'
      if(ratio>=70){
        $digStatus.textContent='ç™ºè¦‹ï¼ æ–°ã—ã„åŒ–çŸ³ã‚«ãƒ¼ãƒ‰ã‚’è§£æ”¾ã—ãŸï¼'
        unlockBadge('dig_found','åŒ–çŸ³ã‚’ç™ºè¦‹ã—ãŸ')
      }
    }
    digCanvas.addEventListener('pointerdown',e=>{digging=true; const r=digCanvas.getBoundingClientRect(); scratch(e.clientX-r.left, e.clientY-r.top)})
    window.addEventListener('pointerup',()=>digging=false)
    digCanvas.addEventListener('pointermove',e=>{ if(!digging) return; const r=digCanvas.getBoundingClientRect(); scratch(e.clientX-r.left, e.clientY-r.top); if(Math.random()<.2) updateProgress() })
    document.getElementById('resetDig').onclick=bury
    document.getElementById('newFossil').onclick=()=>{ fossilIndex=(fossilIndex+1)%fossils.length; bury(); unlockBadge('dig_new','åˆ¥ã®åŒ–çŸ³ã«æŒ‘æˆ¦') }

    // ---------- Runner ----------
    const runnerCanvas = document.getElementById('runnerCanvas')
    const rg = runnerCanvas.getContext('2d')
    let runTimer=null, playerY=0, vel=0, grav=0.9, onGround=true, obstacles=[], runScore=0
    const groundY = runnerCanvas.height-28
    function runReset(){
      playerY = groundY-24; vel=0; onGround=true; obstacles=[]; runScore=0; document.getElementById('runScore').textContent=0
      rg.clearRect(0,0,runnerCanvas.width,runnerCanvas.height)
      drawGround()
      drawDino()
    }
    function drawGround(){
      rg.strokeStyle='rgba(255,255,255,.15)'; rg.beginPath(); rg.moveTo(0,groundY+12); rg.lineTo(runnerCanvas.width,groundY+12); rg.stroke()
    }
    function drawDino(){
      // simple t-rex box with tail and head
      const x=80,y=playerY
      rg.fillStyle='#69e6a6'; rg.fillRect(x,y,32,24)
      rg.fillRect(x+26,y-6,12,10) // head
      rg.fillRect(x-14,y+6,14,6) // tail
    }
    function addObstacle(){
      const h = 20 + Math.floor(Math.random()*30)
      obstacles.push({x:runnerCanvas.width, w:10, h})
    }
    function step(){
      // physics
      vel += grav; playerY += vel
      if(playerY>groundY-24){ playerY=groundY-24; vel=0; onGround=true }
      // move obs
      obstacles.forEach(o=>o.x-=6)
      if(Math.random()<.03) addObstacle()
      obstacles = obstacles.filter(o=>o.x>-20)
      // collide
      const px=80, py=playerY, pw=32, ph=24
      for(const o of obstacles){
        if(px < o.x+o.w && px+pw > o.x && py+ph > groundY-o.h){ gameOver(); return }
      }
      runScore++; document.getElementById('runScore').textContent = runScore
      if(runScore===200) unlockBadge('runner200','ãƒ©ãƒ³ãƒŠãƒ¼ã§ã‚¹ã‚³ã‚¢200')
      // draw
      rg.fillStyle='#0f2430'; rg.fillRect(0,0,runnerCanvas.width,runnerCanvas.height)
      drawGround(); drawDino()
      rg.fillStyle='#ffcf33'; obstacles.forEach(o=>rg.fillRect(o.x, groundY-o.h, o.w, o.h))
      runTimer = requestAnimationFrame(step)
    }
    function jump(){ if(onGround){ vel=-15; onGround=false } }
    function gameOver(){ cancelAnimationFrame(runTimer); runTimer=null; ping('#ff6b6b'); unlockBadge('runner_try','ãƒ©ãƒ³ãƒŠãƒ¼ã§éŠã‚“ã '); toast('ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼ ã‚¹ã‚³ã‚¢ '+runScore) }
    document.getElementById('runStart').onclick=()=>{ if(runTimer) return; runReset(); runTimer=requestAnimationFrame(step) }
    document.getElementById('runStop').onclick=()=>{ if(!runTimer) return; cancelAnimationFrame(runTimer); runTimer=null }
    window.addEventListener('keydown',e=>{ if(e.code==='Space'){ e.preventDefault(); jump() } })
    runnerCanvas.addEventListener('pointerdown',jump)

    // ---------- Roar Lab (WebAudio) ----------
    const AudioCtx = window.AudioContext || window.webkitAudioContext
    let actx=null
    const ROARS = {
      trex: { name:'ãƒ†ã‚£ãƒ©ãƒã‚µã‚¦ãƒ«ã‚¹', pattern:[{t:0, type:'noise', dur:.5, gain:1.2},{t:.5,type:'saw',freq:70,dur:.6,gain:.6}] },
      para: { name:'ãƒ‘ãƒ©ã‚µã‚¦ãƒ­ãƒ­ãƒ•ã‚¹', pattern:[{t:0,type:'sine',freq:220,dur:1.2,gain:.6, slide:-120}] },
      velo: { name:'ãƒ´ã‚§ãƒ­ã‚­ãƒ©ãƒ—ãƒˆãƒ«', pattern:[{t:0,type:'noise',dur:.12,gain:.6},{t:.14,type:'square',freq:600,dur:.25,gain:.4}] }
    }
    let roarAnswer='trex'
    function playPattern(p){
      if(!actx) actx = new AudioCtx()
      const now = actx.currentTime
      const master = actx.createGain(); master.gain.value=0.3; master.connect(actx.destination)
      p.forEach(ev=>{
        const t = now + ev.t
        if(ev.type==='noise'){
          const buf = actx.createBuffer(1, actx.sampleRate*ev.dur, actx.sampleRate)
          const ch = buf.getChannelData(0)
          for(let i=0;i<ch.length;i++) ch[i] = (Math.random()*2-1)*0.4
          const src = actx.createBufferSource(); src.buffer=buf
          const g = actx.createGain(); g.gain.value=ev.gain
          src.connect(g); g.connect(master)
          src.start(t)
        }else{
          const osc = actx.createOscillator(); osc.type=ev.type
          const g = actx.createGain(); g.gain.value=ev.gain
          osc.connect(g); g.connect(master)
          const freq = ev.freq||120
          osc.frequency.setValueAtTime(freq, t)
          if(ev.slide){ osc.frequency.linearRampToValueAtTime(freq+ev.slide, t+ev.dur) }
          osc.start(t); osc.stop(t+ev.dur)
        }
      })
    }
    function newRoarQuestion(){
      const keys = Object.keys(ROARS)
      roarAnswer = keys[Math.floor(Math.random()*keys.length)]
      const opts = shuffle(keys).slice(0,3)
      if(!opts.includes(roarAnswer)) opts[0]=roarAnswer
      const names = opts.map(k=>ROARS[k].name)
      renderRoarChoices(names, ROARS[roarAnswer].name)
    }
    function renderRoarChoices(names, ans){
      const $rc = document.getElementById('roarChoices')
      $rc.innerHTML=''
      names.forEach(n=>{
        const div=document.createElement('div'); div.className='choice'; div.textContent=n
        div.onclick=()=>{
          if(n===ans){ div.classList.add('correct'); unlockBadge('roar_ok','é³´ãå£°ã‚’å½“ã¦ãŸ'); ping('#69e6a6') }
          else { div.classList.add('wrong'); ping('#ff6b6b') }
        }
        $rc.appendChild(div)
      })
      document.getElementById('roarResult').textContent='å†ç”Ÿã—ã¦ã‹ã‚‰ç­”ãˆã‚ˆã†ï¼'
    }
    document.getElementById('playRoar').onclick=()=>{ playPattern(ROARS[roarAnswer].pattern); unlockBadge('roar_play','é³´ãå£°ã‚’è´ã„ãŸ') }

    // ---------- Badges ----------
    const $badgeList = document.getElementById('badgeList')
    const BADGES = {
      view_trex: 'ãƒ†ã‚£ãƒ©ãƒã‚’è©³ã—ãè¦‹ãŸ',
      quiz_correct: 'ã‚¯ã‚¤ã‚ºã«æ­£è§£ã—ãŸ',
      quiz_streak5: 'é€£ç¶šæ­£è§£5',
      dig_found: 'åŒ–çŸ³ã‚’ç™ºè¦‹ã—ãŸ',
      dig_new: 'åˆ¥ã®åŒ–çŸ³ã«æŒ‘æˆ¦',
      runner_try: 'ãƒ©ãƒ³ãƒŠãƒ¼ã§éŠã‚“ã ',
      runner200: 'ãƒ©ãƒ³ãƒŠãƒ¼200ç‚¹',
      roar_play: 'é³´ãå£°ã‚’è´ã„ãŸ',
      roar_ok: 'é³´ãå£°ã‚’å½“ã¦ãŸ',
      surprise: 'ã‚µãƒ—ãƒ©ã‚¤ã‚ºãƒœã‚¿ãƒ³'
    }
    function loadBadges(){
      const set = JSON.parse(localStorage.getItem('dino_badges')||'[]')
      renderBadges(set)
    }
    function renderBadges(set){
      $badgeList.innerHTML = Object.entries(BADGES).map(([k,label])=>{
        const unlocked = set.includes(k)
        const icon = unlocked ? 'ğŸ†' : 'ğŸ”’'
        return `<span class="achv ${unlocked?'':'lock'}">${icon} ${label}</span>`
      }).join('')
    }
    function unlockBadge(key,label){
      const set = new Set(JSON.parse(localStorage.getItem('dino_badges')||'[]'))
      set.add(key)
      localStorage.setItem('dino_badges', JSON.stringify([...set]))
      renderBadges([...set])
      if(label) toast('å®Ÿç¸¾è§£é™¤: '+label)
    }

    // ---------- Utils ----------
    function shuffle(a){ return a.map(v=>[Math.random(),v]).sort((x,y)=>x[0]-y[0]).map(x=>x[1]) }
    function toast(msg){
      const d=document.createElement('div')
      d.textContent=msg
      d.style.cssText='position:fixed;left:50%;top:12px;transform:translateX(-50%);background:#123447;color:#e6f2f7;border:1px solid rgba(255,255,255,.15);padding:8px 12px;border-radius:999px;z-index:99;box-shadow:0 8px 20px rgba(0,0,0,.25)'
      document.body.appendChild(d)
      setTimeout(()=>{ d.style.transition='all .3s'; d.style.opacity='0'; d.style.transform='translateX(-50%) translateY(-10px)'; },1200)
      setTimeout(()=>d.remove(),1600)
    }
    function ping(color){
      const d=document.createElement('div')
      d.style.cssText=`position:fixed;inset:0;background:${color}22;pointer-events:none;z-index:98`
      document.body.appendChild(d); setTimeout(()=>d.remove(),120)
    }

    // ---------- Init ----------
    function init(){
      renderCards(); nextQuiz(); runReset(); bury(); newRoarQuestion(); loadBadges()
    }
    init()
  </script>
</body>
</html>
