<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂõõÂ≠óÁÜüË™û„Éë„Ç∫„É´„Ç≤„Éº„É†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'MS Gothic', 'Yu Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .score-board {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
        }

        .score-item {
            text-align: center;
        }

        .score-label {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .score-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }

        .problem-area {
            margin-bottom: 30px;
        }

        .problem-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #333;
        }

        .answer-slots {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        .answer-slot {
            width: 80px;
            height: 80px;
            border: 3px dashed #ccc;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            background: #f9f9f9;
            transition: all 0.3s ease;
            position: relative;
        }

        .answer-slot.filled {
            border: 3px solid #4CAF50;
            background: #e8f5e8;
            color: #333;
        }

        .answer-slot.correct {
            border: 3px solid #4CAF50;
            background: #c8e6c8;
            animation: correctPulse 0.6s ease-in-out;
            transform: scale(1.1);
        }

        .answer-slot.incorrect {
            border: 3px solid #f44336;
            background: #ffcdd2;
            animation: incorrectShake 0.6s ease-in-out;
        }

        @keyframes correctPulse {
            0% { transform: scale(1); background: #e8f5e8; }
            50% { transform: scale(1.15); background: #4CAF50; color: white; }
            100% { transform: scale(1.1); background: #c8e6c8; color: #333; }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #4CAF50;
            animation: confetti-fall 3s ease-out forwards;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: firework 1s ease-out forwards;
        }

        @keyframes firework {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            50% {
                transform: scale(1);
                opacity: 0.8;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        .answer-slot.drop-zone {
            border-color: #667eea;
            background: #e3f2fd;
            transform: scale(1.05);
        }

        .kanji-options {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .kanji-card {
            width: 70px;
            height: 70px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .kanji-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }

        .kanji-card.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .kanji-card.used {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .btn-primary {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #f44336, #da190b);
            color: white;
        }

        .btn-info {
            background: linear-gradient(45deg, #2196F3, #0b7dda);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(10px);
        }

        .feedback.show {
            opacity: 1;
            transform: translateY(0);
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .meaning {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
            font-weight: normal;
        }

        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .popup-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .popup-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            transform: scale(0.8) translateY(50px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .popup-overlay.show .popup-content {
            transform: scale(1) translateY(0);
        }

        .popup-content.correct {
            border: 4px solid #4CAF50;
        }

        .popup-content.incorrect {
            border: 4px solid #f44336;
        }

        .popup-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s ease;
        }

        .popup-content.correct::before {
            animation: shimmer 2s ease-in-out;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .popup-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: popIcon 0.6s ease-out;
        }

        .popup-icon.correct {
            color: #4CAF50;
        }

        .popup-icon.incorrect {
            color: #f44336;
        }

        @keyframes popIcon {
            0% { transform: scale(0) rotate(-180deg); }
            50% { transform: scale(1.2) rotate(0deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .popup-title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .popup-word {
            font-size: 3rem;
            font-weight: bold;
            margin: 20px 0;
            letter-spacing: 8px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: wordGlow 2s ease-in-out infinite alternate;
        }

        @keyframes wordGlow {
            0% { filter: drop-shadow(0 0 5px rgba(102, 126, 234, 0.3)); }
            100% { filter: drop-shadow(0 0 15px rgba(102, 126, 234, 0.6)); }
        }

        .popup-meaning {
            font-size: 1.1rem;
            color: #666;
            line-height: 1.6;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .popup-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.5rem;
            color: #999;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .popup-close:hover {
            color: #333;
        }

        @media (max-width: 480px) {
            .game-container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .answer-slot {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }
            
            .kanji-card {
                width: 55px;
                height: 55px;
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ÂõõÂ≠óÁÜüË™û„Éë„Ç∫„É´</h1>
        <div class="subtitle">Êº¢Â≠ó„ÇíÊ≠£„Åó„ÅÑÈ†ÜÂ∫è„Åß‰∏¶„Åπ„Å¶ÂõõÂ≠óÁÜüË™û„ÇíÂÆåÊàê„Åï„Åõ„Çà„ÅÜÔºÅ</div>
        
        <div class="score-board">
            <div class="score-item">
                <div class="score-label">„Çπ„Ç≥„Ç¢</div>
                <div class="score-value" id="score">0</div>
            </div>
            <div class="score-item">
                <div class="score-label">ÂïèÈ°å</div>
                <div class="score-value" id="current-problem">1</div>
            </div>
            <div class="score-item">
                <div class="score-label">Ê≠£Ëß£Áéá</div>
                <div class="score-value" id="accuracy">0%</div>
            </div>
        </div>

        <div class="problem-area">
            <div class="problem-title">ÂõõÂ≠óÁÜüË™û„ÇíÂÆåÊàê„Åï„Åõ„Å¶„Åè„Å†„Åï„ÅÑ</div>
            <div class="answer-slots" id="answer-slots">
                <div class="answer-slot" data-position="0"></div>
                <div class="answer-slot" data-position="1"></div>
                <div class="answer-slot" data-position="2"></div>
                <div class="answer-slot" data-position="3"></div>
            </div>
        </div>

        <div class="kanji-options" id="kanji-options">
            <!-- Êº¢Â≠ó„Ç™„Éó„Ç∑„Éß„É≥„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Åæ„Åô -->
        </div>

        <div class="controls">
            <button class="btn btn-secondary" id="clear-btn">„ÇØ„É™„Ç¢</button>
            <button class="btn btn-info" id="hint-btn">„Éí„É≥„Éà</button>
        </div>

        <div class="feedback" id="feedback">
            <!-- „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
        </div>

        <!-- „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
        <div class="popup-overlay" id="popup-overlay">
            <div class="popup-content" id="popup-content">
                <div class="popup-close" id="popup-close">√ó</div>
                <div class="popup-icon" id="popup-icon"></div>
                <div class="popup-title" id="popup-title"></div>
                <div class="popup-word" id="popup-word"></div>
                <div class="popup-meaning" id="popup-meaning"></div>
            </div>
        </div>
    </div>

    <script>
        class YojijukugoGame {
            constructor() {
                this.problems = [
                    { word: "‰∏ÄÊúü‰∏Ä‰ºö", meaning: "‰∏ÄÁîü„Å´‰∏ÄÂ∫¶„Å†„Åë„ÅÆÊ©ü‰ºö„ÄÇ‰∫åÂ∫¶„Å®Áπ∞„ÇäËøî„Åô„Åì„Å®„ÅÆ„Å™„ÅÑÂá∫‰ºö„ÅÑ„ÄÇ" },
                    { word: "ÂõõÈù¢Ê•öÊ≠å", meaning: "Âë®Âõ≤„Åå„Åô„Åπ„Å¶Êïµ„ÇÑÂèçÂØæËÄÖ„Å´Âõ≤„Åæ„Çå„Å¶„ÄÅÂÖ®„ÅèÂë≥Êñπ„Åå„ÅÑ„Å™„ÅÑÁä∂Ê≥Å„ÄÇ" },
                    { word: "Ëá™Ê•≠Ëá™Âæó", meaning: "Ëá™ÂàÜ„ÅÆË°å„ÅÑ„ÅÆÁµêÊûú„ÇíËá™ÂàÜ„ÅåÂèó„Åë„Çã„Åì„Å®„ÄÇ" },
                    { word: "ÁôæËä±Áπö‰π±", meaning: "Êßò„ÄÖ„Å™Ëä±„ÅåÂí≤„Åç‰π±„Çå„Çã„Åì„Å®„ÄÇÂ§ö„Åè„ÅÆÂÑ™„Çå„Åü‰∫∫„ÇÑ‰ΩúÂìÅ„ÅåÂêåÊôÇ„Å´Áèæ„Çå„Çã„Åì„Å®„ÄÇ" },
                    { word: "Ê∏©ÊïÖÁü•Êñ∞", meaning: "Âè§„ÅÑ„Åì„Å®„ÇíÁ†îÁ©∂„Åó„Å¶„ÄÅÊñ∞„Åó„ÅÑÁü•Ë≠ò„ÇÑË¶ãËß£„ÇíÂæó„Çã„Åì„Å®„ÄÇ" },
                    { word: "ÂàáÁ£ãÁê¢Á£®", meaning: "Â≠¶Âïè„ÇÑÊäÄËä∏„Å™„Å©„Åß„ÄÅ„Åä‰∫í„ÅÑ„Å´Âä±„Åæ„ÅóÂêà„ÅÑÁ´∂„ÅÑÂêà„Å£„Å¶Âêë‰∏ä„Åô„Çã„Åì„Å®„ÄÇ" },
                    { word: "‰∏ÉËª¢ÂÖ´Ëµ∑", meaning: "‰ΩïÂ∫¶Â§±Êïó„Åó„Å¶„ÇÇ„Åè„Åò„Åë„Åö„Å´Á´ã„Å°‰∏ä„Åå„Çã„Åì„Å®„ÄÇ" },
                    { word: "ÂøÉÊ©ü‰∏ÄËª¢", meaning: "Ê∞óÊåÅ„Å°„ÇíÂÖ•„ÇåÊõø„Åà„Å¶Êñ∞„Åü„Å´Áâ©‰∫ã„Å´Âèñ„ÇäÁµÑ„ÇÄ„Åì„Å®„ÄÇ" },
                    { word: "Ë©¶Ë°åÈåØË™§", meaning: "Êßò„ÄÖ„Å™ÊñπÊ≥ï„ÇíË©¶„Åó„Å™„Åå„ÇâËß£Ê±∫Á≠ñ„ÇíË¶ã„Å§„Åë„Çã„Åì„Å®„ÄÇ" },
                    { word: "ÂçÉËºâ‰∏ÄÈÅá", meaning: "ÂçÉÂπ¥„Å´‰∏ÄÂ∫¶„ÅÆÊ©ü‰ºö„ÄÇÊªÖÂ§ö„Å´„Å™„ÅÑËâØ„ÅÑÊ©ü‰ºö„ÄÇ" },
                    { word: "ÁîªÁ´úÁÇπÁùõ", meaning: "Áâ©‰∫ã„ÇíÂÆåÊàê„Åï„Åõ„Çã„Åü„ÇÅ„ÅÆÊúÄÂæå„ÅÆÈáçË¶Å„Å™‰ªï‰∏ä„Åí„ÄÇ" },
                    { word: "Ëá•Ëñ™ÂòóËÉÜ", meaning: "ÁõÆÁöÑ„ÇíÈÅîÊàê„Åô„Çã„Åü„ÇÅ„Å´Ëã¶Âä¥„Å´ËÄê„ÅàÂøç„Å∂„Åì„Å®„ÄÇ" },
                    { word: "Ê´õÈ¢®Ê≤êÈõ®", meaning: "È¢®Èõ®„Å´„Åï„Çâ„Åï„Çå„Å™„Åå„ÇâËã¶Âä¥„Åô„Çã„Åì„Å®„ÄÇ" },
                    { word: "Áã°ÂÖéÊ≠ªËµ∞ÁãóÁÉπ", meaning: "Áî®Ê∏à„Åø„Å´„Å™„Å£„Åü„ÇÇ„ÅÆ„ÅØÊç®„Å¶„Çâ„Çå„Çã„Å®„ÅÑ„ÅÜ„Åì„Å®„ÄÇ" },
                    { word: "ËõçÈõ™‰πãÂäü", meaning: "Ëã¶Â≠¶„Åó„Å¶Â≠¶Âïè„Å´Âä±„ÇÄ„Åì„Å®„ÄÇ" },
                    { word: "ÁæäÈ†≠ÁãóËÇâ", meaning: "Ë¶ã„Åã„Åë„Å®ÂÆüÈöõ„ÅåÁï∞„Å™„Çã„Åì„Å®„ÄÇ" },
                    { word: "ÊùûÊÜÇÂ§©Â¢ú", meaning: "ÂøÉÈÖç„Åô„ÇãÂøÖË¶Å„ÅÆ„Å™„ÅÑ„Åì„Å®„ÇíÂøÉÈÖç„Åô„Çã„Åì„Å®„ÄÇ" },
                    { word: "ÂÆåÁíßÂ∏∞Ë∂ô", meaning: "Áâ©‰∫ã„ÇíÂÆåÂÖ®ÁÑ°Ê¨†„Å™Áä∂ÊÖã„ÅßÂÖÉ„Å´Êàª„Åô„Åì„Å®„ÄÇ" },
                    { word: "Êúù‰ª§ÊöÆÊîπ", meaning: "ÊñπÈáù„ÅåÈ†ªÁπÅ„Å´Â§â„Çè„Çã„Åì„Å®„ÄÇ" },
                    { word: "ÂõõÂÖ≠ÊôÇ‰∏≠", meaning: "‰∏ÄÊó•‰∏≠„ÄÅ„ÅÑ„Å§„Åß„ÇÇ„ÄÇ" },
                    { word: "ÁñëÂøÉÊöóÈ¨º", meaning: "Áñë„ÅÑ„ÅÆÂøÉ„ÇíÊåÅ„Å§„Å®‰Ωï„Åß„ÇÇÊÄñ„ÅèÊÄù„Åà„Çã„Åì„Å®„ÄÇ" },
                    { word: "ÊòéÈè°Ê≠¢Ê∞¥", meaning: "Êõá„Çä„ÅÆ„Å™„ÅÑÊæÑ„ÅøÂàá„Å£„ÅüÂøÉÂ¢É„ÄÇ" },
                    { word: "ÂëâË∂äÂêåËàü", meaning: "ÊïµÂêåÂ£´„ÅåÂêå„ÅòÂ†¥ÊâÄ„ÅßÂçîÂäõ„Åô„Çã„Åì„Å®„ÄÇ" },
                    { word: "ËôéË¶ñÁúà„ÄÖ", meaning: "Ê©ü‰ºö„Çí„ÅÜ„Åã„Åå„Å£„Å¶Áãô„Å£„Å¶„ÅÑ„Çã„Åì„Å®„ÄÇ" },
                    { word: "Á†¥ÈáúÊ≤àËàπ", meaning: "Ê±∫Ê≠ª„ÅÆË¶öÊÇü„Åß‰∫ã„Å´ÂΩì„Åü„Çã„Åì„Å®„ÄÇ" },
                    { word: "È≥≥ÊØõÈ∫üËßí", meaning: "ÈùûÂ∏∏„Å´Áèç„Åó„ÅèË≤¥Èáç„Å™„ÇÇ„ÅÆ„ÄÇ" },
                    { word: "ÂÖéÊ≠ªÁãóÁÉπ", meaning: "Áî®„ÅåÊ∏à„ÇÅ„Å∞Êç®„Å¶„Çâ„Çå„Çã„Åì„Å®„ÄÇ" },
                    { word: "ÁÆ°ÈÆë‰πã‰∫§", meaning: "Âà©ÂÆ≥„ÇíË∂Ö„Åà„ÅüÁúü„ÅÆÂèãÊÉÖ„ÄÇ" },
                    { word: "ÂàéÈ†∏‰πãÂèã", meaning: "È¶ñ„ÇíÂàé„Å≠„Çâ„Çå„Å¶„ÇÇÂæåÊÇî„Åó„Å™„ÅÑË¶™Âèã„ÄÇ" },
                    { word: "ËÜ†Êü±ÈºìÁëü", meaning: "ËûçÈÄö„ÅåÂà©„Åã„Åö„ÄÅÈ†ëÂõ∫„Å™„Åì„Å®„ÄÇ" },
                    { word: "È≠ëÈ≠ÖÈ≠çÈ≠é", meaning: "Êßò„ÄÖ„Å™Âåñ„ÅëÁâ©„ÄÇÂæó‰Ωì„ÅÆÁü•„Çå„Å™„ÅÑËÄÖ„Åü„Å°„ÄÇ" },
                    { word: "Á∏¶Ê®™ÁÑ°Â∞Ω", meaning: "ÊÄù„ÅÑ„ÅÆ„Åæ„Åæ„Å´Ëá™Áî±Ëá™Âú®„Å´Ë°å„ÅÜ„Åì„Å®„ÄÇ" },
                    { word: "Á¥Ü‰ΩôÊõ≤Êäò", meaning: "‰∫ãÊÉÖ„ÅåË§áÈõë„Åß„ÄÅ„ÅÑ„Çç„ÅÑ„Çç„Å®Â§âÂåñ„Åô„Çã„Åì„Å®„ÄÇ" },
                    { word: "Êä±Ëñ™ÊïëÁÅ´", meaning: "ÂÆ≥„ÇíÈô§„Åì„ÅÜ„Å®„Åó„Å¶„ÄÅ„Åã„Åà„Å£„Å¶ÂÆ≥„ÇíÂ§ß„Åç„Åè„Åô„Çã„Åì„Å®„ÄÇ" },
                    { word: "ËõçÁ™ìÈõ™Ê°à", meaning: "Ëã¶Â≠¶„Åô„Çã„Åì„Å®„ÄÇË≤ß„Åó„ÅÑ‰∏≠„Åß„ÇÇÂ≠¶Âïè„Å´Âä±„ÇÄ„Åì„Å®„ÄÇ" },
                    { word: "È∂èÈ≥¥ÁãóÁõó", meaning: "„Å§„Åæ„Çâ„Å™„ÅÑÊäÄËÉΩ„Åß„ÇÇ„ÄÅÊôÇ„Å´„ÅØÂΩπ„Å´Á´ã„Å§„Åì„Å®„ÄÇ" },
                    { word: "ÁãêÁñëÈÄ°Â∑°", meaning: "Áñë„ÅÑËø∑„Å£„Å¶„Åü„ÇÅ„Çâ„ÅÜ„Åì„Å®„ÄÇ" },
                    { word: "Á´úÈ†≠ËõáÂ∞æ", meaning: "Âàù„ÇÅ„ÅØÂã¢„ÅÑ„Åå„Çà„ÅÑ„Åå„ÄÅÁµÇ„Çè„Çä„ÅØÊåØ„Çã„Çè„Å™„ÅÑ„Åì„Å®„ÄÇ" },
                    { word: "ÈÖîÁîüÂ§¢Ê≠ª", meaning: "‰Ωï„ÇÇ„Åó„Å™„ÅÑ„Åß„ÄÅ„ÇÄ„Å™„Åó„Åè‰∏ÄÁîü„ÇíÈÅé„Åî„Åô„Åì„Å®„ÄÇ" },
                    { word: "ÈÇØÈÑ≤‰πãÂ§¢", meaning: "‰∫∫Áîü„ÅÆÊ†ÑËèØ„ÅÆ„ÅØ„Åã„Å™„ÅÑ„Åì„Å®„ÄÇ" },
                    { word: "Ê≥∞Â±±ÂåóÊñó", meaning: "„Åù„ÅÆÈÅì„ÅÆÁ¨¨‰∏Ä‰∫∫ËÄÖ„Å®„Åó„Å¶‰ª∞„Åå„Çå„Çã‰∫∫„ÄÇ" },
                    { word: "‰∏áÈáå‰∏ÄÁ©∫", meaning: "„Å©„Åì„Åæ„Åß„ÇÇÂêå„ÅòÈùíÁ©∫„ÅåÁ∂ö„Åè„Çà„ÅÜ„Å´„ÄÅÂøÉÂ¢É„Åå‰∏ÄÂÆö„Åó„Å¶„ÅÑ„Çã„Åì„Å®„ÄÇ" },
                    { word: "Â†ÖÂøç‰∏çÊäú", meaning: "„Åò„Å£„Å®ÊàëÊÖ¢„Åó„Å¶„ÄÅÊÑèÂøó„ÇíÊõ≤„Åí„Å™„ÅÑ„Åì„Å®„ÄÇ" },
                    { word: "ÂéöÈ°îÁÑ°ÊÅ•", meaning: "ÊÅ•Áü•„Çâ„Åö„ÅßÂõ≥„ÄÖ„Åó„ÅÑ„Åì„Å®„ÄÇ" },
                    { word: "Â≠§ËªçÂ•ÆÈóò", meaning: "Âä©„Åë„ÇÇ„Å™„Åè‰∏Ä‰∫∫„ÅßÂõ∞Èõ£„Å´Á´ã„Å°Âêë„Åã„ÅÜ„Åì„Å®„ÄÇ" },
                    { word: "Ë±™ËèØÁµ¢Áàõ", meaning: "„Åç„Çâ„Å≥„ÇÑ„Åã„ÅßÁæé„Åó„ÅÑ„Åì„Å®„ÄÇ" },
                    { word: "Á©∫ÂâçÁµ∂Âæå", meaning: "ÈÅéÂéª„Å´„ÇÇ„Å™„Åè„ÄÅÂ∞ÜÊù•„ÇÇ„Å™„ÅÑ„Åß„ÅÇ„Çç„ÅÜ„Åì„Å®„ÄÇ" },
                    { word: "Âçä‰ø°ÂçäÁñë", meaning: "‰ø°„Åò„ÇãÊ∞óÊåÅ„Å°„Å®Áñë„ÅÜÊ∞óÊåÅ„Å°„ÅåÂçäÂàÜ„Åö„Å§„ÅÇ„Çã„Åì„Å®„ÄÇ" },
                    { word: "Ê≥¢ÁÄæ‰∏á‰∏à", meaning: "Â§âÂåñ„ÅåÊøÄ„Åó„Åè„ÄÅÂäáÁöÑ„Å™„Åì„Å®„ÄÇ" },
                    { word: "ÁôæÊà¶Èå¨Á£®", meaning: "Â§ö„Åè„ÅÆÁµåÈ®ì„ÇíÁ©ç„Çì„ÅßËÖïÂâç„Åå‰∏ä„Åå„Çã„Åì„Å®„ÄÇ" },
                    { word: "È¢®ÊûóÁÅ´Â±±", meaning: "Êà¶Ë°ì„ÅÆÊ•µÊÑè„ÇíË°®„Åó„ÅüË®ÄËëâ„ÄÇ" },
                    { word: "Á≤âÈ™®Á†ïË∫´", meaning: "È™®Ë∫´„ÇíÊÉú„Åó„Åæ„ÅöÂä™Âäõ„Åô„Çã„Åì„Å®„ÄÇ" },
                    { word: "ÊÇ†ÊÇ†Ëá™ÈÅ©", meaning: "„ÅÆ„Çì„Å≥„Çä„Å®Ê∞ó„Åæ„Åæ„Å´ÈÅé„Åî„Åô„Åì„Å®„ÄÇ" },
                    { word: "ÈÖíÊ±†ËÇâÊûó", meaning: "Ë¥ÖÊ≤¢„ÅÆÈôê„Çä„ÇíÂ∞Ω„Åè„Åó„ÅüÈÅä„Å≥„ÄÇ" },
                    { word: "ÊîØÈõ¢ÊªÖË£Ç", meaning: "Áâ©‰∫ã„Å´‰∏ÄË≤´ÊÄß„Åå„Å™„Åè„ÄÅ„Å∞„Çâ„Å∞„Çâ„Å™„Åì„Å®„ÄÇ" },
                    { word: "ÈáùÂ∞èÊ£íÂ§ß", meaning: "Â∞è„Åï„Å™„Åì„Å®„ÇíÂ§ß„Åí„Åï„Å´Ë®Ä„ÅÜ„Åì„Å®„ÄÇ" },
                    { word: "ËàåÂÖà‰∏âÂØ∏", meaning: "Âè£ÂÖà„Å†„Åë„ÅÆÂ∑ß„Åø„Å™Ë©±Ë°ì„ÄÇ" },
                    { word: "Ê≤πÊñ≠Â§ßÊïµ", meaning: "Ê≥®ÊÑè„ÇíÊÄ†„Çã„Å®Â§±Êïó„ÅÆÂéüÂõ†„Å®„Å™„Çã„Åì„Å®„ÄÇ" },
                    { word: "ËÄÅËã•Áî∑Â•≥", meaning: "Âπ¥ÈΩ¢„ÇÑÊÄßÂà•„Å´Èñ¢‰øÇ„Å™„Åè„ÄÅ„Åô„Åπ„Å¶„ÅÆ‰∫∫„ÄÇ" },
                    { word: "ÂíåÊ∞óËóπ„ÄÖ", meaning: "„Å™„Åî„ÇÑ„Åã„ÅßË¶™„Åó„Åø„ÇÑ„Åô„ÅÑÈõ∞Âõ≤Ê∞ó„ÄÇ" },
                    { word: "Ë°åÈõ≤ÊµÅÊ∞¥", meaning: "Ëá™ÁÑ∂„Å´Âæì„Å£„Å¶Ë°åÂãï„Åô„Çã„Åì„Å®„ÄÇ" },
                    { word: "Â§úÈÉéËá™Â§ß", meaning: "Ëá™ÂàÜ„ÅÆÂäõÈáè„ÇíÁü•„Çâ„Åö„Å´Â®ÅÂºµ„Çã„Åì„Å®„ÄÇ" }
                ];
                
                this.currentProblem = 0;
                this.score = 0;
                this.correctAnswers = 0;
                this.totalAttempts = 0;
                this.userAnswer = ['', '', '', ''];
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.loadProblem();
                this.updateScoreboard();
            }

            setupEventListeners() {
                const clearBtn = document.getElementById('clear-btn');
                const hintBtn = document.getElementById('hint-btn');
                const popupClose = document.getElementById('popup-close');
                const popupOverlay = document.getElementById('popup-overlay');

                clearBtn.addEventListener('click', () => this.clearAnswer());
                hintBtn.addEventListener('click', () => this.showHint());
                
                // „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÇíÈñâ„Åò„Çã
                popupClose.addEventListener('click', () => this.hidePopup());
                popupOverlay.addEventListener('click', (e) => {
                    if (e.target === popupOverlay) {
                        this.hidePopup();
                    }
                });

                // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó„ÅÆ„Ç§„Éô„É≥„ÉàË®≠ÂÆö
                this.setupDragAndDrop();
            }

            setupDragAndDrop() {
                const slots = document.querySelectorAll('.answer-slot');
                
                slots.forEach(slot => {
                    slot.addEventListener('dragover', this.handleDragOver);
                    slot.addEventListener('drop', (e) => this.handleDrop(e));
                    slot.addEventListener('dragenter', this.handleDragEnter);
                    slot.addEventListener('dragleave', this.handleDragLeave);
                });
            }

            loadProblem() {
                const problem = this.problems[this.currentProblem];
                const characters = problem.word.split('');
                
                // Á≠î„Åà„Çπ„É≠„ÉÉ„Éà„Çí„ÇØ„É™„Ç¢
                this.clearAnswer();
                
                // Êº¢Â≠ó„Ç™„Éó„Ç∑„Éß„É≥„ÇíÁîüÊàêÔºàÊ≠£Ëß£„ÅÆÊñáÂ≠ó + „ÉÄ„Éü„ÉºÊñáÂ≠óÔºâ
                const dummyChars = ['ÂøÉ', 'Áâ©', '‰∫ã', '‰∫∫', 'ÊôÇ', 'Êúà', 'Êó•', 'Âπ¥', 'Êâã', 'Ë∂≥', 'ÁõÆ', 'ËÄ≥', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü', 'Â±±', 'Â∑ù', 'Êµ∑', 'Á©∫', 'Èõ≤', 'Êòü', 'ÂÖâ', 'ÂΩ±', 'Â£∞', 'Èü≥', 'Ëâ≤', 'Ëä±', 'È≥•', 'È¢®', 'Èõ™'];
                const allChars = [...characters];
                
                // „ÉÄ„Éü„ÉºÊñáÂ≠ó„Çí4„Å§ËøΩÂä†
                while (allChars.length < 8) {
                    const randomDummy = dummyChars[Math.floor(Math.random() * dummyChars.length)];
                    if (!allChars.includes(randomDummy)) {
                        allChars.push(randomDummy);
                    }
                }
                
                // „Ç∑„É£„ÉÉ„Éï„É´
                allChars.sort(() => Math.random() - 0.5);
                
                this.renderKanjiOptions(allChars);
                this.hideFeedback();
            }

            renderKanjiOptions(characters) {
                const container = document.getElementById('kanji-options');
                container.innerHTML = '';
                
                characters.forEach((char, index) => {
                    const card = document.createElement('div');
                    card.className = 'kanji-card';
                    card.textContent = char;
                    card.draggable = true;
                    card.dataset.char = char;
                    
                    card.addEventListener('dragstart', (e) => this.handleDragStart(e));
                    card.addEventListener('dragend', (e) => this.handleDragEnd(e));
                    card.addEventListener('click', () => this.handleKanjiClick(char));
                    
                    container.appendChild(card);
                });
            }

            handleDragStart(e) {
                e.dataTransfer.setData('text/plain', e.target.dataset.char);
                e.target.classList.add('dragging');
            }

            handleDragEnd(e) {
                e.target.classList.remove('dragging');
            }

            handleDragOver(e) {
                e.preventDefault();
            }

            handleDragEnter(e) {
                e.preventDefault();
                e.target.classList.add('drop-zone');
            }

            handleDragLeave(e) {
                e.target.classList.remove('drop-zone');
            }

            handleDrop(e) {
                e.preventDefault();
                e.target.classList.remove('drop-zone');
                
                const char = e.dataTransfer.getData('text/plain');
                const position = parseInt(e.target.dataset.position);
                
                this.placeCharacter(char, position);
            }

            handleKanjiClick(char) {
                // Á©∫„ÅÑ„Å¶„ÅÑ„ÇãÊúÄÂàù„ÅÆ„Çπ„É≠„ÉÉ„Éà„Å´ÈÖçÁΩÆ
                const emptySlot = this.userAnswer.findIndex(slot => slot === '');
                if (emptySlot !== -1) {
                    this.placeCharacter(char, emptySlot);
                }
            }

            placeCharacter(char, position) {
                // „Åô„Åß„Å´‰ΩøÁî®Ê∏à„Åø„ÅÆÊñáÂ≠ó„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                const kanjiCard = document.querySelector(`[data-char="${char}"]:not(.used)`);
                if (!kanjiCard) return;
                
                // Êó¢„Å´„Åù„ÅÆ‰ΩçÁΩÆ„Å´ÊñáÂ≠ó„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„ÄÅ„Åù„ÅÆÊñáÂ≠ó„ÇíÊàª„Åô
                if (this.userAnswer[position] !== '') {
                    this.removeCharacterFromSlot(position);
                }
                
                this.userAnswer[position] = char;
                kanjiCard.classList.add('used');
                
                const slot = document.querySelector(`[data-position="${position}"]`);
                slot.textContent = char;
                slot.classList.add('filled');
                
                // 4ÊñáÂ≠ó„Åô„Åπ„Å¶ÈÅ∏Êäû„Åï„Çå„ÅüÂ†¥Âêà„ÄÅËá™ÂãïÁöÑ„Å´Ê≠£Ë™§Âà§ÂÆö
                if (this.userAnswer.every(char => char !== '')) {
                    setTimeout(() => {
                        this.checkAnswer();
                    }, 500); // Â∞ë„ÅóÈÅÖÂª∂„Åï„Åõ„Å¶Ëá™ÁÑ∂„Å™ÊÑü„Åò„Å´
                }
            }

            removeCharacterFromSlot(position) {
                const char = this.userAnswer[position];
                if (char) {
                    const kanjiCard = document.querySelector(`[data-char="${char}"].used`);
                    if (kanjiCard) {
                        kanjiCard.classList.remove('used');
                    }
                    
                    this.userAnswer[position] = '';
                    const slot = document.querySelector(`[data-position="${position}"]`);
                    slot.textContent = '';
                    slot.classList.remove('filled');
                }
            }

            clearAnswer() {
                this.userAnswer = ['', '', '', ''];
                
                document.querySelectorAll('.answer-slot').forEach(slot => {
                    slot.textContent = '';
                    slot.classList.remove('filled', 'correct', 'incorrect');
                });
                
                document.querySelectorAll('.kanji-card').forEach(card => {
                    card.classList.remove('used');
                });
                
                this.hideFeedback();
            }

            checkAnswer() {
                const userWord = this.userAnswer.join('');
                const correctWord = this.problems[this.currentProblem].word;
                
                this.totalAttempts++;
                
                if (userWord === correctWord) {
                    this.correctAnswers++;
                    this.score += 100;
                    this.playCorrectAnimation();
                    
                    // Ê≠£Ëß£„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÇíË°®Á§∫
                    setTimeout(() => {
                        this.showPopup(true, correctWord, this.problems[this.currentProblem].meaning);
                    }, 800);
                    
                    setTimeout(() => {
                        this.nextProblem();
                    }, 4000);
                } else {
                    this.playIncorrectAnimation();
                    
                    // ‰∏çÊ≠£Ëß£„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÇíË°®Á§∫
                    setTimeout(() => {
                        this.showPopup(false, correctWord, this.problems[this.currentProblem].meaning);
                    }, 800);
                    
                    // ‰∏çÊ≠£Ëß£„ÅÆÂ†¥Âêà„ÅØ5ÁßíÂæå„Å´„É™„Çª„ÉÉ„Éà
                    setTimeout(() => {
                        this.clearAnswer();
                    }, 5000);
                }
                
                this.updateScoreboard();
            }

            showPopup(isCorrect, word, meaning) {
                const overlay = document.getElementById('popup-overlay');
                const content = document.getElementById('popup-content');
                const icon = document.getElementById('popup-icon');
                const title = document.getElementById('popup-title');
                const wordElement = document.getElementById('popup-word');
                const meaningElement = document.getElementById('popup-meaning');
                
                // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíË®≠ÂÆö
                if (isCorrect) {
                    icon.textContent = 'üéâ';
                    icon.className = 'popup-icon correct';
                    title.textContent = 'Ê≠£Ëß£ÔºÅ';
                    content.className = 'popup-content correct';
                } else {
                    icon.textContent = 'üòî';
                    icon.className = 'popup-icon incorrect';
                    title.textContent = '‰∏çÊ≠£Ëß£...';
                    content.className = 'popup-content incorrect';
                }
                
                wordElement.textContent = word;
                meaningElement.textContent = meaning;
                
                // „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÇíË°®Á§∫
                overlay.classList.add('show');
                
                // 3ÁßíÂæå„Å´Ëá™Âãï„ÅßÈñâ„Åò„Çã
                setTimeout(() => {
                    this.hidePopup();
                }, 3000);
            }

            hidePopup() {
                const overlay = document.getElementById('popup-overlay');
                overlay.classList.remove('show');
            }

            playCorrectAnimation() {
                // „Çπ„É≠„ÉÉ„Éà„Å´„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÇíËøΩÂä†
                const slots = document.querySelectorAll('.answer-slot');
                slots.forEach(slot => {
                    slot.classList.add('correct');
                });
                
                // Á¥ôÂêπÈõ™„Ç®„Éï„Çß„ÇØ„Éà
                this.createConfetti();
                
                // Ëä±ÁÅ´„Ç®„Éï„Çß„ÇØ„Éà
                this.createFireworks();
                
                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÁµÇ‰∫ÜÂæå„Å´„ÇØ„É©„Çπ„ÇíÂâäÈô§
                setTimeout(() => {
                    slots.forEach(slot => {
                        slot.classList.remove('correct');
                    });
                }, 600);
            }

            playIncorrectAnimation() {
                const slots = document.querySelectorAll('.answer-slot');
                slots.forEach(slot => {
                    slot.classList.add('incorrect');
                });
                
                setTimeout(() => {
                    slots.forEach(slot => {
                        slot.classList.remove('incorrect');
                    });
                }, 600);
            }

            createConfetti() {
                const colors = ['#4CAF50', '#2196F3', '#FF9800', '#E91E63', '#9C27B0'];
                const container = document.querySelector('.game-container');
                
                for (let i = 0; i < 50; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 2 + 's';
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    
                    container.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 4000);
                }
            }

            createFireworks() {
                const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4'];
                const container = document.querySelector('.game-container');
                
                for (let i = 0; i < 20; i++) {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.style.left = Math.random() * 100 + '%';
                    firework.style.top = Math.random() * 50 + '%';
                    firework.style.background = colors[Math.floor(Math.random() * colors.length)];
                    firework.style.animationDelay = Math.random() * 0.5 + 's';
                    
                    container.appendChild(firework);
                    
                    setTimeout(() => {
                        firework.remove();
                    }, 1500);
                }
            }

            showHint() {
                const problem = this.problems[this.currentProblem];
                const firstChar = problem.word[0];
                
                // ÊúÄÂàù„ÅÆÊñáÂ≠ó„Çí„Éí„É≥„Éà„Å®„Åó„Å¶ÈÖçÁΩÆ
                if (this.userAnswer[0] === '') {
                    this.placeCharacter(firstChar, 0);
                    this.showFeedback(false, `„Éí„É≥„Éà: ÊúÄÂàù„ÅÆÊñáÂ≠ó„ÅØ„Äå${firstChar}„Äç„Åß„Åô`, '');
                } else {
                    this.showFeedback(false, `„Éí„É≥„Éà: „Åì„ÅÆÂõõÂ≠óÁÜüË™û„ÅÆÊÑèÂë≥„ÅØ„Äå${problem.meaning}„Äç`, '');
                }
            }

            showFeedback(isCorrect, message, meaning) {
                const feedback = document.getElementById('feedback');
                feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'} show`;
                feedback.innerHTML = `
                    ${message}
                    ${meaning ? `<div class="meaning">${meaning}</div>` : ''}
                `;
            }

            hideFeedback() {
                const feedback = document.getElementById('feedback');
                feedback.classList.remove('show');
            }

            nextProblem() {
                this.currentProblem = (this.currentProblem + 1) % this.problems.length;
                this.loadProblem();
                this.updateScoreboard();
            }

            updateScoreboard() {
                document.getElementById('score').textContent = this.score;
                document.getElementById('current-problem').textContent = this.currentProblem + 1;
                
                const accuracy = this.totalAttempts > 0 ? 
                    Math.round((this.correctAnswers / this.totalAttempts) * 100) : 0;
                document.getElementById('accuracy').textContent = `${accuracy}%`;
            }
        }

        // „Ç≤„Éº„É†ÈñãÂßã
        document.addEventListener('DOMContentLoaded', () => {
            new YojijukugoGame();
        });
    </script>
</body>
</html>