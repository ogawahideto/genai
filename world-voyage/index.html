<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ „Éì„ÇØ„Éà„É™„Ç¢Âè∑„Ç¢„Éâ„Éô„É≥„ÉÅ„É£„Éº - ‰∏ñÁïå‰∏ÄÂë®„Ç≤„Éº„É† üéÆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            overflow-x: hidden;
        }

        .header {
            text-align: center;
            padding: 20px;
            background: rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        /* „Ç≤„Éº„É†Ë¶ÅÁ¥†„ÅÆ„Çπ„Çø„Ç§„É´ */
        .game-stats {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #FFD700;
            min-width: 200px;
            z-index: 25;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 14px;
        }

        .stat-value {
            color: #FFD700;
            font-weight: bold;
        }

        .weather-indicator {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2em;
            z-index: 20;
            animation: weatherFloat 3s ease-in-out infinite;
        }

        @keyframes weatherFloat {
            0%, 100% { transform: translateX(-50%) translateY(0px); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }

        .treasure {
            position: absolute;
            font-size: 16px;
            z-index: 10;
            cursor: pointer;
            animation: treasureGlow 2s ease-in-out infinite alternate;
        }

        @keyframes treasureGlow {
            0% { transform: scale(1) rotate(0deg); }
            100% { transform: scale(1.2) rotate(10deg); }
        }

        .event-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            border: 3px solid #FF6B6B;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            z-index: 30;
            display: none;
            max-width: 400px;
            animation: popupBounce 0.5s ease-out;
        }

        @keyframes popupBounce {
            0% { transform: translate(-50%, -50%) scale(0.1); }
            80% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .event-popup h3 {
            color: #FF6B6B;
            margin-bottom: 15px;
        }

        .choice-btn {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .choice-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .achievement-toast {
            position: fixed;
            top: -100px;
            right: 20px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 20px;
            border-radius: 25px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: top 0.5s ease;
            z-index: 35;
            font-weight: bold;
        }

        .achievement-toast.show {
            top: 20px;
        }

        .mini-game-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 40;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .mini-game-content {
            background: rgba(255,255,255,0.1);
            border: 3px solid #FFD700;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
        }

        .wind-effect {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            animation: windSweep 4s linear infinite;
            opacity: 0;
        }

        .wind-effect.active {
            opacity: 1;
        }

        @keyframes windSweep {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .floating-points {
            position: absolute;
            font-size: 18px;
            font-weight: bold;
            color: #FFD700;
            pointer-events: none;
            animation: floatUp 2s ease-out forwards;
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-50px); }
        }

        .world-map-container {
            position: relative;
            width: 100%;
            height: 70vh;
            background: linear-gradient(to bottom, #87CEEB, #4682B4);
            border: 3px solid #8B4513;
            margin: 20px 0;
        }

        .world-map {
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 30%, #228B22 2px, transparent 2px),
                radial-gradient(circle at 60% 20%, #228B22 1px, transparent 1px),
                radial-gradient(circle at 80% 60%, #228B22 3px, transparent 3px),
                radial-gradient(circle at 15% 80%, #228B22 2px, transparent 2px),
                radial-gradient(circle at 85% 75%, #228B22 1px, transparent 1px),
                radial-gradient(circle at 40% 70%, #228B22 2px, transparent 2px);
            background-size: 100px 100px, 150px 150px, 120px 120px, 180px 180px, 90px 90px, 110px 110px;
            position: relative;
        }

        .continent {
            position: absolute;
            background: #8B4513;
            border-radius: 20px;
        }

        .europe {
            top: 20%;
            left: 45%;
            width: 8%;
            height: 12%;
        }

        .africa {
            top: 35%;
            left: 48%;
            width: 6%;
            height: 20%;
            border-radius: 15px 15px 5px 5px;
        }

        .asia {
            top: 15%;
            left: 60%;
            width: 20%;
            height: 25%;
            border-radius: 30px;
        }

        .americas {
            top: 20%;
            left: 15%;
            width: 15%;
            height: 40%;
            border-radius: 25px;
        }

        .australia {
            top: 60%;
            left: 70%;
            width: 8%;
            height: 8%;
            border-radius: 50%;
        }

        .route-point {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #FFD700;
            border: 2px solid #FFA500;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .route-point:hover {
            width: 16px;
            height: 16px;
            background: #FF6B6B;
            transform: scale(1.2);
        }

        .route-point.active {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }

        .ship {
            position: absolute;
            font-size: 20px;
            z-index: 15;
            transition: all 2s ease-in-out;
        }

        .route-line {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, transparent, #FFD700, transparent);
            transform-origin: left center;
            opacity: 0.8;
            z-index: 5;
        }

        .info-panel {
            position: fixed;
            top: 50%;
            right: -350px;
            transform: translateY(-50%);
            width: 320px;
            height: 400px;
            background: rgba(0,0,0,0.9);
            border: 2px solid #FFD700;
            border-radius: 10px;
            padding: 20px;
            transition: right 0.5s ease;
            z-index: 20;
        }

        .info-panel.show {
            right: 20px;
        }

        .info-panel h3 {
            color: #FFD700;
            margin-bottom: 15px;
            border-bottom: 1px solid #FFD700;
            padding-bottom: 5px;
        }

        .controls {
            text-align: center;
            padding: 20px;
        }

        .btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
            border: none;
            padding: 12px 24px;
            margin: 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .progress-bar {
            width: 80%;
            height: 10px;
            background: rgba(255,255,255,0.3);
            border-radius: 5px;
            margin: 20px auto;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFD700, #FFA500);
            width: 0%;
            transition: width 0.5s ease;
        }

        .date-display {
            text-align: center;
            font-size: 1.5em;
            margin: 20px;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            .info-panel {
                width: 90%;
                right: -100%;
                top: 10%;
                transform: none;
                height: 70%;
            }
            
            .info-panel.show {
                right: 5%;
            }

            .game-stats {
                position: relative;
                margin: 10px;
                width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéÆ „Éì„ÇØ„Éà„É™„Ç¢Âè∑„Ç¢„Éâ„Éô„É≥„ÉÅ„É£„Éº üåç</h1>
        <p>Âè≤‰∏äÊúÄ„ÇÇÂç±Èô∫„ÅßÂ£ÆÂ§ß„Å™ÂÜíÈô∫„Å´ÊåëÊà¶„Åó„Çà„ÅÜÔºÅ</p>
    </div>

    <!-- „Ç≤„Éº„É†Áµ±Ë®à„Éë„Éç„É´ -->
    <div class="game-stats">
        <div class="stat-item">
            <span>üèÜ „Çπ„Ç≥„Ç¢:</span>
            <span class="stat-value" id="score">0</span>
        </div>
        <div class="stat-item">
            <span>‚öì ‰πóÁµÑÂì°:</span>
            <span class="stat-value" id="crew">270</span>
        </div>
        <div class="stat-item">
            <span>üçû È£üÊñô:</span>
            <span class="stat-value" id="food">100</span>%
        </div>
        <div class="stat-item">
            <span>üí∞ Ë≥áÈáë:</span>
            <span class="stat-value" id="money">1000</span>
        </div>
        <div class="stat-item">
            <span>üèñÔ∏è ÂäüÁ∏æ:</span>
            <span class="stat-value" id="achievements">0</span>/15
        </div>
    </div>

    <div class="date-display">
        <span id="currentDate">1519Âπ¥9Êúà20Êó• - ÂÜíÈô∫„ÅÆÂßã„Åæ„Çä</span>
    </div>

    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>

    <div class="world-map-container">
        <div class="world-map">
            <!-- Â§©ÂÄô„Ç®„Éï„Çß„ÇØ„Éà -->
            <div class="weather-indicator" id="weather">‚òÄÔ∏è</div>
            <div class="wind-effect" id="windEffect"></div>

            <!-- Â§ßÈô∏ -->
            <div class="continent europe"></div>
            <div class="continent africa"></div>
            <div class="continent asia"></div>
            <div class="continent americas"></div>
            <div class="continent australia"></div>

            <!-- Ëà™Ë∑Ø„Éù„Ç§„É≥„Éà -->
            <div class="route-point" data-location="„Çπ„Éö„Ç§„É≥„Éª„Çª„Éì„É™„Ç¢" style="top: 25%; left: 44%;"></div>
            <div class="route-point" data-location="„Ç´„Éä„É™„Ç¢Ë´∏Â≥∂" style="top: 30%; left: 40%;"></div>
            <div class="route-point" data-location="„Éñ„É©„Ç∏„É´„Éª„É™„Ç™„Éá„Ç∏„É£„Éç„Ç§„É≠" style="top: 55%; left: 25%;"></div>
            <div class="route-point" data-location="„Ç¢„É´„Çº„É≥„ÉÅ„É≥„Éª„Éë„Çø„Ç¥„Éã„Ç¢" style="top: 70%; left: 22%;"></div>
            <div class="route-point" data-location="„Éû„Çº„É©„É≥Êµ∑Â≥°" style="top: 75%; left: 20%;"></div>
            <div class="route-point" data-location="Â§™Âπ≥Ê¥ãÊ®™Êñ≠ÈñãÂßã" style="top: 45%; left: 5%;"></div>
            <div class="route-point" data-location="Â§™Âπ≥Ê¥ãÊ®™Êñ≠ÁµÇ‰∫Ü" style="top: 42%; left: 95%;"></div>
            <div class="route-point" data-location="„Ç∞„Ç¢„É†Â≥∂" style="top: 40%; left: 75%;"></div>
            <div class="route-point" data-location="„Éï„Ç£„É™„Éî„É≥„Éª„Çª„ÉñÂ≥∂" style="top: 45%; left: 72%;"></div>
            <div class="route-point" data-location="„É¢„É´„ÉÉ„Ç´Ë´∏Â≥∂ÔºàÈ¶ôÊñôË´∏Â≥∂Ôºâ" style="top: 50%; left: 74%;"></div>
            <div class="route-point" data-location="„Ç§„É≥„ÉâÊ¥ãÊ®™Êñ≠" style="top: 55%; left: 60%;"></div>
            <div class="route-point" data-location="ÂñúÊúõÂ≥∞" style="top: 65%; left: 48%;"></div>
            <div class="route-point" data-location="Â§ßË•øÊ¥ãÊ®™Êñ≠" style="top: 45%; left: 35%;"></div>
            <div class="route-point" data-location="„Çπ„Éö„Ç§„É≥Â∏∞ÈÇÑ" style="top: 25%; left: 44%;"></div>

            <!-- ÂÆùÁâ© -->
            <div class="treasure" style="top: 28%; left: 38%;" onclick="collectTreasure(this, 100)">üíé</div>
            <div class="treasure" style="top: 52%; left: 28%;" onclick="collectTreasure(this, 150)">üè∫</div>
            <div class="treasure" style="top: 42%; left: 73%;" onclick="collectTreasure(this, 200)">üëë</div>
            <div class="treasure" style="top: 62%; left: 50%;" onclick="collectTreasure(this, 120)">üí∞</div>

            <!-- Ëàπ -->
            <div class="ship" id="ship" style="top: 25%; left: 44%;">üö¢</div>
        </div>
    </div>

    <div class="controls">
        <button class="btn" onclick="startVoyage()">üéÆ ÂÜíÈô∫ÈñãÂßã</button>
        <button class="btn" onclick="pauseVoyage()">‚è∏Ô∏è ‰∏ÄÊôÇÂÅúÊ≠¢</button>
        <button class="btn" onclick="resetVoyage()">üîÑ ÊúÄÂàù„Åã„Çâ</button>
        <button class="btn" onclick="speedUp()">‚ö° ÈÄüÂ∫¶UP</button>
        <button class="btn" onclick="openMiniGame('navigation')">üß≠ Ëà™Êµ∑Ë°ìË®ìÁ∑¥</button>
    </div>

    <div class="info-panel" id="infoPanel">
        <h3>Ëà™Êµ∑ÊÉÖÂ†±</h3>
        <div id="locationInfo">
            <p><strong>ÁèæÂú®Âú∞:</strong> <span id="currentLocation">„Çª„Éì„É™„Ç¢Ê∏Ø</span></p>
            <p><strong>Êó•‰ªò:</strong> <span id="infoDate">1519Âπ¥9Êúà20Êó•</span></p>
            <p><strong>Ëà™Êµ∑Êó•Êï∞:</strong> <span id="dayCount">0</span>Êó•</p>
            <p><strong>ÊÆã„ÇäËàπ:</strong> <span id="shipCount">5</span>Èöª</p>
        </div>
        <div id="historicalInfo">
            <h4>Ê≠¥Âè≤ÁöÑ‰∫ãÂÆü</h4>
            <p id="historicalText">„Éï„Çß„É´„Éá„Ç£„Éä„É≥„Éâ„Éª„Éû„Çº„É©„É≥„ÅåÁéá„ÅÑ„Çã5Èöª„ÅÆËàπÂõ£„Åå„Çπ„Éö„Ç§„É≥„ÅÆ„Çª„Éì„É™„Ç¢„ÇíÂá∫Áô∫„ÄÇ‰∏ñÁïåÂàù„ÅÆ‰∏ñÁïå‰∏ÄÂë®Ëà™Êµ∑„ÅÆÂßã„Åæ„Çä„Åß„Åô„ÄÇ</p>
        </div>
        <button class="btn" onclick="closeInfo()">Èñâ„Åò„Çã</button>
    </div>

    <!-- „Ç§„Éô„É≥„Éà„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó -->
    <div class="event-popup" id="eventPopup">
        <h3 id="eventTitle">üåä Á™ÅÁÑ∂„ÅÆ‰∫ã‰ª∂ÔºÅ</h3>
        <p id="eventDescription">„Å©„ÅÜ„Åó„Åæ„Åô„ÅãÔºü</p>
        <div id="eventChoices"></div>
    </div>

    <!-- ÂÆüÁ∏æ„Éà„Éº„Çπ„Éà -->
    <div class="achievement-toast" id="achievementToast">
        üèÜ Êñ∞„Åó„ÅÑÂÆüÁ∏æ„ÇíÁç≤Âæó„Åó„Åæ„Åó„ÅüÔºÅ
    </div>

    <!-- „Éü„Éã„Ç≤„Éº„É†„É¢„Éº„ÉÄ„É´ -->
    <div class="mini-game-modal" id="miniGameModal">
        <div class="mini-game-content">
            <h3 id="miniGameTitle">üß≠ Ëà™Êµ∑Ë°ìË®ìÁ∑¥</h3>
            <div id="miniGameContent">
                <p>Ê≠£„Åó„ÅÑÊñπËßí„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑÔºÅ</p>
                <div style="font-size: 3em; margin: 20px;">üß≠</div>
                <div>
                    <button class="choice-btn" onclick="answerNavigation('north')">‚¨ÜÔ∏è Âåó</button>
                    <button class="choice-btn" onclick="answerNavigation('south')">‚¨áÔ∏è Âçó</button>
                    <button class="choice-btn" onclick="answerNavigation('east')">‚û°Ô∏è Êù±</button>
                    <button class="choice-btn" onclick="answerNavigation('west')">‚¨ÖÔ∏è Ë•ø</button>
                </div>
            </div>
            <button class="btn" onclick="closeMiniGame()">Èñâ„Åò„Çã</button>
        </div>
    </div>

    <script>
        // „Ç≤„Éº„É†Áä∂ÊÖã
        let gameStats = {
            score: 0,
            crew: 270,
            food: 100,
            money: 1000,
            achievements: [],
            treasuresFound: 0
        };

        const weatherTypes = ['‚òÄÔ∏è', '‚õÖ', 'üåßÔ∏è', '‚õàÔ∏è', 'üå™Ô∏è', '‚ùÑÔ∏è'];
        const randomEvents = [
            {
                title: 'üè¥‚Äç‚ò†Ô∏è Êµ∑Ë≥äÁô∫Ë¶ãÔºÅ',
                description: 'Êµ∑Ë≥äËàπ„ÅåÊé•Ëøë„Åó„Å¶„ÅÑ„Åæ„ÅôÔºÅ',
                choices: [
                    { text: '‚öîÔ∏è Êà¶„ÅÜ', effect: { crew: -10, score: 100, money: 200 } },
                    { text: 'üí∞ Ë≤∑Âèé„Åô„Çã', effect: { money: -300, score: 50 } },
                    { text: 'üèÉ ÈÄÉ„Åí„Çã', effect: { food: -10, score: 20 } }
                ]
            },
            {
                title: 'üåä Â§ßÂµêË•≤Êù•ÔºÅ',
                description: 'ÊøÄ„Åó„ÅÑÂµê„Å´Â∑ª„ÅçËæº„Åæ„Çå„Åæ„Åó„ÅüÔºÅ',
                choices: [
                    { text: '‚öì ÊäïÈå®„Åó„Å¶ËÄê„Åà„Çã', effect: { food: -15, crew: -5, score: 80 } },
                    { text: '‚õµ Âº∑Ë°åÁ™ÅÁ†¥', effect: { crew: -20, score: 150 } }
                ]
            },
            {
                title: 'üêã Â∑®Â§ß„ÇØ„Ç∏„É©Áô∫Ë¶ãÔºÅ',
                description: 'Â∑®Â§ß„Å™„ÇØ„Ç∏„É©„ÅåËàπ„ÅÆËøë„Åè„ÇíÊ≥≥„ÅÑ„Åß„ÅÑ„Åæ„ÅôÔºÅ',
                choices: [
                    { text: 'üìñ Ë¶≥ÂØü„Åó„Å¶Ë®òÈå≤', effect: { score: 200, achievements: ['Êµ∑Ê¥ãÂ≠¶ËÄÖ'] } },
                    { text: 'üé£ ÊçïÁç≤„Å´ÊåëÊà¶', effect: { food: 30, crew: -3, score: 100 } }
                ]
            }
        ];

        const achievementsList = [
            { name: 'ÂàùËà™Êµ∑', condition: 'firstSail', description: 'Âàù„ÇÅ„Å¶„ÅÆËà™Êµ∑„ÇíÈñãÂßã' },
            { name: 'ÂÆùÊé¢„ÅóÂêç‰∫∫', condition: 'treasure5', description: 'ÂÆùÁâ©„Çí5ÂÄãÁô∫Ë¶ã' },
            { name: 'Â§™Âπ≥Ê¥ãÂæÅÊúçËÄÖ', condition: 'pacific_cross', description: '99Êó•Èñì„ÅÆÂ§™Âπ≥Ê¥ãËà™Êµ∑„ÇíÂÆå‰∫Ü' },
            { name: 'Âµê„ÅÆËà™Êµ∑Â£´', condition: 'storm3', description: 'Âµê„Çí3Âõû‰πó„ÇäË∂ä„Åà„Çã' },
            { name: 'Â§ñ‰∫§ÂÆò', condition: 'peaceful5', description: '5ÂõûÂπ≥ÂíåÁöÑ„Å´Ëß£Ê±∫' },
            { name: 'ÂãáÊï¢„Å™ËàπÈï∑', condition: 'fight5', description: '5ÂõûÊà¶Èóò„ÅßÂãùÂà©' },
            { name: '„Éû„Çº„É©„É≥„ÅÆÂæåÁ∂ôËÄÖ', condition: 'complete', description: '‰∏ñÁïå‰∏ÄÂë®„ÇíÂÆåÊàê' }
        ];

        const voyageData = [
            { location: "„Çπ„Éö„Ç§„É≥„Éª„Çª„Éì„É™„Ç¢", date: "1519Âπ¥9Êúà20Êó•", ships: 5, info: "„Éû„Çº„É©„É≥Ëâ¶Èöä5Èöª„Åå„Çª„Éì„É™„Ç¢Ê∏Ø„Åã„ÇâÂá∫Áô∫„ÄÇTrinidad„ÄÅSan Antonio„ÄÅConcepci√≥n„ÄÅVictoria„ÄÅSantiago„ÅÆ5Èöª„ÄÇ", event: 'start' },
            { location: "„Ç´„Éä„É™„Ç¢Ë´∏Â≥∂", date: "1519Âπ¥9Êúà26Êó•", ships: 5, info: "„Ç´„Éä„É™„Ç¢Ë´∏Â≥∂„ÅßË£úÁµ¶„ÄÇÂ§ßË•øÊ¥ãÊ®™Êñ≠„ÅÆÊ∫ñÂÇô„ÇíÊï¥„Åà„Çã„ÄÇ", event: 'supply' },
            { location: "„Éñ„É©„Ç∏„É´„Éª„É™„Ç™„Éá„Ç∏„É£„Éç„Ç§„É≠", date: "1519Âπ¥12Êúà13Êó•", ships: 5, info: "ÂçóÁ±≥Â§ßÈô∏Âà∞ÈÅî„ÄÇ„É™„Ç™„Éá„Ç∏„É£„Éç„Ç§„É≠„ÅßË∂äÂÜ¨Ê∫ñÂÇô„Å®Ëàπ„ÅÆ‰øÆÁêÜ„ÄÇ" },
            { location: "„Ç¢„É´„Çº„É≥„ÉÅ„É≥„Éª„Éë„Çø„Ç¥„Éã„Ç¢", date: "1520Âπ¥3Êúà31Êó•", ships: 4, info: "„Éë„Çø„Ç¥„Éã„Ç¢Âú∞Êñπ„ÅßË∂äÂÜ¨„ÄÇSantiagoÂè∑„ÅåÂ∫ßÁ§Å„Å´„Çà„ÇäÂ§±„Çè„Çå„Çã„ÄÇ‰πóÁµÑÂì°„ÅÆÂèç‰π±„ÇÇÁô∫Áîü„ÄÇ" },
            { location: "„Éû„Çº„É©„É≥Êµ∑Â≥°", date: "1520Âπ¥10Êúà21Êó•", ships: 3, info: "Â§™Âπ≥Ê¥ã„Å∏„ÅÆÈÄöË∑ØÁô∫Ë¶ãÔºÅSan AntonioÂè∑„ÅåËÑ±Ëµ∞„ÄÇ„Éû„Çº„É©„É≥„Å´„Å°„Å™„Çì„ÅßÂëΩÂêç„Åï„Çå„ÅüÊµ∑Â≥°„ÄÇ", event: 'discovery' },
            { location: "Â§™Âπ≥Ê¥ãÊ®™Êñ≠ÈñãÂßã", date: "1520Âπ¥11Êúà28Êó•", ships: 3, info: "Êú™Áü•„ÅÆÂ§ßÊ¥ã„Å´Á™ÅÂÖ•„ÄÇ„ÄåÂ§™Âπ≥Ê¥ãÔºàPacific OceanÔºâ„Äç„Å®ÂëΩÂêç„ÄÇ99Êó•Èñì„ÅÆÂõ∞Èõ£„Å™Ëà™Êµ∑„ÅåÂßã„Åæ„Çã„ÄÇ", event: 'pacific' },
            { location: "Â§™Âπ≥Ê¥ãÊ®™Êñ≠ÁµÇ‰∫Ü", date: "1521Âπ¥3Êúà5Êó•", ships: 3, info: "99Êó•Èñì„ÅÆÂ§™Âπ≥Ê¥ãËà™Êµ∑„ÄÇÂ£äË°ÄÁóÖ„Å´„Çà„ÇäÂ§ö„Åè„ÅÆ‰πóÁµÑÂì°„ÅåÊ≠ª‰∫°„ÄÇ„Å§„ÅÑ„Å´Ë•øÂ§™Âπ≥Ê¥ã„Å´Âà∞ÈÅî„ÄÇ", event: 'pacific_end' },
            { location: "„Ç∞„Ç¢„É†Â≥∂", date: "1521Âπ¥3Êúà6Êó•", ships: 3, info: "99Êó•Èñì„ÅÆÂ§™Âπ≥Ê¥ãËà™Êµ∑„ÅÆÊú´„ÄÅ„Çà„ÅÜ„ÇÑ„ÅèÈô∏Âú∞Áô∫Ë¶ã„ÄÇÂéü‰ΩèÊ∞ë„Å®„ÅÆÊúÄÂàù„ÅÆÊé•Ëß¶„ÄÇ" },
            { location: "„Éï„Ç£„É™„Éî„É≥„Éª„Çª„ÉñÂ≥∂", date: "1521Âπ¥4Êúà7Êó•", ships: 3, info: "„Éï„Ç£„É™„Éî„É≥Ë´∏Â≥∂Âà∞ÈÅî„ÄÇ„Éû„Çº„É©„É≥„Åå„Ç≠„É™„Çπ„ÉàÊïôÂ∏ÉÊïô„ÇíÈñãÂßã„ÄÇ" },
            { location: "„Éû„Çº„É©„É≥Ê≠ª‰∫°", date: "1521Âπ¥4Êúà27Êó•", ships: 3, info: "„Éû„ÇØ„Çø„É≥Â≥∂„Åß„Éû„Çº„É©„É≥Êà¶Ê≠ª„ÄÇÈÖãÈï∑„É©„Éó„É©„Éó„Å®„ÅÆÊà¶„ÅÑ„ÅßÂëΩ„ÇíËêΩ„Å®„Åô„ÄÇ" },
            { location: "„É¢„É´„ÉÉ„Ç´Ë´∏Â≥∂", date: "1521Âπ¥11Êúà8Êó•", ships: 2, info: "„Å§„ÅÑ„Å´È¶ôÊñôË´∏Â≥∂Âà∞ÈÅîÔºÅConcepci√≥nÂè∑„ÇíÁ†¥Ê£Ñ„ÄÇÈ¶ôËæõÊñô„ÇíÂ§ßÈáè„Å´Á©çËºâ„ÄÇ" },
            { location: "„Ç§„É≥„ÉâÊ¥ãÊ®™Êñ≠", date: "1522Âπ¥2Êúà11Êó•", ships: 1, info: "TrinidadÂè∑„ÅåÊïÖÈöú„Å´„Çà„ÇäÊÆãÁïô„ÄÇVictoriaÂè∑„ÅÆ„Åø„ÅåÂ∏∞Ë∑Ø„Å´„Å§„Åè„ÄÇ" },
            { location: "ÂñúÊúõÂ≥∞", date: "1522Âπ¥5Êúà20Êó•", ships: 1, info: "„Ç¢„Éï„É™„Ç´ÊúÄÂçóÁ´Ø„ÇíÂõûËà™„ÄÇÂ§ö„Åè„ÅÆ‰πóÁµÑÂì°„ÅåÂ£äË°ÄÁóÖ„ÅßÊ≠ª‰∫°„ÄÇ" },
            { location: "Â§ßË•øÊ¥ãÊ®™Êñ≠", date: "1522Âπ¥7Êúà9Êó•", ships: 1, info: "ÊúÄÂæå„ÅÆÂ§ßÊ¥ãÊ®™Êñ≠„ÄÇÈ£üÁ≥ß‰∏çË∂≥„Å®ÁóÖÊ∞ó„Å´Ëã¶„Åó„Åø„Å™„Åå„Çâ„ÇÇËà™Êµ∑„ÇíÁ∂öË°å„ÄÇ" },
            { location: "„Çπ„Éö„Ç§„É≥Â∏∞ÈÇÑ", date: "1522Âπ¥9Êúà6Êó•", ships: 1, info: "VictoriaÂè∑„Åå„Çª„Éì„É™„Ç¢Ê∏Ø„Å´Â∏∞ÈÇÑÔºÅ18‰∫∫„ÅÆÁîüÂ≠òËÄÖ„Å®ÂÖ±„Å´‰∫∫È°ûÂàù„ÅÆ‰∏ñÁïå‰∏ÄÂë®„ÇíÂÆåÊàê„ÄÇ" }
        ];

        let currentStep = 0;
        let voyageInterval = null;
        let voyageSpeed = 3000;
        let isVoyaging = false;
        let currentWeather = 0;
        let weatherInterval = null;

        const ship = document.getElementById('ship');
        const infoPanel = document.getElementById('infoPanel');
        const routePoints = document.querySelectorAll('.route-point');

        function startVoyage() {
            if (isVoyaging) return;
            isVoyaging = true;
            
            // ÂàùÂõûËà™Êµ∑„ÅÆÂÆüÁ∏æ
            if (currentStep === 0) {
                unlockAchievement('firstSail');
            }
            
            if (voyageInterval) clearInterval(voyageInterval);
            if (weatherInterval) clearInterval(weatherInterval);
            
            voyageInterval = setInterval(() => {
                if (currentStep < voyageData.length - 1) {
                    currentStep++;
                    updateVoyage();
                    
                    // „É©„É≥„ÉÄ„É†„Ç§„Éô„É≥„ÉàÁô∫Áîü
                    if (Math.random() < 0.3) {
                        triggerRandomEvent();
                    }
                } else {
                    completeVoyage();
                }
            }, voyageSpeed);
            
            // Â§©ÂÄôÂ§âÂåñ
            weatherInterval = setInterval(() => {
                changeWeather();
            }, 5000);
            
            playSound('sail');
        }

        function pauseVoyage() {
            isVoyaging = false;
            if (voyageInterval) {
                clearInterval(voyageInterval);
                voyageInterval = null;
            }
        }

        function resetVoyage() {
            pauseVoyage();
            currentStep = 0;
            gameStats = {
                score: 0,
                crew: 270,
                food: 100,
                money: 1000,
                achievements: [],
                treasuresFound: 0
            };
            updateGameStats();
            updateVoyage();
            // ÂÆùÁâ©„ÇíÂÜçË°®Á§∫
            document.querySelectorAll('.treasure').forEach(t => t.style.display = 'block');
        }

        function speedUp() {
            voyageSpeed = Math.max(1000, voyageSpeed - 1000);
            if (isVoyaging) {
                pauseVoyage();
                startVoyage();
            }
        }

        function updateVoyage() {
            const data = voyageData[currentStep];
            const point = routePoints[currentStep];
            
            // Ëàπ„ÅÆ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞
            if (point) {
                // Â§™Âπ≥Ê¥ãÊ®™Êñ≠„ÅÆÁâπÂà•Âá¶ÁêÜ
                if (data.location === "Â§™Âπ≥Ê¥ãÊ®™Êñ≠ÈñãÂßã") {
                    // Â∑¶Á´Ø„Å´ÁßªÂãï
                    ship.style.top = point.style.top;
                    ship.style.left = point.style.left;
                    ship.style.opacity = '1';
                } else if (data.location === "Â§™Âπ≥Ê¥ãÊ®™Êñ≠ÁµÇ‰∫Ü") {
                    // Âú∞ÁêÉ‰∏ÄÂë®ÂäπÊûúÔºöÂ∑¶Á´Ø„Å´Ê∂à„Åà„Å¶Âè≥Á´Ø„Åã„ÇâÁèæ„Çå„Çã
                    ship.style.opacity = '0';
                    ship.style.left = '5%';
                    
                    setTimeout(() => {
                        ship.style.transition = 'none';
                        ship.style.left = '95%';
                        ship.style.top = point.style.top;
                        
                        setTimeout(() => {
                            ship.style.transition = 'all 2s ease-in-out';
                            ship.style.opacity = '1';
                            ship.style.left = point.style.left;
                        }, 100);
                    }, 1000);
                } else {
                    ship.style.top = point.style.top;
                    ship.style.left = point.style.left;
                    ship.style.opacity = '1';
                }
                
                // Ëàπ„ÅÆÁßªÂãï„Ç®„Éï„Çß„ÇØ„Éà
                ship.style.animation = 'none';
                setTimeout(() => {
                    ship.style.animation = 'shipBob 2s ease-in-out infinite';
                }, 100);
            }
            
            // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Éù„Ç§„É≥„Éà„ÇíÊõ¥Êñ∞
            routePoints.forEach((p, i) => {
                p.classList.remove('active');
                if (i === currentStep) p.classList.add('active');
            });
            
            // ÈÄ≤Ë°åÁä∂Ê≥Å„ÇíÊõ¥Êñ∞
            const progress = (currentStep / (voyageData.length - 1)) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            // Êó•‰ªòË°®Á§∫„ÇíÊõ¥Êñ∞
            document.getElementById('currentDate').textContent = data.date + ' - ' + data.location;
            
            // „Çπ„Ç≥„Ç¢Êõ¥Êñ∞
            gameStats.score += 50;
            updateGameStats();
            
            // ÊÉÖÂ†±„Éë„Éç„É´„ÇíË°®Á§∫
            showLocationInfo(data);
            
            // ÁâπÂà•„Ç§„Éô„É≥„Éà
            if (data.event) {
                handleSpecialEvent(data.event);
            }
            
            playSound('arrive');
        }

        function showLocationInfo(data) {
            document.getElementById('currentLocation').textContent = data.location;
            document.getElementById('infoDate').textContent = data.date;
            document.getElementById('shipCount').textContent = data.ships;
            document.getElementById('historicalText').textContent = data.info;
            
            // Ëà™Êµ∑Êó•Êï∞Ë®àÁÆó
            const startDate = new Date('1519-09-20');
            const currentDate = new Date(data.date.replace('Âπ¥', '-').replace('Êúà', '-').replace('Êó•', ''));
            const dayDiff = Math.floor((currentDate - startDate) / (1000 * 60 * 60 * 24));
            document.getElementById('dayCount').textContent = dayDiff;
            
            infoPanel.classList.add('show');
            
            setTimeout(() => {
                if (!infoPanel.matches(':hover')) {
                    infoPanel.classList.remove('show');
                }
            }, 5000);
        }

        function closeInfo() {
            infoPanel.classList.remove('show');
        }

        function completeVoyage() {
            pauseVoyage();
            gameStats.score += 1000;
            unlockAchievement('complete');
            updateGameStats();
            
            showEventPopup(
                'üéâ ÂÅâÊ•≠ÈÅîÊàêÔºÅ',
                `„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ‰∏ñÁïåÂàù„ÅÆ‰∏ñÁïå‰∏ÄÂë®„ÇíÂÆåÊàê„Åï„Åõ„Åæ„Åó„ÅüÔºÅ\n\nÊúÄÁµÇ„Çπ„Ç≥„Ç¢: ${gameStats.score}ÁÇπ\nÁîüÂ≠òËÄÖ: ${gameStats.crew}‰∫∫\nÁô∫Ë¶ã„Åó„ÅüÂÆùÁâ©: ${gameStats.treasuresFound}ÂÄã\nÁç≤ÂæóÂÆüÁ∏æ: ${gameStats.achievements.length}ÂÄã`,
                [
                    { text: 'üéä Á•ù„ÅÜ', effect: null }
                ]
            );
            
            playSound('victory');
        }

        // Êñ∞„Åó„ÅÑÈñ¢Êï∞Áæ§
        function updateGameStats() {
            document.getElementById('score').textContent = gameStats.score;
            document.getElementById('crew').textContent = gameStats.crew;
            document.getElementById('food').textContent = Math.max(0, gameStats.food);
            document.getElementById('money').textContent = gameStats.money;
            document.getElementById('achievements').textContent = gameStats.achievements.length;
        }

        function changeWeather() {
            currentWeather = (currentWeather + 1) % weatherTypes.length;
            document.getElementById('weather').textContent = weatherTypes[currentWeather];
            
            // È¢®„Ç®„Éï„Çß„ÇØ„Éà
            if (currentWeather >= 2) {
                document.getElementById('windEffect').classList.add('active');
                setTimeout(() => {
                    document.getElementById('windEffect').classList.remove('active');
                }, 4000);
            }
        }

        function triggerRandomEvent() {
            const event = randomEvents[Math.floor(Math.random() * randomEvents.length)];
            showEventPopup(event.title, event.description, event.choices);
        }

        function showEventPopup(title, description, choices) {
            const popup = document.getElementById('eventPopup');
            document.getElementById('eventTitle').textContent = title;
            document.getElementById('eventDescription').textContent = description;
            
            const choicesDiv = document.getElementById('eventChoices');
            choicesDiv.innerHTML = '';
            
            choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                btn.textContent = choice.text;
                btn.onclick = () => handleEventChoice(choice.effect);
                choicesDiv.appendChild(btn);
            });
            
            popup.style.display = 'block';
            playSound('event');
        }

        function handleEventChoice(effect) {
            if (effect) {
                Object.keys(effect).forEach(key => {
                    if (key === 'achievements') {
                        effect[key].forEach(achievement => unlockAchievement(achievement));
                    } else {
                        gameStats[key] = Math.max(0, gameStats[key] + effect[key]);
                    }
                });
                updateGameStats();
                showFloatingPoints(effect.score || 0);
            }
            document.getElementById('eventPopup').style.display = 'none';
        }

        function collectTreasure(element, points) {
            element.style.display = 'none';
            gameStats.score += points;
            gameStats.money += points;
            gameStats.treasuresFound++;
            
            showFloatingPoints(points);
            updateGameStats();
            
            if (gameStats.treasuresFound >= 5) {
                unlockAchievement('treasure5');
            }
            
            playSound('treasure');
        }

        function showFloatingPoints(points) {
            const pointsEl = document.createElement('div');
            pointsEl.className = 'floating-points';
            pointsEl.textContent = '+' + points;
            pointsEl.style.left = ship.style.left;
            pointsEl.style.top = ship.style.top;
            document.querySelector('.world-map').appendChild(pointsEl);
            
            setTimeout(() => {
                pointsEl.remove();
            }, 2000);
        }

        function unlockAchievement(achievementKey) {
            if (!gameStats.achievements.includes(achievementKey)) {
                gameStats.achievements.push(achievementKey);
                
                const toast = document.getElementById('achievementToast');
                toast.innerHTML = 'üèÜ ÂÆüÁ∏æËß£Èô§: ' + (achievementsList.find(a => a.condition === achievementKey)?.name || achievementKey);
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
                
                playSound('achievement');
            }
        }

        function handleSpecialEvent(eventType) {
            switch(eventType) {
                case 'start':
                    gameStats.score += 100;
                    break;
                case 'discovery':
                    gameStats.score += 200;
                    unlockAchievement('discovery');
                    break;
                case 'pacific':
                    gameStats.food -= 20;
                    gameStats.crew -= 30;
                    break;
                case 'pacific_end':
                    gameStats.score += 300;
                    showFloatingPoints(300);
                    unlockAchievement('pacific_cross');
                    break;
            }
            updateGameStats();
        }

        function openMiniGame(type) {
            document.getElementById('miniGameModal').style.display = 'flex';
            playSound('menu');
        }

        function closeMiniGame() {
            document.getElementById('miniGameModal').style.display = 'none';
        }

        function answerNavigation(direction) {
            const correct = direction === 'east';
            if (correct) {
                gameStats.score += 100;
                showFloatingPoints(100);
                alert('üéØ Ê≠£Ëß£ÔºÅÊù±„Å∏Âêë„Åã„ÅÜ„ÅÆ„ÅåÊ≠£„Åó„ÅÑÈÅ∏Êäû„Åß„Åó„ÅüÔºÅ');
            } else {
                alert('‚ùå ‰∏çÊ≠£Ëß£„ÄÇÊ≠£„Åó„Åè„ÅØÊù±„Åß„Åó„Åü„ÄÇ');
            }
            updateGameStats();
            closeMiniGame();
        }

        function playSound(type) {
            // Web Audio API„Çí‰ΩøÁî®„Åó„ÅüÂäπÊûúÈü≥ÁîüÊàê
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                switch(type) {
                    case 'sail':
                        oscillator.frequency.setValueAtTime(220, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(440, audioContext.currentTime + 0.5);
                        break;
                    case 'treasure':
                        oscillator.frequency.setValueAtTime(523, audioContext.currentTime);
                        oscillator.frequency.setValueAtTime(659, audioContext.currentTime + 0.1);
                        break;
                    case 'achievement':
                        oscillator.frequency.setValueAtTime(523, audioContext.currentTime);
                        oscillator.frequency.setValueAtTime(659, audioContext.currentTime + 0.1);
                        oscillator.frequency.setValueAtTime(784, audioContext.currentTime + 0.2);
                        break;
                }
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch(e) {
                // „Çµ„Ç¶„É≥„Éâ„ÅåÂÜçÁîü„Åß„Åç„Å™„ÅÑÂ†¥Âêà„ÅØÁÑ°Ë¶ñ
            }
        }

        // Ëà™Ë∑Ø„Éù„Ç§„É≥„Éà„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
        routePoints.forEach((point, index) => {
            point.addEventListener('click', () => {
                currentStep = index;
                updateVoyage();
            });
        });

        // CSS animationËøΩÂä†
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shipBob {
                0%, 100% { transform: translateY(0px) rotate(0deg); }
                50% { transform: translateY(-5px) rotate(2deg); }
            }
        `;
        document.head.appendChild(style);

        // ÂàùÊúüÂåñ
        updateGameStats();
        updateVoyage();
        changeWeather();

        // Ëá™ÂãïÁöÑ„Å´ÊÉÖÂ†±„Éë„Éç„É´„Çí‰∏ÄÂ∫¶Ë°®Á§∫
        setTimeout(() => {
            infoPanel.classList.add('show');
            setTimeout(() => {
                infoPanel.classList.remove('show');
            }, 3000);
        }, 2000);
    </script>
</body>
</html>