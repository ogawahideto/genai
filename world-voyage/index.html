<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ® ãƒ“ã‚¯ãƒˆãƒªã‚¢å·ã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼ - ä¸–ç•Œä¸€å‘¨ã‚²ãƒ¼ãƒ  ğŸ®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            overflow-x: hidden;
        }

        .header {
            text-align: center;
            padding: 20px;
            background: rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        /* ã‚²ãƒ¼ãƒ è¦ç´ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .game-stats {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #FFD700;
            min-width: 200px;
            z-index: 25;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 14px;
        }

        .stat-value {
            color: #FFD700;
            font-weight: bold;
        }

        .weather-indicator {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2em;
            z-index: 20;
            animation: weatherFloat 3s ease-in-out infinite;
        }

        @keyframes weatherFloat {
            0%, 100% { transform: translateX(-50%) translateY(0px); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }

        .treasure {
            position: absolute;
            font-size: 16px;
            z-index: 10;
            cursor: pointer;
            animation: treasureGlow 2s ease-in-out infinite alternate;
        }

        @keyframes treasureGlow {
            0% { transform: scale(1) rotate(0deg); }
            100% { transform: scale(1.2) rotate(10deg); }
        }

        .event-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            border: 3px solid #FF6B6B;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            z-index: 30;
            display: none;
            max-width: 400px;
            animation: popupBounce 0.5s ease-out;
        }

        @keyframes popupBounce {
            0% { transform: translate(-50%, -50%) scale(0.1); }
            80% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .event-popup h3 {
            color: #FF6B6B;
            margin-bottom: 15px;
        }

        .choice-btn {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .choice-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .achievement-toast {
            position: fixed;
            top: -100px;
            right: 20px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 20px;
            border-radius: 25px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: top 0.5s ease;
            z-index: 35;
            font-weight: bold;
        }

        .achievement-toast.show {
            top: 20px;
        }

        .mini-game-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 40;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .mini-game-content {
            background: rgba(255,255,255,0.1);
            border: 3px solid #FFD700;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
        }

        .wind-effect {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            animation: windSweep 4s linear infinite;
            opacity: 0;
        }

        .wind-effect.active {
            opacity: 1;
        }

        @keyframes windSweep {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .floating-points {
            position: absolute;
            font-size: 18px;
            font-weight: bold;
            color: #FFD700;
            pointer-events: none;
            animation: floatUp 2s ease-out forwards;
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-50px); }
        }

        .world-map-container {
            position: relative;
            width: 100%;
            height: 70vh;
            background: linear-gradient(to bottom, #87CEEB, #4682B4);
            border: 3px solid #8B4513;
            margin: 20px 0;
        }

        .world-map {
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 30%, #228B22 2px, transparent 2px),
                radial-gradient(circle at 60% 20%, #228B22 1px, transparent 1px),
                radial-gradient(circle at 80% 60%, #228B22 3px, transparent 3px),
                radial-gradient(circle at 15% 80%, #228B22 2px, transparent 2px),
                radial-gradient(circle at 85% 75%, #228B22 1px, transparent 1px),
                radial-gradient(circle at 40% 70%, #228B22 2px, transparent 2px);
            background-size: 100px 100px, 150px 150px, 120px 120px, 180px 180px, 90px 90px, 110px 110px;
            position: relative;
        }

        .continent {
            position: absolute;
            background: #8B4513;
            border-radius: 20px;
        }

        .europe {
            top: 20%;
            left: 45%;
            width: 8%;
            height: 12%;
        }

        .africa {
            top: 35%;
            left: 48%;
            width: 6%;
            height: 20%;
            border-radius: 15px 15px 5px 5px;
        }

        .asia {
            top: 15%;
            left: 60%;
            width: 20%;
            height: 25%;
            border-radius: 30px;
        }

        .americas {
            top: 20%;
            left: 15%;
            width: 15%;
            height: 40%;
            border-radius: 25px;
        }

        .australia {
            top: 60%;
            left: 70%;
            width: 8%;
            height: 8%;
            border-radius: 50%;
        }

        .route-point {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #FFD700;
            border: 2px solid #FFA500;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .route-point:hover {
            width: 16px;
            height: 16px;
            background: #FF6B6B;
            transform: scale(1.2);
        }

        .route-point.active {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }

        .ship {
            position: absolute;
            font-size: 20px;
            z-index: 15;
            transition: all 2s ease-in-out;
        }

        .route-line {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, transparent, #FFD700, transparent);
            transform-origin: left center;
            opacity: 0.8;
            z-index: 5;
        }

        .info-panel {
            position: fixed;
            top: 50%;
            right: -350px;
            transform: translateY(-50%);
            width: 320px;
            height: 400px;
            background: rgba(0,0,0,0.9);
            border: 2px solid #FFD700;
            border-radius: 10px;
            padding: 20px;
            transition: right 0.5s ease;
            z-index: 20;
        }

        .info-panel.show {
            right: 20px;
        }

        .info-panel h3 {
            color: #FFD700;
            margin-bottom: 15px;
            border-bottom: 1px solid #FFD700;
            padding-bottom: 5px;
        }

        .controls {
            text-align: center;
            padding: 20px;
        }

        .btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
            border: none;
            padding: 12px 24px;
            margin: 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .progress-bar {
            width: 80%;
            height: 10px;
            background: rgba(255,255,255,0.3);
            border-radius: 5px;
            margin: 20px auto;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFD700, #FFA500);
            width: 0%;
            transition: width 0.5s ease;
        }

        .date-display {
            text-align: center;
            font-size: 1.5em;
            margin: 20px;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            .info-panel {
                width: 90%;
                right: -100%;
                top: 10%;
                transform: none;
                height: 70%;
            }
            
            .info-panel.show {
                right: 5%;
            }

            .game-stats {
                position: relative;
                margin: 10px;
                width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ® ãƒ“ã‚¯ãƒˆãƒªã‚¢å·ã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼ ğŸŒ</h1>
        <p>å²ä¸Šæœ€ã‚‚å±é™ºã§å£®å¤§ãªå†’é™ºã«æŒ‘æˆ¦ã—ã‚ˆã†ï¼</p>
    </div>

    <!-- ã‚²ãƒ¼ãƒ çµ±è¨ˆãƒ‘ãƒãƒ« -->
    <div class="game-stats">
        <div class="stat-item">
            <span>ğŸ† ã‚¹ã‚³ã‚¢:</span>
            <span class="stat-value" id="score">0</span>
        </div>
        <div class="stat-item">
            <span>âš“ ä¹—çµ„å“¡:</span>
            <span class="stat-value" id="crew">270</span>
        </div>
        <div class="stat-item">
            <span>ğŸ é£Ÿæ–™:</span>
            <span class="stat-value" id="food">100</span>%
        </div>
        <div class="stat-item">
            <span>ğŸ’° è³‡é‡‘:</span>
            <span class="stat-value" id="money">1000</span>
        </div>
        <div class="stat-item">
            <span>ğŸ–ï¸ åŠŸç¸¾:</span>
            <span class="stat-value" id="achievements">0</span>/15
        </div>
    </div>

    <div class="date-display">
        <span id="currentDate">1519å¹´9æœˆ20æ—¥ - å†’é™ºã®å§‹ã¾ã‚Š</span>
    </div>

    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>

    <div class="world-map-container">
        <div class="world-map">
            <!-- å¤©å€™ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ -->
            <div class="weather-indicator" id="weather">â˜€ï¸</div>
            <div class="wind-effect" id="windEffect"></div>

            <!-- å¤§é™¸ -->
            <div class="continent europe"></div>
            <div class="continent africa"></div>
            <div class="continent asia"></div>
            <div class="continent americas"></div>
            <div class="continent australia"></div>

            <!-- èˆªè·¯ãƒã‚¤ãƒ³ãƒˆ -->
            <div class="route-point" data-location="ã‚¹ãƒšã‚¤ãƒ³ãƒ»ã‚»ãƒ“ãƒªã‚¢" style="top: 25%; left: 44%;"></div>
            <div class="route-point" data-location="ã‚«ãƒŠãƒªã‚¢è«¸å³¶" style="top: 30%; left: 40%;"></div>
            <div class="route-point" data-location="ãƒ–ãƒ©ã‚¸ãƒ«ãƒ»ãƒªã‚ªãƒ‡ã‚¸ãƒ£ãƒã‚¤ãƒ­" style="top: 55%; left: 25%;"></div>
            <div class="route-point" data-location="ã‚¢ãƒ«ã‚¼ãƒ³ãƒãƒ³ãƒ»ãƒ‘ã‚¿ã‚´ãƒ‹ã‚¢" style="top: 70%; left: 22%;"></div>
            <div class="route-point" data-location="ãƒã‚¼ãƒ©ãƒ³æµ·å³¡" style="top: 75%; left: 20%;"></div>
            <div class="route-point" data-location="å¤ªå¹³æ´‹æ¨ªæ–­é–‹å§‹" style="top: 45%; left: 5%;"></div>
            <div class="route-point" data-location="å¤ªå¹³æ´‹æ¨ªæ–­çµ‚äº†" style="top: 42%; left: 95%;"></div>
            <div class="route-point" data-location="ã‚°ã‚¢ãƒ å³¶" style="top: 40%; left: 75%;"></div>
            <div class="route-point" data-location="ãƒ•ã‚£ãƒªãƒ”ãƒ³ãƒ»ã‚»ãƒ–å³¶" style="top: 45%; left: 72%;"></div>
            <div class="route-point" data-location="ãƒ¢ãƒ«ãƒƒã‚«è«¸å³¶ï¼ˆé¦™æ–™è«¸å³¶ï¼‰" style="top: 50%; left: 74%;"></div>
            <div class="route-point" data-location="ã‚¤ãƒ³ãƒ‰æ´‹æ¨ªæ–­" style="top: 55%; left: 60%;"></div>
            <div class="route-point" data-location="å–œæœ›å³°" style="top: 65%; left: 48%;"></div>
            <div class="route-point" data-location="å¤§è¥¿æ´‹æ¨ªæ–­" style="top: 45%; left: 35%;"></div>
            <div class="route-point" data-location="ã‚¹ãƒšã‚¤ãƒ³å¸°é‚„" style="top: 25%; left: 44%;"></div>

            <!-- å®ç‰© -->
            <div class="treasure" style="top: 28%; left: 38%;" onclick="collectTreasure(this, 100)">ğŸ’</div>
            <div class="treasure" style="top: 52%; left: 28%;" onclick="collectTreasure(this, 150)">ğŸº</div>
            <div class="treasure" style="top: 42%; left: 73%;" onclick="collectTreasure(this, 200)">ğŸ‘‘</div>
            <div class="treasure" style="top: 62%; left: 50%;" onclick="collectTreasure(this, 120)">ğŸ’°</div>

            <!-- èˆ¹ -->
            <div class="ship" id="ship" style="top: 25%; left: 44%;">ğŸš¢</div>
        </div>
    </div>

    <div class="controls">
        <button class="btn" onclick="startVoyage()">ğŸ® å†’é™ºé–‹å§‹</button>
        <button class="btn" onclick="pauseVoyage()">â¸ï¸ ä¸€æ™‚åœæ­¢</button>
        <button class="btn" onclick="resetVoyage()">ğŸ”„ æœ€åˆã‹ã‚‰</button>
        <button class="btn" onclick="speedUp()">âš¡ é€Ÿåº¦UP</button>
        <button class="btn" onclick="openMiniGame('navigation')">ğŸ§­ èˆªæµ·è¡“è¨“ç·´</button>
    </div>

    <div class="info-panel" id="infoPanel">
        <h3>èˆªæµ·æƒ…å ±</h3>
        <div id="locationInfo">
            <p><strong>ç¾åœ¨åœ°:</strong> <span id="currentLocation">ã‚»ãƒ“ãƒªã‚¢æ¸¯</span></p>
            <p><strong>æ—¥ä»˜:</strong> <span id="infoDate">1519å¹´9æœˆ20æ—¥</span></p>
            <p><strong>èˆªæµ·æ—¥æ•°:</strong> <span id="dayCount">0</span>æ—¥</p>
            <p><strong>æ®‹ã‚Šèˆ¹:</strong> <span id="shipCount">5</span>éš»</p>
        </div>
        <div id="historicalInfo">
            <h4>æ­´å²çš„äº‹å®Ÿ</h4>
            <p id="historicalText">ãƒ•ã‚§ãƒ«ãƒ‡ã‚£ãƒŠãƒ³ãƒ‰ãƒ»ãƒã‚¼ãƒ©ãƒ³ãŒç‡ã„ã‚‹5éš»ã®èˆ¹å›£ãŒã‚¹ãƒšã‚¤ãƒ³ã®ã‚»ãƒ“ãƒªã‚¢ã‚’å‡ºç™ºã€‚ä¸–ç•Œåˆã®ä¸–ç•Œä¸€å‘¨èˆªæµ·ã®å§‹ã¾ã‚Šã§ã™ã€‚</p>
        </div>
        <button class="btn" onclick="closeInfo()">é–‰ã˜ã‚‹</button>
    </div>

    <!-- ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div class="event-popup" id="eventPopup">
        <h3 id="eventTitle">ğŸŒŠ çªç„¶ã®äº‹ä»¶ï¼</h3>
        <p id="eventDescription">ã©ã†ã—ã¾ã™ã‹ï¼Ÿ</p>
        <div id="eventChoices"></div>
    </div>

    <!-- å®Ÿç¸¾ãƒˆãƒ¼ã‚¹ãƒˆ -->
    <div class="achievement-toast" id="achievementToast">
        ğŸ† æ–°ã—ã„å®Ÿç¸¾ã‚’ç²å¾—ã—ã¾ã—ãŸï¼
    </div>

    <!-- ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="mini-game-modal" id="miniGameModal">
        <div class="mini-game-content">
            <h3 id="miniGameTitle">ğŸ§­ èˆªæµ·è¡“è¨“ç·´</h3>
            <div id="miniGameContent">
                <p>æ­£ã—ã„æ–¹è§’ã‚’é¸ã‚“ã§ãã ã•ã„ï¼</p>
                <div style="font-size: 3em; margin: 20px;">ğŸ§­</div>
                <div>
                    <button class="choice-btn" onclick="answerNavigation('north')">â¬†ï¸ åŒ—</button>
                    <button class="choice-btn" onclick="answerNavigation('south')">â¬‡ï¸ å—</button>
                    <button class="choice-btn" onclick="answerNavigation('east')">â¡ï¸ æ±</button>
                    <button class="choice-btn" onclick="answerNavigation('west')">â¬…ï¸ è¥¿</button>
                </div>
            </div>
            <button class="btn" onclick="closeMiniGame()">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let gameStats = {
            score: 0,
            crew: 270,
            food: 100,
            money: 1000,
            achievements: [],
            treasuresFound: 0
        };

        const weatherTypes = ['â˜€ï¸', 'â›…', 'ğŸŒ§ï¸', 'â›ˆï¸', 'ğŸŒªï¸', 'â„ï¸'];
        const randomEvents = [
            {
                title: 'ğŸ´â€â˜ ï¸ æµ·è³Šç™ºè¦‹ï¼',
                description: 'æµ·è³Šèˆ¹ãŒæ¥è¿‘ã—ã¦ã„ã¾ã™ï¼',
                choices: [
                    { text: 'âš”ï¸ æˆ¦ã†', effect: { crew: -10, score: 100, money: 200 } },
                    { text: 'ğŸ’° è²·åã™ã‚‹', effect: { money: -300, score: 50 } },
                    { text: 'ğŸƒ é€ƒã’ã‚‹', effect: { food: -10, score: 20 } }
                ]
            },
            {
                title: 'ğŸŒŠ å¤§åµè¥²æ¥ï¼',
                description: 'æ¿€ã—ã„åµã«å·»ãè¾¼ã¾ã‚Œã¾ã—ãŸï¼',
                choices: [
                    { text: 'âš“ æŠ•éŒ¨ã—ã¦è€ãˆã‚‹', effect: { food: -15, crew: -5, score: 80 } },
                    { text: 'â›µ å¼·è¡Œçªç ´', effect: { crew: -20, score: 150 } }
                ]
            },
            {
                title: 'ğŸ‹ å·¨å¤§ã‚¯ã‚¸ãƒ©ç™ºè¦‹ï¼',
                description: 'å·¨å¤§ãªã‚¯ã‚¸ãƒ©ãŒèˆ¹ã®è¿‘ãã‚’æ³³ã„ã§ã„ã¾ã™ï¼',
                choices: [
                    { text: 'ğŸ“– è¦³å¯Ÿã—ã¦è¨˜éŒ²', effect: { score: 200, achievements: ['æµ·æ´‹å­¦è€…'] } },
                    { text: 'ğŸ£ æ•ç²ã«æŒ‘æˆ¦', effect: { food: 30, crew: -3, score: 100 } }
                ]
            }
        ];

        const achievementsList = [
            { name: 'åˆèˆªæµ·', condition: 'firstSail', description: 'åˆã‚ã¦ã®èˆªæµ·ã‚’é–‹å§‹' },
            { name: 'å®æ¢ã—åäºº', condition: 'treasure5', description: 'å®ç‰©ã‚’5å€‹ç™ºè¦‹' },
            { name: 'å¤ªå¹³æ´‹å¾æœè€…', condition: 'pacific_cross', description: '99æ—¥é–“ã®å¤ªå¹³æ´‹èˆªæµ·ã‚’å®Œäº†' },
            { name: 'åµã®èˆªæµ·å£«', condition: 'storm3', description: 'åµã‚’3å›ä¹—ã‚Šè¶Šãˆã‚‹' },
            { name: 'å¤–äº¤å®˜', condition: 'peaceful5', description: '5å›å¹³å’Œçš„ã«è§£æ±º' },
            { name: 'å‹‡æ•¢ãªèˆ¹é•·', condition: 'fight5', description: '5å›æˆ¦é—˜ã§å‹åˆ©' },
            { name: 'ãƒã‚¼ãƒ©ãƒ³ã®å¾Œç¶™è€…', condition: 'complete', description: 'ä¸–ç•Œä¸€å‘¨ã‚’å®Œæˆ' }
        ];

        const voyageData = [
            { location: "ã‚¹ãƒšã‚¤ãƒ³ãƒ»ã‚»ãƒ“ãƒªã‚¢", date: "1519å¹´9æœˆ20æ—¥", ships: 5, info: "ãƒã‚¼ãƒ©ãƒ³è‰¦éšŠ5éš»ãŒã‚»ãƒ“ãƒªã‚¢æ¸¯ã‹ã‚‰å‡ºç™ºã€‚Trinidadã€San Antonioã€ConcepciÃ³nã€Victoriaã€Santiagoã®5éš»ã€‚", event: 'start' },
            { location: "ã‚«ãƒŠãƒªã‚¢è«¸å³¶", date: "1519å¹´9æœˆ26æ—¥", ships: 5, info: "ã‚«ãƒŠãƒªã‚¢è«¸å³¶ã§è£œçµ¦ã€‚å¤§è¥¿æ´‹æ¨ªæ–­ã®æº–å‚™ã‚’æ•´ãˆã‚‹ã€‚", event: 'supply' },
            { location: "ãƒ–ãƒ©ã‚¸ãƒ«ãƒ»ãƒªã‚ªãƒ‡ã‚¸ãƒ£ãƒã‚¤ãƒ­", date: "1519å¹´12æœˆ13æ—¥", ships: 5, info: "å—ç±³å¤§é™¸åˆ°é”ã€‚ãƒªã‚ªãƒ‡ã‚¸ãƒ£ãƒã‚¤ãƒ­ã§è¶Šå†¬æº–å‚™ã¨èˆ¹ã®ä¿®ç†ã€‚" },
            { location: "ã‚¢ãƒ«ã‚¼ãƒ³ãƒãƒ³ãƒ»ãƒ‘ã‚¿ã‚´ãƒ‹ã‚¢", date: "1520å¹´3æœˆ31æ—¥", ships: 4, info: "ãƒ‘ã‚¿ã‚´ãƒ‹ã‚¢åœ°æ–¹ã§è¶Šå†¬ã€‚Santiagoå·ãŒåº§ç¤ã«ã‚ˆã‚Šå¤±ã‚ã‚Œã‚‹ã€‚ä¹—çµ„å“¡ã®åä¹±ã‚‚ç™ºç”Ÿã€‚" },
            { location: "ãƒã‚¼ãƒ©ãƒ³æµ·å³¡", date: "1520å¹´10æœˆ21æ—¥", ships: 3, info: "å¤ªå¹³æ´‹ã¸ã®é€šè·¯ç™ºè¦‹ï¼San Antonioå·ãŒè„±èµ°ã€‚ãƒã‚¼ãƒ©ãƒ³ã«ã¡ãªã‚“ã§å‘½åã•ã‚ŒãŸæµ·å³¡ã€‚", event: 'discovery' },
            { location: "å¤ªå¹³æ´‹æ¨ªæ–­é–‹å§‹", date: "1520å¹´11æœˆ28æ—¥", ships: 3, info: "æœªçŸ¥ã®å¤§æ´‹ã«çªå…¥ã€‚ã€Œå¤ªå¹³æ´‹ï¼ˆPacific Oceanï¼‰ã€ã¨å‘½åã€‚99æ—¥é–“ã®å›°é›£ãªèˆªæµ·ãŒå§‹ã¾ã‚‹ã€‚", event: 'pacific' },
            { location: "å¤ªå¹³æ´‹æ¨ªæ–­çµ‚äº†", date: "1521å¹´3æœˆ5æ—¥", ships: 3, info: "99æ—¥é–“ã®å¤ªå¹³æ´‹èˆªæµ·ã€‚å£Šè¡€ç—…ã«ã‚ˆã‚Šå¤šãã®ä¹—çµ„å“¡ãŒæ­»äº¡ã€‚ã¤ã„ã«è¥¿å¤ªå¹³æ´‹ã«åˆ°é”ã€‚", event: 'pacific_end' },
            { location: "ã‚°ã‚¢ãƒ å³¶", date: "1521å¹´3æœˆ6æ—¥", ships: 3, info: "99æ—¥é–“ã®å¤ªå¹³æ´‹èˆªæµ·ã®æœ«ã€ã‚ˆã†ã‚„ãé™¸åœ°ç™ºè¦‹ã€‚åŸä½æ°‘ã¨ã®æœ€åˆã®æ¥è§¦ã€‚" },
            { location: "ãƒ•ã‚£ãƒªãƒ”ãƒ³ãƒ»ã‚»ãƒ–å³¶", date: "1521å¹´4æœˆ7æ—¥", ships: 3, info: "ãƒ•ã‚£ãƒªãƒ”ãƒ³è«¸å³¶åˆ°é”ã€‚ãƒã‚¼ãƒ©ãƒ³ãŒã‚­ãƒªã‚¹ãƒˆæ•™å¸ƒæ•™ã‚’é–‹å§‹ã€‚" },
            { location: "ãƒã‚¼ãƒ©ãƒ³æ­»äº¡", date: "1521å¹´4æœˆ27æ—¥", ships: 3, info: "ãƒã‚¯ã‚¿ãƒ³å³¶ã§ãƒã‚¼ãƒ©ãƒ³æˆ¦æ­»ã€‚é…‹é•·ãƒ©ãƒ—ãƒ©ãƒ—ã¨ã®æˆ¦ã„ã§å‘½ã‚’è½ã¨ã™ã€‚" },
            { location: "ãƒ¢ãƒ«ãƒƒã‚«è«¸å³¶", date: "1521å¹´11æœˆ8æ—¥", ships: 2, info: "ã¤ã„ã«é¦™æ–™è«¸å³¶åˆ°é”ï¼ConcepciÃ³nå·ã‚’ç ´æ£„ã€‚é¦™è¾›æ–™ã‚’å¤§é‡ã«ç©è¼‰ã€‚" },
            { location: "ã‚¤ãƒ³ãƒ‰æ´‹æ¨ªæ–­", date: "1522å¹´2æœˆ11æ—¥", ships: 1, info: "Trinidadå·ãŒæ•…éšœã«ã‚ˆã‚Šæ®‹ç•™ã€‚Victoriaå·ã®ã¿ãŒå¸°è·¯ã«ã¤ãã€‚" },
            { location: "å–œæœ›å³°", date: "1522å¹´5æœˆ20æ—¥", ships: 1, info: "ã‚¢ãƒ•ãƒªã‚«æœ€å—ç«¯ã‚’å›èˆªã€‚å¤šãã®ä¹—çµ„å“¡ãŒå£Šè¡€ç—…ã§æ­»äº¡ã€‚" },
            { location: "å¤§è¥¿æ´‹æ¨ªæ–­", date: "1522å¹´7æœˆ9æ—¥", ships: 1, info: "æœ€å¾Œã®å¤§æ´‹æ¨ªæ–­ã€‚é£Ÿç³§ä¸è¶³ã¨ç—…æ°—ã«è‹¦ã—ã¿ãªãŒã‚‰ã‚‚èˆªæµ·ã‚’ç¶šè¡Œã€‚" },
            { location: "ã‚¹ãƒšã‚¤ãƒ³å¸°é‚„", date: "1522å¹´9æœˆ6æ—¥", ships: 1, info: "Victoriaå·ãŒã‚»ãƒ“ãƒªã‚¢æ¸¯ã«å¸°é‚„ï¼18äººã®ç”Ÿå­˜è€…ã¨å…±ã«äººé¡åˆã®ä¸–ç•Œä¸€å‘¨ã‚’å®Œæˆã€‚" }
        ];

        let currentStep = 0;
        let voyageInterval = null;
        let voyageSpeed = 3000;
        let isVoyaging = false;
        let currentWeather = 0;
        let weatherInterval = null;

        const ship = document.getElementById('ship');
        const infoPanel = document.getElementById('infoPanel');
        const routePoints = document.querySelectorAll('.route-point');

        function startVoyage() {
            if (isVoyaging) return;
            isVoyaging = true;
            
            // åˆå›èˆªæµ·ã®å®Ÿç¸¾
            if (currentStep === 0) {
                unlockAchievement('firstSail');
            }
            
            if (voyageInterval) clearInterval(voyageInterval);
            if (weatherInterval) clearInterval(weatherInterval);
            
            voyageInterval = setInterval(() => {
                if (currentStep < voyageData.length - 1) {
                    currentStep++;
                    updateVoyage();
                    
                    // ãƒ©ãƒ³ãƒ€ãƒ ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ
                    if (Math.random() < 0.3) {
                        triggerRandomEvent();
                    }
                } else {
                    completeVoyage();
                }
            }, voyageSpeed);
            
            // å¤©å€™å¤‰åŒ–
            weatherInterval = setInterval(() => {
                changeWeather();
            }, 5000);
            
            playSound('sail');
        }

        function pauseVoyage() {
            isVoyaging = false;
            if (voyageInterval) {
                clearInterval(voyageInterval);
                voyageInterval = null;
            }
        }

        function resetVoyage() {
            pauseVoyage();
            currentStep = 0;
            gameStats = {
                score: 0,
                crew: 270,
                food: 100,
                money: 1000,
                achievements: [],
                treasuresFound: 0
            };
            updateGameStats();
            updateVoyage();
            // å®ç‰©ã‚’å†è¡¨ç¤º
            document.querySelectorAll('.treasure').forEach(t => t.style.display = 'block');
        }

        function speedUp() {
            voyageSpeed = Math.max(1000, voyageSpeed - 1000);
            if (isVoyaging) {
                pauseVoyage();
                startVoyage();
            }
        }

        function updateVoyage() {
            const data = voyageData[currentStep];
            const point = routePoints[currentStep];
            
            // èˆ¹ã®ä½ç½®ã‚’æ›´æ–°
            if (point) {
                // å¤ªå¹³æ´‹æ¨ªæ–­ã®ç‰¹åˆ¥å‡¦ç†
                if (data.location === "å¤ªå¹³æ´‹æ¨ªæ–­é–‹å§‹") {
                    // å·¦ç«¯ã«ç§»å‹•
                    ship.style.top = point.style.top;
                    ship.style.left = point.style.left;
                    ship.style.opacity = '1';
                } else if (data.location === "å¤ªå¹³æ´‹æ¨ªæ–­çµ‚äº†") {
                    // åœ°çƒä¸€å‘¨åŠ¹æœï¼šå·¦ç«¯ã«æ¶ˆãˆã¦å³ç«¯ã‹ã‚‰ç¾ã‚Œã‚‹
                    ship.style.opacity = '0';
                    ship.style.left = '5%';
                    
                    setTimeout(() => {
                        ship.style.transition = 'none';
                        ship.style.left = '95%';
                        ship.style.top = point.style.top;
                        
                        setTimeout(() => {
                            ship.style.transition = 'all 2s ease-in-out';
                            ship.style.opacity = '1';
                            ship.style.left = point.style.left;
                        }, 100);
                    }, 1000);
                } else {
                    ship.style.top = point.style.top;
                    ship.style.left = point.style.left;
                    ship.style.opacity = '1';
                }
                
                // èˆ¹ã®ç§»å‹•ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
                ship.style.animation = 'none';
                setTimeout(() => {
                    ship.style.animation = 'shipBob 2s ease-in-out infinite';
                }, 100);
            }
            
            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒã‚¤ãƒ³ãƒˆã‚’æ›´æ–°
            routePoints.forEach((p, i) => {
                p.classList.remove('active');
                if (i === currentStep) p.classList.add('active');
            });
            
            // é€²è¡ŒçŠ¶æ³ã‚’æ›´æ–°
            const progress = (currentStep / (voyageData.length - 1)) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            // æ—¥ä»˜è¡¨ç¤ºã‚’æ›´æ–°
            document.getElementById('currentDate').textContent = data.date + ' - ' + data.location;
            
            // ã‚¹ã‚³ã‚¢æ›´æ–°
            gameStats.score += 50;
            updateGameStats();
            
            // æƒ…å ±ãƒ‘ãƒãƒ«ã‚’è¡¨ç¤º
            showLocationInfo(data);
            
            // ç‰¹åˆ¥ã‚¤ãƒ™ãƒ³ãƒˆ
            if (data.event) {
                handleSpecialEvent(data.event);
            }
            
            playSound('arrive');
        }

        function showLocationInfo(data) {
            document.getElementById('currentLocation').textContent = data.location;
            document.getElementById('infoDate').textContent = data.date;
            document.getElementById('shipCount').textContent = data.ships;
            document.getElementById('historicalText').textContent = data.info;
            
            // èˆªæµ·æ—¥æ•°è¨ˆç®—
            const startDate = new Date('1519-09-20');
            const currentDate = new Date(data.date.replace('å¹´', '-').replace('æœˆ', '-').replace('æ—¥', ''));
            const dayDiff = Math.floor((currentDate - startDate) / (1000 * 60 * 60 * 24));
            document.getElementById('dayCount').textContent = dayDiff;
            
            infoPanel.classList.add('show');
            
            setTimeout(() => {
                if (!infoPanel.matches(':hover')) {
                    infoPanel.classList.remove('show');
                }
            }, 5000);
        }

        function closeInfo() {
            infoPanel.classList.remove('show');
        }

        function completeVoyage() {
            pauseVoyage();
            gameStats.score += 1000;
            unlockAchievement('complete');
            updateGameStats();
            
            showEventPopup(
                'ğŸ‰ å‰æ¥­é”æˆï¼',
                `ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ä¸–ç•Œåˆã®ä¸–ç•Œä¸€å‘¨ã‚’å®Œæˆã•ã›ã¾ã—ãŸï¼\n\næœ€çµ‚ã‚¹ã‚³ã‚¢: ${gameStats.score}ç‚¹\nç”Ÿå­˜è€…: ${gameStats.crew}äºº\nç™ºè¦‹ã—ãŸå®ç‰©: ${gameStats.treasuresFound}å€‹\nç²å¾—å®Ÿç¸¾: ${gameStats.achievements.length}å€‹`,
                [
                    { text: 'ğŸŠ ç¥ã†', effect: null }
                ]
            );
            
            playSound('victory');
        }

        // æ–°ã—ã„é–¢æ•°ç¾¤
        function updateGameStats() {
            document.getElementById('score').textContent = gameStats.score;
            document.getElementById('crew').textContent = gameStats.crew;
            document.getElementById('food').textContent = Math.max(0, gameStats.food);
            document.getElementById('money').textContent = gameStats.money;
            document.getElementById('achievements').textContent = gameStats.achievements.length;
        }

        function changeWeather() {
            currentWeather = (currentWeather + 1) % weatherTypes.length;
            document.getElementById('weather').textContent = weatherTypes[currentWeather];
            
            // é¢¨ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
            if (currentWeather >= 2) {
                document.getElementById('windEffect').classList.add('active');
                setTimeout(() => {
                    document.getElementById('windEffect').classList.remove('active');
                }, 4000);
            }
        }

        function triggerRandomEvent() {
            const event = randomEvents[Math.floor(Math.random() * randomEvents.length)];
            showEventPopup(event.title, event.description, event.choices);
        }

        function showEventPopup(title, description, choices) {
            const popup = document.getElementById('eventPopup');
            document.getElementById('eventTitle').textContent = title;
            document.getElementById('eventDescription').textContent = description;
            
            const choicesDiv = document.getElementById('eventChoices');
            choicesDiv.innerHTML = '';
            
            choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                btn.textContent = choice.text;
                btn.onclick = () => handleEventChoice(choice.effect);
                choicesDiv.appendChild(btn);
            });
            
            popup.style.display = 'block';
            playSound('event');
        }

        function handleEventChoice(effect) {
            if (effect) {
                Object.keys(effect).forEach(key => {
                    if (key === 'achievements') {
                        effect[key].forEach(achievement => unlockAchievement(achievement));
                    } else {
                        gameStats[key] = Math.max(0, gameStats[key] + effect[key]);
                    }
                });
                updateGameStats();
                showFloatingPoints(effect.score || 0);
            }
            document.getElementById('eventPopup').style.display = 'none';
        }

        function collectTreasure(element, points) {
            element.style.display = 'none';
            gameStats.score += points;
            gameStats.money += points;
            gameStats.treasuresFound++;
            
            showFloatingPoints(points);
            updateGameStats();
            
            if (gameStats.treasuresFound >= 5) {
                unlockAchievement('treasure5');
            }
            
            playSound('treasure');
        }

        function showFloatingPoints(points) {
            const pointsEl = document.createElement('div');
            pointsEl.className = 'floating-points';
            pointsEl.textContent = '+' + points;
            pointsEl.style.left = ship.style.left;
            pointsEl.style.top = ship.style.top;
            document.querySelector('.world-map').appendChild(pointsEl);
            
            setTimeout(() => {
                pointsEl.remove();
            }, 2000);
        }

        function unlockAchievement(achievementKey) {
            if (!gameStats.achievements.includes(achievementKey)) {
                gameStats.achievements.push(achievementKey);
                
                const toast = document.getElementById('achievementToast');
                toast.innerHTML = 'ğŸ† å®Ÿç¸¾è§£é™¤: ' + (achievementsList.find(a => a.condition === achievementKey)?.name || achievementKey);
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
                
                playSound('achievement');
            }
        }

        function handleSpecialEvent(eventType) {
            switch(eventType) {
                case 'start':
                    gameStats.score += 100;
                    break;
                case 'discovery':
                    gameStats.score += 200;
                    unlockAchievement('discovery');
                    break;
                case 'pacific':
                    gameStats.food -= 20;
                    gameStats.crew -= 30;
                    break;
                case 'pacific_end':
                    gameStats.score += 300;
                    showFloatingPoints(300);
                    unlockAchievement('pacific_cross');
                    break;
            }
            updateGameStats();
        }

        function openMiniGame(type) {
            document.getElementById('miniGameModal').style.display = 'flex';
            playSound('menu');
        }

        function closeMiniGame() {
            document.getElementById('miniGameModal').style.display = 'none';
        }

        function answerNavigation(direction) {
            const correct = direction === 'east';
            if (correct) {
                gameStats.score += 100;
                showFloatingPoints(100);
                alert('ğŸ¯ æ­£è§£ï¼æ±ã¸å‘ã‹ã†ã®ãŒæ­£ã—ã„é¸æŠã§ã—ãŸï¼');
            } else {
                alert('âŒ ä¸æ­£è§£ã€‚æ­£ã—ãã¯æ±ã§ã—ãŸã€‚');
            }
            updateGameStats();
            closeMiniGame();
        }

        function playSound(type) {
            // Web Audio APIã‚’ä½¿ç”¨ã—ãŸåŠ¹æœéŸ³ç”Ÿæˆ
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                switch(type) {
                    case 'sail':
                        oscillator.frequency.setValueAtTime(220, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(440, audioContext.currentTime + 0.5);
                        break;
                    case 'treasure':
                        oscillator.frequency.setValueAtTime(523, audioContext.currentTime);
                        oscillator.frequency.setValueAtTime(659, audioContext.currentTime + 0.1);
                        break;
                    case 'achievement':
                        oscillator.frequency.setValueAtTime(523, audioContext.currentTime);
                        oscillator.frequency.setValueAtTime(659, audioContext.currentTime + 0.1);
                        oscillator.frequency.setValueAtTime(784, audioContext.currentTime + 0.2);
                        break;
                }
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch(e) {
                // ã‚µã‚¦ãƒ³ãƒ‰ãŒå†ç”Ÿã§ããªã„å ´åˆã¯ç„¡è¦–
            }
        }

        // èˆªè·¯ãƒã‚¤ãƒ³ãƒˆã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
        routePoints.forEach((point, index) => {
            point.addEventListener('click', () => {
                currentStep = index;
                updateVoyage();
            });
        });

        // CSS animationè¿½åŠ 
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shipBob {
                0%, 100% { transform: translateY(0px) rotate(0deg); }
                50% { transform: translateY(-5px) rotate(2deg); }
            }
        `;
        document.head.appendChild(style);

        // åˆæœŸåŒ–
        updateGameStats();
        updateVoyage();
        changeWeather();

        // è‡ªå‹•çš„ã«æƒ…å ±ãƒ‘ãƒãƒ«ã‚’ä¸€åº¦è¡¨ç¤º
        setTimeout(() => {
            infoPanel.classList.add('show');
            setTimeout(() => {
                infoPanel.classList.remove('show');
            }, 3000);
        }, 2000);
    </script>
</body>
</html>