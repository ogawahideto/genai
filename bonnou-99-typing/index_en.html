<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>99 Worldly Desires Purification Dojo - 99th Meaningless App Special</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background: linear-gradient(135deg, #1a0a2e 0%, #0f0518 50%, #2a1a3a 100%);
            overflow: hidden;
            color: #fff;
        }

        #mainCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        #particleCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none;
        }

        #effectCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3;
            pointer-events: none;
        }

        .ui-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 4;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 40px;
        }

        .header {
            text-align: center;
            animation: glow 3s ease-in-out infinite;
        }

        .title {
            font-size: 42px;
            font-weight: bold;
            text-shadow: 0 0 20px #ff6b9d, 0 0 40px #c44569, 0 0 60px #944e63;
            margin-bottom: 10px;
            letter-spacing: 4px;
        }

        .subtitle {
            font-size: 22px;
            color: #ffd93d;
            text-shadow: 0 0 10px #ffd93d;
            letter-spacing: 3px;
        }

        .special-badge {
            font-size: 32px;
            color: #ff6b9d;
            text-shadow: 0 0 20px #ff6b9d;
            margin-top: 10px;
            animation: pulse 2s ease-in-out infinite;
        }

        .lang-switch {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            pointer-events: auto;
        }

        .lang-switch a {
            display: inline-block;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: #ffd93d;
            text-decoration: none;
            font-size: 16px;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .lang-switch a:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #ffd93d;
            box-shadow: 0 0 20px rgba(255, 217, 61, 0.5);
        }

        .main-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            max-height: 70vh;
            overflow: visible;
        }

        .counter-display {
            font-size: 100px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 30px #6c5ce7, 0 0 60px #a29bfe, 0 0 90px #74b9ff;
            animation: float 3s ease-in-out infinite;
        }

        .bonnou-display {
            background: rgba(0, 0, 0, 0.7);
            padding: 20px 40px;
            border-radius: 20px;
            border: 3px solid #ffd93d;
            box-shadow: 0 0 40px rgba(255, 217, 61, 0.5);
            min-width: 650px;
            text-align: center;
        }

        .bonnou-name {
            font-size: 36px;
            color: #ffd93d;
            margin-bottom: 10px;
            text-shadow: 0 0 20px #ffd93d;
        }

        .bonnou-description {
            font-size: 18px;
            color: #ddd;
            line-height: 1.5;
        }

        .typing-area {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px 30px;
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            min-width: 700px;
            max-width: 700px;
            height: 90px;
            font-size: 48px;
            text-align: left;
            letter-spacing: 8px;
            line-height: 90px;
            box-shadow: 0 0 30px rgba(108, 92, 231, 0.3);
            overflow: hidden;
            white-space: nowrap;
        }

        .progress-container {
            width: 80%;
            max-width: 800px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 24px;
        }

        .progress-bar {
            width: 100%;
            height: 40px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            overflow: hidden;
            border: 2px solid #6c5ce7;
            box-shadow: 0 0 20px rgba(108, 92, 231, 0.5);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b9d, #ffd93d, #6c5ce7, #00b894);
            background-size: 200% 100%;
            animation: shimmer 3s linear infinite;
            transition: width 0.5s ease-out;
            box-shadow: 0 0 20px rgba(255, 107, 157, 0.8);
        }

        .stats {
            display: flex;
            gap: 40px;
            justify-content: center;
        }

        .stat-item {
            text-align: center;
            background: rgba(0, 0, 0, 0.5);
            padding: 20px 40px;
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .stat-label {
            font-size: 16px;
            color: #aaa;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #ffd93d;
            text-shadow: 0 0 10px #ffd93d;
        }

        .zen-quote {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            color: #fff;
            text-align: center;
            text-shadow: 0 0 40px #6c5ce7;
            opacity: 0;
            pointer-events: none;
            z-index: 10;
            max-width: 80%;
            line-height: 1.8;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 20px #ff6b9d, 0 0 40px #c44569; }
            50% { text-shadow: 0 0 40px #ff6b9d, 0 0 80px #c44569, 0 0 120px #ff6b9d; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 200px;
            opacity: 0;
            pointer-events: none;
            z-index: 11;
            animation: celebrate 2s ease-out;
        }

        @keyframes celebrate {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.5); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
        }

        .instruction {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 16px;
            color: rgba(255, 255, 255, 0.6);
            text-align: center;
            z-index: 5;
            animation: blink 2s ease-in-out infinite;
            max-width: 90%;
        }

        @keyframes blink {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .enlightenment-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.95), rgba(255, 215, 0, 0.9));
            z-index: 100;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: enlighten 3s ease-out;
        }

        @keyframes enlighten {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 1; }
        }

        .enlightenment-text {
            font-size: 72px;
            color: #6c5ce7;
            text-shadow: 0 0 50px rgba(108, 92, 231, 0.8);
            margin-bottom: 30px;
            animation: enlightenPulse 2s ease-in-out infinite;
        }

        @keyframes enlightenPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .enlightenment-message {
            font-size: 36px;
            color: #333;
            text-align: center;
            max-width: 800px;
            line-height: 1.8;
        }
    </style>
</head>
<body>
    <canvas id="mainCanvas"></canvas>
    <canvas id="particleCanvas"></canvas>
    <canvas id="effectCanvas"></canvas>

    <div class="lang-switch">
        <a href="index.html">日本語</a>
    </div>

    <div class="ui-container">
        <div class="header">
            <div class="title">99 KLESAS PURIFICATION DOJO</div>
            <div class="subtitle">TYPING MEDITATION</div>
            <div class="special-badge">★ 99th SPECIAL EDITION ★</div>
        </div>

        <div class="main-content">
            <div class="counter-display" id="counter">0</div>

            <div class="bonnou-display">
                <div class="bonnou-name" id="bonnouName">Purifying Klesas...</div>
                <div class="bonnou-description" id="bonnouDesc">Type on keyboard to empty the mind...</div>
            </div>

            <div class="typing-area" id="typingArea">MU</div>

            <div class="progress-container">
                <div class="progress-label">
                    <span>Purification Progress</span>
                    <span id="progressText">0/99</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-label">Total Keystrokes</div>
                <div class="stat-value" id="totalKeys">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Purified Klesas</div>
                <div class="stat-value" id="purifiedCount">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Enlightenment Level</div>
                <div class="stat-value" id="enlightenmentLevel">0</div>
            </div>
        </div>
    </div>

    <div class="zen-quote" id="zenQuote"></div>
    <div class="instruction">Type any key to purify klesas (all keystrokes become "MU" - nothingness)</div>

    <div class="enlightenment-screen" id="enlightenmentScreen">
        <div class="enlightenment-text">✨ Near-Enlightenment ✨</div>
        <div class="enlightenment-message">
            You have purified 99 klesas<br>
            (9 more remain for another time...)<br><br>
            Congratulations!
        </div>
    </div>

    <script>
        // ========================================
        // AI Model: Claude 3.5 Sonnet
        // User Prompt: Create English version of 99 Bonnou typing app using Zen terminology
        // AI Approach: Translation with Western Zen terms (klesa, mu, satori, etc.)
        // Implementation Intent: 99th special edition - English version with language switcher
        // ========================================

        // 99 Klesas (Worldly Desires) Database
        const BONNOU_LIST = [
            { name: "Desire for Validation", desc: "Craving likes on social media" },
            { name: "Snooze Addiction", desc: "Weak mind hitting the alarm" },
            { name: "Smartphone Attachment", desc: "Constant screen gazing" },
            { name: "Procrastination", desc: "Tomorrow never comes" },
            { name: "Overeating", desc: "Just one more bite" },
            { name: "Night Owl Syndrome", desc: "YouTube rabbit hole at 3am" },
            { name: "Impulse Buying", desc: "One-click purchase curse" },
            { name: "Comparison Mind", desc: "Measuring self against others" },
            { name: "Perfectionism", desc: "Only 100% is acceptable" },
            { name: "Anxiety", desc: "Worrying about what hasn't happened" },
            { name: "Sloth", desc: "Skip today, I deserve it" },
            { name: "Envy", desc: "Others' happiness stings" },
            { name: "Vanity", desc: "Need to look good" },
            { name: "Pride", desc: "Cannot admit defeat" },
            { name: "Complaining", desc: "Can't stop whining" },
            { name: "Displaced Anger", desc: "Taking it out on innocents" },
            { name: "Clinging", desc: "Unable to let go" },
            { name: "Regret", desc: "Trapped in the past" },
            { name: "Fear", desc: "Dreading the future" },
            { name: "Impatience", desc: "Rushing unnecessarily" },
            { name: "Anger", desc: "Irritation won't stop" },
            { name: "Resentment", desc: "Unable to forgive" },
            { name: "Revenge", desc: "Must retaliate" },
            { name: "Arrogance", desc: "I am superior" },
            { name: "Ignorance of Ignorance", desc: "Don't know what you don't know" },
            { name: "Dependency", desc: "Can't stand alone" },
            { name: "Escapism", desc: "Avoiding reality" },
            { name: "Fantasy", desc: "Lost in imagination" },
            { name: "Indecision", desc: "Cannot choose" },
            { name: "People-Pleasing", desc: "Need everyone to like me" },
            { name: "Self-Criticism", desc: "Blaming yourself constantly" },
            { name: "Self-Centeredness", desc: "Only thinking of self" },
            { name: "Victim Mentality", desc: "Taking everything personally" },
            { name: "Negative Thinking", desc: "Seeing only the bad" },
            { name: "Overthinking", desc: "Worrying too much" },
            { name: "Stinginess", desc: "Can't spend when needed" },
            { name: "Wastefulness", desc: "Spending too much" },
            { name: "Expectation of Return", desc: "Giving to receive" },
            { name: "Possessiveness", desc: "Must own exclusively" },
            { name: "Control Freak", desc: "Need to control everything" },
            { name: "Fame-Seeking", desc: "Want to be famous" },
            { name: "Power-Hunger", desc: "Desire for authority" },
            { name: "Analysis Paralysis", desc: "Knowing too much, doing nothing" },
            { name: "Forcing Perfection", desc: "Demanding perfection from others" },
            { name: "Righteous Crusading", desc: "Imposing your justice" },
            { name: "Preaching", desc: "Must teach everyone" },
            { name: "One-Upping", desc: "Need to be on top" },
            { name: "Gossip Craving", desc: "Hungry for rumors" },
            { name: "Prying", desc: "Need to know others' business" },
            { name: "Snooping", desc: "Looking at what shouldn't be seen" },
            { name: "Eavesdropping", desc: "Listening to what shouldn't be heard" },
            { name: "Serial Canceling", desc: "Can't keep promises" },
            { name: "Chronic Lateness", desc: "Can't be on time" },
            { name: "Making Excuses", desc: "Justifying everything" },
            { name: "Blame-Shifting", desc: "It's always someone else's fault" },
            { name: "Gaming Escapism", desc: "Playing instead of working" },
            { name: "Binge-Watching", desc: "Just one more episode" },
            { name: "Marathon Reading", desc: "All-nighter to finish series" },
            { name: "Social Media Scrolling", desc: "Endless timeline checking" },
            { name: "Notification Checking", desc: "Phantom notification syndrome" },
            { name: "Read Receipt Anxiety", desc: "Must reply immediately" },
            { name: "Unread Message Guilt", desc: "Bothered by unread messages" },
            { name: "Follower Count Obsession", desc: "Numbers matter too much" },
            { name: "Viral Dreams", desc: "Want to go viral" },
            { name: "Highlight Reel Life", desc: "Showing only the good" },
            { name: "Photo Filtering", desc: "Over-editing yourself" },
            { name: "Selfie Madness", desc: "Taking 100 shots" },
            { name: "Subtweeting", desc: "Can't say it directly" },
            { name: "Alt Account", desc: "Two-faced online persona" },
            { name: "Drama-Watching", desc: "Enjoying others' misfortune" },
            { name: "Infinite Surfing", desc: "3 hours gone unnoticed" },
            { name: "Tab Hoarding", desc: "100 tabs, total chaos" },
            { name: "Bookmark Hoarding", desc: "Will read later = never" },
            { name: "Email 999+ Unread", desc: "Can't organize" },
            { name: "Message Ghosting", desc: "Too lazy to reply" },
            { name: "Cart Abandonment", desc: "Left in shopping cart forever" },
            { name: "Sale Addiction", desc: "Only buy on discount" },
            { name: "Point Obsession", desc: "Spending for points" },
            { name: "Review Paralysis", desc: "Eternal research, no decision" },
            { name: "Price Comparison Hell", desc: "Exhausted finding lowest price" },
            { name: "Free Trial Hopping", desc: "Never actually pay" },
            { name: "Coupon Hunting", desc: "Choose based on coupons" },
            { name: "Free Sample Collecting", desc: "Gathering freebies" },
            { name: "Gacha Fever", desc: "Just one more pull" },
            { name: "Microtransaction Trap", desc: "Money vanishing mysteriously" },
            { name: "Stan Bankruptcy", desc: "Wallet empty for idol" },
            { name: "Game Backlog", desc: "Buying games, never playing" },
            { name: "Book Pile", desc: "Buying books, never reading" },
            { name: "Subscription Neglect", desc: "Paying but not using" },
            { name: "Mindless Streaming", desc: "Netflix with no purpose" },
            { name: "Autoplay Trap", desc: "Next episode starts automatically" },
            { name: "Algorithm Addiction", desc: "AI controls your day" },
            { name: "Infinite Scroll", desc: "Timeline with no end" },
            { name: "Did Nothing Today", desc: "Day ends with emptiness" },
            { name: "Tomorrow For Sure", desc: "Saying same thing tomorrow" },
            { name: "Someday Syndrome", desc: "Someday never arrives" },
            { name: "It'll Work Out", desc: "Optimism without preparation" }
        ];

        // Zen Quotes
        const ZEN_QUOTES = [
            "Empty your mind",
            "Be water, my friend",
            "The obstacle is the path",
            "Let go or be dragged",
            "This too shall pass",
            "MU",
            "SATORI",
            "KENSHO",
            "ZAZEN",
            "The path to liberation",
            "Release attachment",
            "Be here now",
            "All things are impermanent",
            "In stillness, truth reveals",
            "Calm the mind"
        ];

        // Canvas setup
        const mainCanvas = document.getElementById('mainCanvas');
        const particleCanvas = document.getElementById('particleCanvas');
        const effectCanvas = document.getElementById('effectCanvas');

        const mainCtx = mainCanvas.getContext('2d');
        const particleCtx = particleCanvas.getContext('2d');
        const effectCtx = effectCanvas.getContext('2d');

        function resizeCanvases() {
            [mainCanvas, particleCanvas, effectCanvas].forEach(canvas => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
        }
        resizeCanvases();
        window.addEventListener('resize', resizeCanvases);

        // Game state
        let keystrokeCount = 0;
        let totalKeystrokes = 0;
        let purifiedBonnou = 0;
        let currentBonnouIndex = 0;
        let typedText = '';
        const MAX_TYPED_LENGTH = 10;

        // Particles
        class Particle {
            constructor(x, y, type = 'sakura') {
                this.x = x;
                this.y = y;
                this.type = type;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = Math.random() * 2 + 1;
                this.size = Math.random() * 8 + 4;
                this.alpha = 1;
                this.rotation = Math.random() * Math.PI * 2;
                this.rotationSpeed = (Math.random() - 0.5) * 0.1;
                this.life = 1;

                if (type === 'light') {
                    this.color = `hsl(${Math.random() * 60 + 40}, 100%, 70%)`;
                    this.vy = -Math.random() * 3 - 1;
                } else if (type === 'kanji') {
                    this.kanji = ['MU', 'ZEN', 'KU', 'DO'][Math.floor(Math.random() * 4)];
                    this.size = Math.random() * 30 + 20;
                    this.vx = (Math.random() - 0.5) * 4;
                    this.vy = -Math.random() * 4 - 2;
                } else if (type === 'explosion') {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = Math.random() * 10 + 5;
                    this.vx = Math.cos(angle) * speed;
                    this.vy = Math.sin(angle) * speed;
                    this.color = `hsl(${Math.random() * 360}, 100%, 60%)`;
                    this.size = Math.random() * 15 + 5;
                }
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.rotation += this.rotationSpeed;

                if (this.type === 'sakura') {
                    this.vx += Math.sin(Date.now() * 0.001 + this.x * 0.01) * 0.1;
                } else if (this.type === 'light') {
                    this.alpha -= 0.01;
                    this.life -= 0.01;
                } else if (this.type === 'kanji' || this.type === 'explosion') {
                    this.alpha -= 0.02;
                    this.vy += 0.2;
                    this.life -= 0.02;
                }

                return this.y < window.innerHeight + 50 && this.alpha > 0 && this.life > 0;
            }

            draw(ctx) {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);

                if (this.type === 'sakura') {
                    ctx.fillStyle = '#ffb7d5';
                    for (let i = 0; i < 5; i++) {
                        ctx.beginPath();
                        const angle = (i * Math.PI * 2) / 5;
                        ctx.arc(Math.cos(angle) * this.size * 0.3, Math.sin(angle) * this.size * 0.3,
                               this.size * 0.5, 0, Math.PI * 2);
                        ctx.fill();
                    }
                } else if (this.type === 'light') {
                    const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, this.size);
                    gradient.addColorStop(0, this.color);
                    gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(-this.size, -this.size, this.size * 2, this.size * 2);
                } else if (this.type === 'kanji') {
                    ctx.font = `bold ${this.size}px Georgia`;
                    ctx.fillStyle = '#ffd93d';
                    ctx.strokeStyle = '#6c5ce7';
                    ctx.lineWidth = 2;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.strokeText(this.kanji, 0, 0);
                    ctx.fillText(this.kanji, 0, 0);
                } else if (this.type === 'explosion') {
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(0, 0, this.size, 0, Math.PI * 2);
                    ctx.fill();
                }

                ctx.restore();
            }
        }

        let particles = [];

        setInterval(() => {
            for (let i = 0; i < 3; i++) {
                particles.push(new Particle(Math.random() * window.innerWidth, -20, 'sakura'));
            }
        }, 200);

        setInterval(() => {
            particles.push(new Particle(
                Math.random() * window.innerWidth,
                window.innerHeight + 20,
                'light'
            ));
        }, 100);

        // Web Audio API
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let masterGain = audioContext.createGain();
        masterGain.gain.value = 0.3;
        masterGain.connect(audioContext.destination);

        function playBell(frequency = 440) {
            const oscillator = audioContext.createOscillator();
            const gain = audioContext.createGain();

            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);

            gain.gain.setValueAtTime(0.3, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 2);

            oscillator.connect(gain);
            gain.connect(masterGain);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 2);
        }

        function playSpecialSound() {
            [523.25, 659.25, 783.99].forEach((freq, i) => {
                setTimeout(() => playBell(freq), i * 100);
            });
        }

        let ambientInterval;
        function startAmbient() {
            const bpm = 99;
            const interval = (60 / bpm) * 1000;

            ambientInterval = setInterval(() => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();

                osc.type = 'sine';
                osc.frequency.value = 110;
                gain.gain.value = 0.05;

                osc.connect(gain);
                gain.connect(masterGain);

                gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);

                osc.start();
                osc.stop(audioContext.currentTime + 0.1);
            }, interval);
        }

        function updateUI() {
            document.getElementById('counter').textContent = keystrokeCount;
            document.getElementById('totalKeys').textContent = totalKeystrokes;
            document.getElementById('purifiedCount').textContent = purifiedBonnou;
            document.getElementById('enlightenmentLevel').textContent = purifiedBonnou;
            document.getElementById('progressText').textContent = `${purifiedBonnou}/99`;
            document.getElementById('progressFill').style.width = `${(purifiedBonnou / 99) * 100}%`;

            const bonnou = BONNOU_LIST[currentBonnouIndex];
            document.getElementById('bonnouName').textContent = bonnou.name;
            document.getElementById('bonnouDesc').textContent = bonnou.description;
        }

        function showZenQuote() {
            const quote = ZEN_QUOTES[Math.floor(Math.random() * ZEN_QUOTES.length)];
            const element = document.getElementById('zenQuote');
            element.textContent = quote;
            element.style.opacity = '1';
            element.style.animation = 'none';
            setTimeout(() => {
                element.style.animation = 'celebrate 3s ease-out';
            }, 10);

            setTimeout(() => {
                element.style.opacity = '0';
            }, 3000);

            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(quote);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                utterance.pitch = 0.9;
                speechSynthesis.speak(utterance);
            }
        }

        function triggerPurificationEffect() {
            for (let i = 0; i < 99; i++) {
                particles.push(new Particle(
                    window.innerWidth / 2,
                    window.innerHeight / 2,
                    'explosion'
                ));
            }

            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    particles.push(new Particle(
                        Math.random() * window.innerWidth,
                        Math.random() * window.innerHeight,
                        'kanji'
                    ));
                }, i * 50);
            }

            let flashAlpha = 0.8;
            const fadeFlash = setInterval(() => {
                effectCtx.clearRect(0, 0, effectCanvas.width, effectCanvas.height);
                if (flashAlpha > 0) {
                    effectCtx.fillStyle = `rgba(255, 255, 255, ${flashAlpha})`;
                    effectCtx.fillRect(0, 0, effectCanvas.width, effectCanvas.height);
                    flashAlpha -= 0.05;
                } else {
                    effectCtx.clearRect(0, 0, effectCanvas.width, effectCanvas.height);
                    clearInterval(fadeFlash);
                }
            }, 30);

            playSpecialSound();
            showZenQuote();

            const celebration = document.createElement('div');
            celebration.className = 'celebration';
            celebration.textContent = '✨PURIFIED✨';
            document.body.appendChild(celebration);
            setTimeout(() => celebration.remove(), 2000);
        }

        function triggerEnlightenment() {
            document.getElementById('enlightenmentScreen').style.display = 'flex';

            for (let i = 0; i < 200; i++) {
                setTimeout(() => {
                    particles.push(new Particle(
                        Math.random() * window.innerWidth,
                        Math.random() * window.innerHeight,
                        Math.random() > 0.5 ? 'explosion' : 'kanji'
                    ));
                }, i * 20);
            }

            for (let i = 0; i < 9; i++) {
                setTimeout(() => {
                    playSpecialSound();
                }, i * 500);
            }

            if ('speechSynthesis' in window) {
                setTimeout(() => {
                    const utterance = new SpeechSynthesisUtterance('Congratulations. You have reached near-enlightenment.');
                    utterance.lang = 'en-US';
                    utterance.rate = 0.9;
                    speechSynthesis.speak(utterance);
                }, 1000);
            }
        }

        document.addEventListener('keydown', (e) => {
            if (purifiedBonnou >= 99) return;

            if (audioContext.state === 'suspended') {
                audioContext.resume();
                startAmbient();
            }

            keystrokeCount++;
            totalKeystrokes++;

            typedText += 'MU';
            if (typedText.length > MAX_TYPED_LENGTH) {
                typedText = 'MU';
                const typingArea = document.getElementById('typingArea');
                typingArea.style.transform = 'scale(1.2)';
                typingArea.style.transition = 'transform 0.2s';
                setTimeout(() => {
                    typingArea.style.transform = 'scale(1)';
                }, 200);
            }
            document.getElementById('typingArea').textContent = typedText;

            for (let i = 0; i < 3; i++) {
                particles.push(new Particle(
                    Math.random() * window.innerWidth,
                    Math.random() * window.innerHeight,
                    Math.random() > 0.7 ? 'kanji' : 'light'
                ));
            }

            playBell(440 + Math.random() * 220);

            if (keystrokeCount >= 99) {
                keystrokeCount = 0;
                purifiedBonnou++;
                currentBonnouIndex = purifiedBonnou % BONNOU_LIST.length;

                triggerPurificationEffect();

                if (purifiedBonnou >= 99) {
                    setTimeout(() => {
                        triggerEnlightenment();
                    }, 2000);
                }
            }

            updateUI();
        });

        function drawBackground() {
            const gradient = mainCtx.createLinearGradient(0, 0, 0, mainCanvas.height);
            gradient.addColorStop(0, '#1a0a2e');
            gradient.addColorStop(0.5, '#0f0518');
            gradient.addColorStop(1, '#2a1a3a');
            mainCtx.fillStyle = gradient;
            mainCtx.fillRect(0, 0, mainCanvas.width, mainCanvas.height);

            const time = Date.now() * 0.001;
            for (let i = 0; i < 3; i++) {
                const x = mainCanvas.width / 2 + Math.sin(time + i * 2) * 200;
                const y = mainCanvas.height / 2 + Math.cos(time + i * 2) * 150;
                const gradient = mainCtx.createRadialGradient(x, y, 0, x, y, 300);
                gradient.addColorStop(0, `rgba(108, 92, 231, ${0.1 + Math.sin(time) * 0.05})`);
                gradient.addColorStop(1, 'rgba(108, 92, 231, 0)');
                mainCtx.fillStyle = gradient;
                mainCtx.fillRect(0, 0, mainCanvas.width, mainCanvas.height);
            }
        }

        function animate() {
            drawBackground();

            particleCtx.clearRect(0, 0, particleCanvas.width, particleCanvas.height);
            particles = particles.filter(particle => {
                const alive = particle.update();
                if (alive) particle.draw(particleCtx);
                return alive;
            });

            requestAnimationFrame(animate);
        }

        updateUI();
        animate();

        window.addEventListener('load', () => {
            const saved = localStorage.getItem('bonnou99ProgressEN');
            if (saved) {
                const data = JSON.parse(saved);
                totalKeystrokes = data.totalKeystrokes || 0;
                purifiedBonnou = data.purifiedBonnou || 0;
                currentBonnouIndex = purifiedBonnou % BONNOU_LIST.length;
                updateUI();
            }
        });

        setInterval(() => {
            localStorage.setItem('bonnou99ProgressEN', JSON.stringify({
                totalKeystrokes,
                purifiedBonnou
            }));
        }, 5000);

        setInterval(() => {
            if (purifiedBonnou < 99 && totalKeystrokes > 0) {
                showZenQuote();
            }
        }, 99000);
    </script>
</body>
</html>
