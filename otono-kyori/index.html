<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚ªãƒˆãƒã‚­ãƒ§ãƒª</title>
    <style>
        /* --- CSS: ã‚¹ã‚¿ã‚¤ãƒ«ã¨ãƒ‡ã‚¶ã‚¤ãƒ³ --- */
        :root {
            --bg-color: #f0f8ff;
            --main-color: #4682b4;
            --accent-color: #ff6347;
            --text-color: #333;
            --char-color: #3cb371;
            --friend-color: #ffa500;
        }

        body {
            font-family: 'Helvetica Neue', 'Arial', 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', 'Meiryo', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            text-align: center;
        }

        #game-wrapper {
            background-color: #fff;
            padding: 2em;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 500px;
        }

        h1 {
            color: var(--main-color);
            margin-top: 0;
        }

        #character-area {
            position: relative;
            height: 100px;
            margin: 20px 0;
            border: 2px dashed var(--main-color);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding: 0 10%;
        }

        .character {
            font-size: 3em;
            position: absolute;
            transition: left 0.5s ease-in-out;
        }

        #porun {
            color: var(--char-color);
            left: 10%;
        }
        
        #friend {
            color: var(--friend-color);
            left: 80%;
        }
        
        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes jump {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-20px) scale(1.2); }
        }
        @keyframes sad {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-10deg); }
            75% { transform: rotate(10deg); }
        }

        .jump-animation {
            animation: jump 0.5s ease-in-out;
        }
        .sad-animation {
            animation: sad 0.5s ease-in-out;
        }


        #controls, #options-area {
            margin: 20px 0;
        }

        .btn {
            background-color: var(--main-color);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
        }

        .btn:hover:not(:disabled) {
            background-color: #5a9bd3;
            transform: scale(1.05);
        }
        
        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        #options-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .option-btn {
            background-color: var(--char-color);
        }
        
        .option-btn:hover:not(:disabled) {
            background-color: #4ed98a;
        }
        
        #status-area {
            margin-top: 20px;
            font-size: 1.2em;
            font-weight: bold;
            height: 50px;
        }
        
        #message {
            color: var(--accent-color);
        }
        
        #score {
            color: var(--main-color);
        }

    </style>
</head>
<body>

    <div id="game-wrapper">
        <h1>ã‚ªãƒˆãƒã‚­ãƒ§ãƒª</h1>
        <p>ã€Œãƒãƒ­ãƒ³ã®éŸ³ã€ã¨ã€Œä»²é–“ã®éŸ³ã€ã®è·é›¢ã‚’å½“ã¦ã¦ã­ï¼</p>

        <div id="character-area">
            <div id="porun" class="character">ğŸƒ</div>
            <div id="friend" class="character">ğŸ§</div>
        </div>

        <div id="controls">
            <button id="play-btn" class="btn">ã‚²ãƒ¼ãƒ é–‹å§‹ (éŸ³ã‚’ãã)</button>
        </div>

        <div id="options-area">
            </div>

        <div id="status-area">
            <p id="message"></p>
            <p id="score">ã‚¹ã‚³ã‚¢: 0</p>
        </div>
    </div>

    <script>
    // --- JavaScript: ã‚²ãƒ¼ãƒ ã®ãƒ­ã‚¸ãƒƒã‚¯ ---

    // 1. DOMè¦ç´ ã®å–å¾—
    const playBtn = document.getElementById('play-btn');
    const optionsArea = document.getElementById('options-area');
    const messageEl = document.getElementById('message');
    const scoreEl = document.getElementById('score');
    const porunEl = document.getElementById('porun');
    
    // 2. éŸ³å£°é–¢é€£ã®æº–å‚™
    let audioContext;
    
    // Web Audio APIã®åˆæœŸåŒ–ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œãŒå¿…è¦ï¼‰
    function initAudio() {
        if (!audioContext) {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                alert('ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯Web Audio APIã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚');
            }
        }
    }

    // æŒ‡å®šã•ã‚ŒãŸå‘¨æ³¢æ•°ã®éŸ³ã‚’å†ç”Ÿã™ã‚‹é–¢æ•°
    function playTone(frequency, startTime, duration) {
        if (!audioContext) return;
        
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);

        oscillator.type = 'sine'; // ãªã‚ã‚‰ã‹ãªã‚µã‚¤ãƒ³æ³¢
        oscillator.frequency.setValueAtTime(frequency, startTime);
        
        // éŸ³ãŒãƒ–ãƒ„ã£ã¨åˆ‡ã‚Œãªã„ã‚ˆã†ã«éŸ³é‡ã‚’èª¿æ•´
        gainNode.gain.setValueAtTime(0, startTime);
        gainNode.gain.linearRampToValueAtTime(0.5, startTime + 0.05);
        gainNode.gain.linearRampToValueAtTime(0, startTime + duration);

        oscillator.start(startTime);
        oscillator.stop(startTime + duration);
    }

    // 3. ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã®å®šç¾©
    const intervals = [
        { id: 'unison', name: 'ã´ã£ãŸã‚Š', ratio: 1/1 },
        { id: 'majorSecond', name: 'ã™ãã¨ãªã‚Š', ratio: 9/8 },
        { id: 'majorThird', name: 'ã•ã‚“ã½', ratio: 5/4 },
        { id: 'perfectFourth', name: 'ã‚ˆãƒ¼ã„ã—ã‚‡', ratio: 4/3 },
        { id: 'perfectFifth', name: 'å¤§ã‚¸ãƒ£ãƒ³ãƒ—ï¼', ratio: 3/2 },
        { id: 'majorSixth', name: 'ã‚¹ã‚­ãƒƒãƒ—', ratio: 5/3},
        { id: 'octave', name: 'ãŸã‹ãƒ¼ã„ï¼', ratio: 2/1 }
    ];

    let gameState = {
        score: 0,
        currentProblem: null,
        baseFrequency: 220,
        isPlaying: false
    };

    // 4. ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã®é–¢æ•°
    
    // å•é¡Œã‚’ä½œæˆã™ã‚‹é–¢æ•°
    function createProblem() {
        gameState.isPlaying = false;
        messageEl.textContent = 'ã€ŒéŸ³ã‚’ããã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­';
        
        // ãƒ©ãƒ³ãƒ€ãƒ ã«æ­£è§£ã®éŸ³ç¨‹ã‚’é¸ã¶
        const correctInterval = intervals[Math.floor(Math.random() * intervals.length)];
        gameState.currentProblem = correctInterval;
        
        // ãƒ€ãƒŸãƒ¼ã®é¸æŠè‚¢ã‚’ä½œæˆ
        let options = [correctInterval];
        while (options.length < 4) {
            const randomInterval = intervals[Math.floor(Math.random() * intervals.length)];
            // é‡è¤‡ã—ãªã„ã‚ˆã†ã«è¿½åŠ 
            if (!options.find(opt => opt.id === randomInterval.id)) {
                options.push(randomInterval);
            }
        }
        
        // é¸æŠè‚¢ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
        options.sort(() => Math.random() - 0.5);
        
        // é¸æŠè‚¢ãƒœã‚¿ãƒ³ã‚’HTMLã«æç”»
        optionsArea.innerHTML = '';
        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.textContent = opt.name;
            btn.classList.add('btn', 'option-btn');
            btn.dataset.id = opt.id;
            btn.disabled = true; // éŸ³ã‚’è´ãã¾ã§æŠ¼ã›ãªã„
            btn.addEventListener('click', () => checkAnswer(opt.id));
            optionsArea.appendChild(btn);
        });
        
        // åŸºæº–éŸ³ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«è¨­å®š (A3-A4)
        gameState.baseFrequency = 220 + Math.random() * 220;

        playBtn.disabled = false;
        playBtn.textContent = 'éŸ³ã‚’ãã';
    }

    // 2ã¤ã®éŸ³ã‚’å†ç”Ÿã™ã‚‹é–¢æ•°
    function playProblemTones() {
        if (gameState.isPlaying || !audioContext) return;
        gameState.isPlaying = true;
        
        const now = audioContext.currentTime;
        const tone1_freq = gameState.baseFrequency;
        const tone2_freq = gameState.baseFrequency * gameState.currentProblem.ratio;
        
        // 1ã¤ç›®ã®éŸ³ï¼ˆãƒãƒ­ãƒ³ï¼‰
        playTone(tone1_freq, now, 0.4);
        // 2ã¤ç›®ã®éŸ³ï¼ˆä»²é–“ï¼‰
        playTone(tone2_freq, now + 0.6, 0.4);
        
        // éŸ³ã®å†ç”ŸãŒçµ‚ã‚ã£ãŸã‚‰é¸æŠè‚¢ã‚’æœ‰åŠ¹åŒ–
        setTimeout(() => {
            gameState.isPlaying = false;
            messageEl.textContent = 'è·é›¢ã¯ã©ã‚Œã‹ãªï¼Ÿ';
            document.querySelectorAll('.option-btn').forEach(btn => btn.disabled = false);
        }, 1200);
    }
    
    // ç­”ãˆã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹é–¢æ•°
    function checkAnswer(selectedId) {
        document.querySelectorAll('.option-btn').forEach(btn => btn.disabled = true);
        playBtn.disabled = true;

        if (selectedId === gameState.currentProblem.id) {
            // æ­£è§£
            messageEl.textContent = 'æ­£è§£ï¼ã™ã”ã„ï¼';
            gameState.score++;
            porunEl.classList.add('jump-animation');
        } else {
            // ä¸æ­£è§£
            const correctAnswer = intervals.find(i => i.id === gameState.currentProblem.id);
            messageEl.textContent = `ã–ã‚“ã­ã‚“â€¦ æ­£è§£ã¯ã€Œ${correctAnswer.name}ã€ã§ã—ãŸ`;
            porunEl.classList.add('sad-animation');
        }
        scoreEl.textContent = `ã‚¹ã‚³ã‚¢: ${gameState.score}`;

        // 1.5ç§’å¾Œã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦æ¬¡ã®å•é¡Œã¸
        setTimeout(() => {
            porunEl.className = 'character'; // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
            createProblem();
        }, 1500);
    }

    // 5. ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
    playBtn.addEventListener('click', () => {
        initAudio(); // æœ€åˆã®ã‚¯ãƒªãƒƒã‚¯ã§AudioContextã‚’åˆæœŸåŒ–
        
        if(playBtn.textContent.includes('ã‚²ãƒ¼ãƒ é–‹å§‹')) {
            createProblem();
        } else {
            playBtn.disabled = true;
            document.querySelectorAll('.option-btn').forEach(btn => btn.disabled = true);
            messageEl.textContent = 'éŸ³ã‚’ã‚ˆãè´ã„ã¦ã­â€¦';
            playProblemTones();
        }
    });

    </script>
</body>
</html>