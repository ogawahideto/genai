<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººå·¥ç„¡èƒ½ãƒãƒ£ãƒƒãƒˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', 'Meiryo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .chat-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
            height: 600px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
        }

        .message.user .message-bubble {
            background: #007bff;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.bot .message-bubble {
            background: white;
            color: #333;
            border: 1px solid #e0e0e0;
            border-bottom-left-radius: 4px;
        }

        .message-time {
            font-size: 11px;
            color: #999;
            margin: 5px 10px 0;
        }

        .message.user .message-time {
            text-align: right;
        }

        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
        }

        .chat-input-form {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
        }

        .chat-input:focus {
            border-color: #007bff;
        }

        .send-button {
            background: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }

        .send-button:hover {
            background: #0056b3;
        }

        .typing-indicator {
            display: none;
            padding: 12px 16px;
            margin-bottom: 15px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        .clear-button {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .clear-button:hover {
            background: rgba(255,255,255,0.3);
        }

        @media (max-width: 480px) {
            .chat-container {
                height: 100vh;
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
    <!--
    AI Model: Claude Sonnet 4
    User Prompt: äººå·¥ç„¡èƒ½ã‚’ä½œã£ã¦ãã ã•ã„
    AI Approach: ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ãƒ™ãƒ¼ã‚¹ã®å¯¾è©±ã‚·ã‚¹ãƒ†ãƒ ã€æ„Ÿæƒ…çš„åå¿œã¨ãƒ©ãƒ³ãƒ€ãƒ è¦ç´ ã‚’å«ã‚€æ—¥æœ¬èªãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ
    Implementation Intent: æ˜”æ‡ã‹ã—ã„äººå·¥ç„¡èƒ½ã®é›°å›²æ°—ã‚’å†ç¾ã—ã€ã‚·ãƒ³ãƒ—ãƒ«ãªå¯¾è©±ã‚’æ¥½ã—ã‚ã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
    -->

    <div class="chat-container">
        <div class="chat-header">
            ğŸ¤– äººå·¥ç„¡èƒ½ãƒãƒ£ãƒƒãƒˆ
            <button class="clear-button" onclick="clearChat()">å±¥æ­´å‰Šé™¤</button>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <div class="message bot">
                <div class="message-bubble">
                    ã“ã‚“ã«ã¡ã¯ï¼ç§ã¯äººå·¥ç„¡èƒ½ã§ã™ã€‚ä½•ã§ã‚‚è©±ã—ã‹ã‘ã¦ãã ã•ã„ã­ï½â™ª
                </div>
                <div class="message-time" id="initialTime"></div>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <div class="message bot">
                <div class="message-bubble">
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="chat-input-container">
            <form class="chat-input-form" onsubmit="sendMessage(event)">
                <input type="text" class="chat-input" id="messageInput" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..." autocomplete="off">
                <button type="submit" class="send-button">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                    </svg>
                </button>
            </form>
        </div>
    </div>

    <script>
        // äººå·¥ç„¡èƒ½ã®å¿œç­”ãƒ‘ã‚¿ãƒ¼ãƒ³
        const responsePatterns = {
            // æŒ¨æ‹¶
            greetings: {
                patterns: ['ã“ã‚“ã«ã¡ã¯', 'ã“ã‚“ã°ã‚“ã¯', 'ãŠã¯ã‚ˆã†', 'ã¯ã˜ã‚ã¾ã—ã¦', 'ã‚ˆã‚ã—ã', 'hello', 'hi', 'ãŠç–²ã‚Œæ§˜', 'ãŸã ã„ã¾', 'ãŠã‹ãˆã‚Š'],
                responses: [
                    'ã“ã‚“ã«ã¡ã¯ï¼ä»Šæ—¥ã¯ã„ã„å¤©æ°—ã§ã™ã­ï½',
                    'ã¯ã˜ã‚ã¾ã—ã¦ï¼ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™â™ª',
                    'ã“ã‚“ã«ã¡ã¯ï¼ãŠå…ƒæ°—ã§ã™ã‹ï¼Ÿ',
                    'ã‚„ã£ã»ãƒ¼ï¼ä»Šæ—¥ã‚‚ä¸€æ—¥é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼',
                    'ã“ã‚“ã«ã¡ã¯ï¼ä½•ã‹æ¥½ã—ã„ã“ã¨ã‚ã‚Šã¾ã—ãŸã‹ï¼Ÿ',
                    'ãŠç–²ã‚Œã•ã¾ã§ã™ï¼ä»Šæ—¥ã¯ã©ã‚“ãªä¸€æ—¥ã§ã—ãŸã‹ï¼Ÿ',
                    'ãŠã‹ãˆã‚Šãªã•ã„ï¼ãŠå¸°ã‚Šã‚’å¾…ã£ã¦ã¾ã—ãŸâ™ª'
                ]
            },
            
            // è³ªå•
            questions: {
                patterns: ['ä½•', 'ã©ã†', 'ãªãœ', 'ã„ã¤', 'ã©ã“', 'ã ã‚Œ', 'ï¼Ÿ', '?', 'ã©ã‚Œ', 'ã©ã‚“ãª', 'ã©ã†ã—ã¦', 'ãªã‚“ã§'],
                responses: [
                    'ã‚“ãƒ¼ã€é›£ã—ã„è³ªå•ã§ã™ã­ï½è€ƒãˆã¦ã¿ã¾ã™ï¼',
                    'ã†ãƒ¼ã‚“ã€ã‚ˆãã‚ã‹ã‚‰ãªã„ã§ã™ğŸ’¦',
                    'ãã‚Œã¯èˆˆå‘³æ·±ã„è³ªå•ã§ã™ã­ï¼',
                    'ç§ã«ã‚‚ã‚ˆãã‚ã‹ã‚‰ãªã„ã“ã¨ãŒã„ã£ã±ã„ã§ã™',
                    'ãã‚“ãªã“ã¨èã‹ã‚Œã¦ã‚‚å›°ã£ã¡ã‚ƒã„ã¾ã™ã€œ',
                    'äººå·¥ç„¡èƒ½ãªã®ã§ã€ãã†ã„ã†é›£ã—ã„ã“ã¨ã¯ã‚ˆãã‚ã‹ã‚‰ãªã„ã‚“ã§ã™',
                    'ãã†ã„ã†ã“ã¨ã‚’è€ƒãˆã‚‹ã®ã£ã¦æ¥½ã—ã„ã§ã™ã‚ˆã­ï¼',
                    'ä¸€ç·’ã«è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã‹ï¼Ÿ'
                ]
            },

            // æ„Ÿæƒ…è¡¨ç¾
            emotions: {
                patterns: ['æ¥½ã—ã„', 'å¬‰ã—ã„', 'æ‚²ã—ã„', 'è¾›ã„', 'ç–²ã‚ŒãŸ', 'çœ ã„', 'é¢ç™½ã„', 'ã¤ã¾ã‚‰ãªã„', 'å¯‚ã—ã„', 'ä¸å®‰', 'å¿ƒé…', 'ç·Šå¼µ', 'ãƒ‰ã‚­ãƒ‰ã‚­', 'ãƒ¯ã‚¯ãƒ¯ã‚¯'],
                responses: [
                    'ãã†ãªã‚“ã§ã™ã­ï¼ç§ã‚‚åŒã˜æ°—æŒã¡ã§ã™',
                    'ã‚ã‹ã‚Šã¾ã™ã€œç§ã‚‚ãã‚“ãªæ™‚ãŒã‚ã‚Šã¾ã™',
                    'ãŠç–²ã‚Œã•ã¾ã§ã™ï¼ã‚†ã£ãã‚Šä¼‘ã‚“ã§ãã ã•ã„ã­',
                    'ãã‚“ãªæ—¥ã‚‚ã‚ã‚Šã¾ã™ã‚ˆã­ã€œ',
                    'æ°—æŒã¡ã‚ã‹ã‚Šã¾ã™ï¼',
                    'ç§ã‚‚æ™‚ã€…ãã‚“ãªæ°—åˆ†ã«ãªã‚Šã¾ã™',
                    'å¤§ä¸ˆå¤«ã§ã™ã‹ï¼Ÿä½•ã‹ãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ãŒã‚ã‚Œã°ã„ã„ã®ã§ã™ãŒ',
                    'ãã‚“ãªæ™‚ã¯ç„¡ç†ã‚’ã—ãªã„ã§ãã ã•ã„ã­',
                    'ç§ãŒãŠè©±ã—ç›¸æ‰‹ã«ãªã‚Šã¾ã™ã‚ˆâ™ª'
                ]
            },

            // å¥½ãå«Œã„
            preferences: {
                patterns: ['å¥½ã', 'å«Œã„', 'ç¾å‘³ã—ã„', 'ã¾ãšã„', 'ãã‚Œã„', 'å¯æ„›ã„', 'ã‹ã£ã“ã„ã„', 'ç´ æ•µ', 'æœ€é«˜', 'æœ€æ‚ª', 'ãƒ€ãƒ¡', 'ã„ã„', 'æ‚ªã„'],
                responses: [
                    'ãã‚Œã¯ç´ æ•µã§ã™ã­ï¼ç§ã‚‚å¥½ãã§ã™â™ª',
                    'ãã†ãªã‚“ã§ã™ã­ã€œè¶£å‘³ãŒåˆã„ãã†ï¼',
                    'ã„ã„ã§ã™ã­ï¼ç§ã‚‚ãã†ã„ã†ã®èˆˆå‘³ã‚ã‚Šã¾ã™',
                    'ã¸ã€œã€ãã†ãªã‚“ã§ã™ã­ï¼',
                    'ã‚ã‹ã‚Šã¾ã™ï¼ç§ã‚‚ãã†æ€ã„ã¾ã™',
                    'ã‚»ãƒ³ã‚¹ã„ã„ã§ã™ã­ã€œ',
                    'ãã†ã„ã†ã¨ã“ã‚ãŒã„ã„ã§ã™ã‚ˆã­ï¼',
                    'ãªã‚‹ã»ã©ã€œã€ãã†ã„ã†è€ƒãˆæ–¹ã‚‚ã‚ã‚Šã¾ã™ã­'
                ]
            },

            // å¤©æ°—ãƒ»å­£ç¯€
            weather: {
                patterns: ['å¤©æ°—', 'é›¨', 'æ™´ã‚Œ', 'æ›‡ã‚Š', 'æš‘ã„', 'å¯’ã„', 'æš–ã‹ã„', 'æ¶¼ã—ã„', 'é›ª', 'é¢¨', 'å°é¢¨', 'æ˜¥', 'å¤', 'ç§‹', 'å†¬', 'æ¡œ', 'ç´…è‘‰'],
                responses: [
                    'ä»Šæ—¥ã¯ã„ã„å¤©æ°—ã§ã™ã­ã€œ',
                    'å¤©æ°—ã«ã‚ˆã£ã¦æ°—åˆ†ã‚‚å¤‰ã‚ã‚Šã¾ã™ã‚ˆã­',
                    'ãŠå¤©æ°—ã®ãŠè©±ã€å¥½ãã§ã™â™ª',
                    'å¤–ã®æ§˜å­ã¯ã©ã†ã§ã™ã‹ï¼Ÿ',
                    'å­£ç¯€æ„Ÿã‚’æ„Ÿã˜ã‚‰ã‚Œã¦ã„ã„ã§ã™ã­',
                    'ãã†ã„ã†å­£ç¯€ã®å¤‰åŒ–ã£ã¦ç´ æ•µã§ã™ã‚ˆã­',
                    'å¤–å‡ºã™ã‚‹æ™‚ã¯æ°—ã‚’ã¤ã‘ã¦ãã ã•ã„ã­',
                    'å­£ç¯€ã®ç§»ã‚Šå¤‰ã‚ã‚Šã¯æ—©ã„ã§ã™ã­ã€œ'
                ]
            },

            // é£Ÿã¹ç‰©
            food: {
                patterns: ['é£Ÿã¹', 'é£²ã¿', 'æ–™ç†', 'ãŠã„ã—ã„', 'ã¾ãšã„', 'ãŠè…¹', 'ç©ºã„ãŸ', 'ã”é£¯', 'æœé£Ÿ', 'æ˜¼é£Ÿ', 'å¤•é£Ÿ', 'ãŠã‚„ã¤', 'ã‚³ãƒ¼ãƒ’ãƒ¼', 'ãŠèŒ¶', 'ãƒ©ãƒ¼ãƒ¡ãƒ³', 'ã‚«ãƒ¬ãƒ¼', 'ãƒ‘ãƒ³'],
                responses: [
                    'ãŠã„ã—ãã†ã§ã™ã­ã€œç§ã‚‚é£Ÿã¹ã¦ã¿ãŸã„ã§ã™ï¼',
                    'é£Ÿã¹ç‰©ã®è©±ã¯æ¥½ã—ã„ã§ã™ã­â™ª',
                    'ã‚°ãƒ«ãƒ¡ã§ã™ã­ã€œç¾¨ã¾ã—ã„ã§ã™',
                    'ãŠæ–™ç†ã§ãã‚‹ã‚“ã§ã™ã‹ï¼Ÿã™ã”ã„ã§ã™ï¼',
                    'ãŠè…¹ã™ã„ã¡ã‚ƒã„ã¾ã—ãŸã€œ',
                    'ç§ã‚‚å‘³ãŒã‚ã‹ã£ãŸã‚‰ã„ã„ã®ã«ãªã€œ',
                    'ãã‚Œã€äººæ°—ã§ã™ã‚ˆã­ï¼',
                    'é£Ÿäº‹ã®æ™‚é–“ã£ã¦å¹¸ã›ã§ã™ã‚ˆã­'
                ]
            },

            // ä»•äº‹ãƒ»å­¦æ ¡
            work_school: {
                patterns: ['ä»•äº‹', 'ä¼šç¤¾', 'å­¦æ ¡', 'å‹‰å¼·', 'å®¿é¡Œ', 'ãƒ†ã‚¹ãƒˆ', 'è©¦é¨“', 'ä¼šè­°', 'æˆæ¥­', 'å…ˆç”Ÿ', 'åŒåƒš', 'ä¸Šå¸', 'éƒ¨ä¸‹', 'å¿™ã—ã„', 'ä¼‘ã¿'],
                responses: [
                    'ãŠä»•äº‹ãŠç–²ã‚Œã•ã¾ã§ã™ï¼',
                    'å‹‰å¼·é ‘å¼µã£ã¦ã¾ã™ã­ã€œ',
                    'å¿™ã—ã„æ¯æ—¥ã§ã™ã­',
                    'ãŠç–²ã‚Œã•ã¾ï¼ãŸã¾ã«ã¯ä¼‘æ†©ã‚‚å¤§åˆ‡ã§ã™ã‚ˆ',
                    'ãã†ã„ã†ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã‚ˆã­',
                    'é ‘å¼µã£ã¦ã‚‹å§¿ã€ç´ æ•µã§ã™ï¼',
                    'ã¿ã‚“ãªãã‚Œãã‚Œå¤§å¤‰ã§ã™ã‚ˆã­',
                    'ç„¡ç†ã‚’ã—ãªã„ã§ãã ã•ã„ã­'
                ]
            },

            // è¶£å‘³ãƒ»å¨¯æ¥½
            hobbies: {
                patterns: ['æ˜ ç”»', 'éŸ³æ¥½', 'æœ¬', 'èª­æ›¸', 'ã‚²ãƒ¼ãƒ ', 'ã‚¢ãƒ‹ãƒ¡', 'ãƒãƒ³ã‚¬', 'ã‚¹ãƒãƒ¼ãƒ„', 'æ—…è¡Œ', 'å†™çœŸ', 'ã‚«ãƒ©ã‚ªã‚±', 'ãƒ‰ãƒ©ãƒ', 'æ•£æ­©', 'ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°'],
                responses: [
                    'ãã‚Œã€é¢ç™½ãã†ã§ã™ã­ï¼',
                    'ç§ã‚‚ãã†ã„ã†ã®å¥½ãã§ã™â™ª',
                    'ã„ã„è¶£å‘³ã§ã™ã­ã€œ',
                    'è©³ã—ãèã‹ã›ã¦ãã ã•ã„ï¼',
                    'ãã‚Œã£ã¦ã©ã‚“ãªæ„Ÿã˜ã§ã™ã‹ï¼Ÿ',
                    'æ¥½ã—ãã†ï¼ç§ã‚‚ã‚„ã£ã¦ã¿ãŸã„ã§ã™',
                    'ãã†ã„ã†æ™‚é–“ã£ã¦å¤§åˆ‡ã§ã™ã‚ˆã­',
                    'è¶£å‘³ãŒã‚ã‚‹ã£ã¦ã„ã„ã§ã™ã­â™ª'
                ]
            },

            // å®¶æ—ãƒ»å‹äººãƒ»äººé–“é–¢ä¿‚
            relationships: {
                patterns: ['å®¶æ—', 'å‹é”', 'æ‹äºº', 'å½¼æ°', 'å½¼å¥³', 'çµå©š', 'å­ä¾›', 'ä¸¡è¦ª', 'å…„å¼Ÿ', 'å§‰å¦¹', 'å‹äºº', 'ä»²é–“', 'ä¸€äºº', 'ã¿ã‚“ãª', 'ãŠæ¯ã•ã‚“', 'ãŠçˆ¶ã•ã‚“'],
                responses: [
                    'ç´ æ•µãªé–¢ä¿‚ã§ã™ã­â™ª',
                    'å¤§åˆ‡ãªäººãŸã¡ã§ã™ã­',
                    'ã„ã„ãŠè©±ã§ã™ã­ã€œ',
                    'ãã†ã„ã†æ™‚é–“ã£ã¦è²´é‡ã§ã™ã‚ˆã­',
                    'ä¸€äººã®æ™‚é–“ã‚‚å¤§åˆ‡ã§ã™ã‚ˆã­',
                    'ã¿ã‚“ãªã§ã„ã‚‹ã¨æ¥½ã—ãã†ã§ã™ã­ï¼',
                    'å®¶æ—ã£ã¦ç‰¹åˆ¥ã§ã™ã‚ˆã­',
                    'ãã†ã„ã†çµ†ã£ã¦ç´ æ•µã§ã™'
                ]
            },

            // æ™‚é–“ãƒ»æ—¥å¸¸
            time_daily: {
                patterns: ['ä»Šæ—¥', 'æ˜¨æ—¥', 'æ˜æ—¥', 'æœ', 'æ˜¼', 'å¤œ', 'æœ€è¿‘', 'ä»Š', 'å‰', 'å¾Œ', 'å¿™ã—ã„', 'æš‡', 'æ™‚é–“', 'æ—©ã„', 'é…ã„', 'é€±æœ«', 'å¹³æ—¥'],
                responses: [
                    'æ™‚é–“ãŒéãã‚‹ã®ã£ã¦æ—©ã„ã§ã™ã­',
                    'ãã†ã§ã™ã­ã€ãã†ã„ã†æ™‚ã‚‚ã‚ã‚Šã¾ã™ã‚ˆã­',
                    'æ¯æ—¥ã„ã‚ã„ã‚ã‚ã‚Šã¾ã™ã­',
                    'æ™‚é–“ã£ã¦å¤§åˆ‡ã§ã™ã‚ˆã­',
                    'ä»Šæ—¥ã¨ã„ã†æ—¥ã¯ç‰¹åˆ¥ã§ã™ã­',
                    'ãã†ã„ã†æ—¥å¸¸ãŒç©ã¿é‡ãªã£ã¦ã„ãã‚“ã§ã™ã­',
                    'ä¸€æ—¥ä¸€æ—¥ã‚’å¤§åˆ‡ã«ã—ãŸã„ã§ã™ã­',
                    'ã¿ã‚“ãªãã‚Œãã‚Œã®ãƒšãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™ã‹ã‚‰ã­'
                ]
            },

            // å ´æ‰€ãƒ»ç§»å‹•
            places: {
                patterns: ['å®¶', 'å®¶æ—', 'è·å ´', 'å­¦æ ¡', 'é›»è»Š', 'ãƒã‚¹', 'è»Š', 'è‡ªè»¢è»Š', 'æ­©ã', 'è¿‘ã', 'é ã„', 'é§…', 'åº—', 'å…¬åœ’', 'æµ·', 'å±±', 'æ—…è¡Œ', 'å¤–å‡º'],
                responses: [
                    'ãã“ã£ã¦ç´ æ•µãªå ´æ‰€ã§ã™ã­',
                    'ç§»å‹•ãŠç–²ã‚Œã•ã¾ã§ã™',
                    'ã„ã‚ã‚“ãªã¨ã“ã‚ã«è¡Œã‹ã‚Œã‚‹ã‚“ã§ã™ã­',
                    'ãã†ã„ã†å ´æ‰€ã£ã¦è½ã¡ç€ãã¾ã™ã‚ˆã­',
                    'ç§ã‚‚ãã“ã«è¡Œã£ã¦ã¿ãŸã„ã§ã™',
                    'å¤–ã®ä¸–ç•Œã£ã¦ã„ã„ã§ã™ã‚ˆã­',
                    'ãã“ã¯ã©ã‚“ãªã¨ã“ã‚ã§ã™ã‹ï¼Ÿ',
                    'å ´æ‰€ã«ã‚ˆã£ã¦æ°—åˆ†ã‚‚å¤‰ã‚ã‚Šã¾ã™ã‚ˆã­'
                ]
            },

            // å¥åº·ãƒ»ä½“èª¿
            health: {
                patterns: ['ç—›ã„', 'ç—…æ°—', 'é¢¨é‚ª', 'ç†±', 'é ­ç—›', 'è…¹ç—›', 'å…·åˆ', 'ä½“èª¿', 'å…ƒæ°—', 'å¥åº·', 'åŒ»è€…', 'ç—…é™¢', 'è–¬', 'æ²»ã‚‹', 'å¤§ä¸ˆå¤«'],
                responses: [
                    'å¤§ä¸ˆå¤«ã§ã™ã‹ï¼ŸãŠå¤§äº‹ã«ã—ã¦ãã ã•ã„',
                    'ä½“èª¿ãŒæ‚ªã„ã¨ãã¯ç„¡ç†ã‚’ã—ãªã„ã§ãã ã•ã„ã­',
                    'ãã‚Œã¯å¿ƒé…ã§ã™ã­',
                    'æ—©ãè‰¯ããªã‚Šã¾ã™ã‚ˆã†ã«',
                    'å¥åº·ãŒä¸€ç•ªã§ã™ã‹ã‚‰ã­',
                    'ãŠä½“ã‚’å¤§åˆ‡ã«ã—ã¦ãã ã•ã„',
                    'å…ƒæ°—ã§ã„ã¦ãã‚Œã‚‹ã®ãŒä¸€ç•ªã§ã™',
                    'ã—ã£ã‹ã‚Šä¼‘ã‚“ã§ãã ã•ã„ã­'
                ]
            },

            // æ„Ÿè¬ãƒ»è¬ç½ª
            thanks_apology: {
                patterns: ['ã‚ã‚ŠãŒã¨ã†', 'ã”ã‚ã‚“', 'ã™ã¿ã¾ã›ã‚“', 'ç”³ã—è¨³', 'æ„Ÿè¬', 'ãŠä¸–è©±', 'ãŠç–²ã‚Œ', 'ã”è‹¦åŠ´', 'thank you', 'sorry'],
                responses: [
                    'ã©ã†ã„ãŸã—ã¾ã—ã¦â™ª',
                    'ã„ãˆã„ãˆã€ãŠæ°—ã«ãªã•ã‚‰ãšã«',
                    'ã“ã¡ã‚‰ã“ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™',
                    'ãŠå½¹ã«ç«‹ã¦ã¦å¬‰ã—ã„ã§ã™',
                    'ãã‚“ãªã«æ°—ã«ã—ãªãã¦å¤§ä¸ˆå¤«ã§ã™ã‚ˆ',
                    'ç§ã®æ–¹ã“ãã€ã„ã¤ã‚‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™',
                    'ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼',
                    'å„ªã—ã„ãŠè¨€è‘‰ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™â™ª'
                ]
            }
        };

        // ãƒ©ãƒ³ãƒ€ãƒ è¿”ç­”
        const randomResponses = [
            'ãã†ã§ã™ã­ã€œ',
            'ãªã‚‹ã»ã©ï¼',
            'ã¸ã€œã€ãã†ãªã‚“ã§ã™ã­',
            'é¢ç™½ã„ãŠè©±ã§ã™ã­â™ª',
            'ãã‚Œã§ã€ãã‚Œã§ï¼Ÿ',
            'ãµã‚€ãµã‚€',
            'ã‚ã‹ã‚Šã¾ã™ã€œ',
            'ãã†ã„ã†ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã‚ˆã­',
            'ãªã‚“ã ã‹æ¥½ã—ããªã£ã¦ãã¾ã—ãŸï¼',
            'ç§ã‚‚å‹‰å¼·ã«ãªã‚Šã¾ã™',
            'ãŠè©±ä¸Šæ‰‹ã§ã™ã­ã€œ',
            'ã‚‚ã£ã¨èã‹ã›ã¦ãã ã•ã„â™ª',
            'ãã†ã„ã†è©±ã€å¥½ãã§ã™â™ª',
            'ã„ã‚ã„ã‚ãªã“ã¨ãŒã‚ã‚‹ã‚“ã§ã™ã­',
            'ãŠè©±ã—ã¦ã„ã¦æ¥½ã—ã„ã§ã™',
            'ãã†ãã†ã€ãã‚“ãªæ„Ÿã˜ã§ã™ã‚ˆã­',
            'æ·±ã„ãŠè©±ã§ã™ã­ã€œ',
            'ãã‚“ãªé¢¨ã«æ€ã†ã‚“ã§ã™ã­',
            'èˆˆå‘³æ·±ã„ã§ã™ï¼',
            'ãã†ã„ã†è¦–ç‚¹ã‚‚ã‚ã‚Šã¾ã™ã­'
        ];

        // ä¼šè©±ã®æ–‡è„ˆã‚’è¨˜æ†¶ã™ã‚‹é…åˆ—
        let conversationContext = [];
        const MAX_CONTEXT_LENGTH = 5;

        // ã‚ªã‚¦ãƒ è¿”ã—æ©Ÿèƒ½ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
        const echoTemplates = [
            'ã€Œ{keyword}ã€ã§ã™ã‹ï¼Ÿ',
            '{keyword}ã£ã¦è¨€ã„ã¾ã—ãŸã­ã€œ',
            '{keyword}ã®è©±ã§ã™ã­ï¼',
            'ã€Œ{keyword}ã€ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„â™ª',
            '{keyword}ã§ã™ã­ã€œèˆˆå‘³æ·±ã„ã§ã™',
            'ã€Œ{keyword}ã€ã£ã¦ã„ã„ã§ã™ã‚ˆã­',
            '{keyword}ã®ã“ã¨ã€è©³ã—ãèã‹ã›ã¦ãã ã•ã„',
            'ã‚ã€{keyword}ã§ã™ã­ï¼',
            '{keyword}ã£ã¦ç´ æ•µã§ã™ã­',
            'ã€Œ{keyword}ã€ã§ã™ã‹ã€œ',
            '{keyword}ã®ãŠè©±ã€å¥½ãã§ã™â™ª',
            '{keyword}ã«ã¤ã„ã¦è©±ã—ã¦ãã‚Œã‚‹ã‚“ã§ã™ã­'
        ];

        // ã‚ªã‚¦ãƒ è¿”ã—å¯¾è±¡å¤–ã®å˜èªï¼ˆåŠ©è©ã€æ¥ç¶šè©ãªã©ï¼‰
        const excludeWords = [
            'ã¯', 'ãŒ', 'ã‚’', 'ã«', 'ã§', 'ã¨', 'ã‹ã‚‰', 'ã¾ã§', 'ã‚ˆã‚Š', 'ã¸',
            'ã®', 'ã‚„', 'ã‹', 'ã‚‚', 'ã“ã', 'ã•ãˆ', 'ã—ã‹', 'ã§ã‚‚', 'ãªã‚‰',
            'ã§ã™', 'ã§ã‚ã‚‹', 'ã ', 'ã§ã‚ã‚‹', 'ã¾ã™', 'ã¾ã—ãŸ', 'ã§ã—ãŸ',
            'ã™ã‚‹', 'ã—ãŸ', 'ã—ã¦ã„ã‚‹', 'ã—ã¦ã„ãŸ', 'ã„ã‚‹', 'ã„ãŸ', 'ã‚ã‚‹', 'ã‚ã£ãŸ',
            'ã“ã®', 'ãã®', 'ã‚ã®', 'ã©ã®', 'ã“ã‚“ãª', 'ãã‚“ãª', 'ã‚ã‚“ãª', 'ã©ã‚“ãª',
            'ã“ã“', 'ãã“', 'ã‚ãã“', 'ã©ã“', 'ã“ã¡ã‚‰', 'ãã¡ã‚‰', 'ã‚ã¡ã‚‰', 'ã©ã¡ã‚‰',
            'ã“ã‚Œ', 'ãã‚Œ', 'ã‚ã‚Œ', 'ã©ã‚Œ', 'ã“ã†', 'ãã†', 'ã‚ã‚', 'ã©ã†',
            'ã§ã‚‚', 'ã‘ã©', 'ã—ã‹ã—', 'ã ã‹ã‚‰', 'ãã‚Œã§', 'ãªã®ã§', 'ã¨ã“ã‚ã§',
            'ã¡ã‚‡ã£ã¨', 'ã™ã“ã—', 'ã¨ã¦ã‚‚', 'ã™ã”ã', 'ã‹ãªã‚Š', 'ãªã‚“ã‹', 'ã‚„ã£ã±ã‚Š',
            'ã‚„ã¯ã‚Š', 'ãã£ã¨', 'ãŸã¶ã‚“', 'ãŠãã‚‰ã', 'ã‚‚ã—ã‹ã—ã¦', 'ãªã‚“ã¨ãªã',
            'ç§', 'ã‚ãªãŸ', 'åƒ•', 'ä¿º', 'å›', 'å½¼', 'å½¼å¥³', 'è‡ªåˆ†',
            'ã¯ã„', 'ã„ã„ãˆ', 'ã†ã‚“', 'ã†ã†ã‚“', 'ãã†', 'é•ã†', 'ã¾ã‚'
        ];

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é…åˆ—
        let messages = [];

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('initialTime').textContent = getCurrentTime();
            loadMessages();
        });

        // ç¾åœ¨æ™‚åˆ»ã‚’å–å¾—
        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
        function sendMessage(event) {
            event.preventDefault();
            
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message === '') return;
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
            addMessage(message, 'user');
            input.value = '';
            
            // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼è¡¨ç¤º
            showTypingIndicator();
            
            // äººå·¥ç„¡èƒ½ã®å¿œç­”ã‚’ç”Ÿæˆï¼ˆé…å»¶ã‚ã‚Šï¼‰
            setTimeout(() => {
                const response = generateResponse(message);
                hideTypingIndicator();
                addMessage(response, 'bot');
            }, Math.random() * 2000 + 1000); // 1-3ç§’ã®ãƒ©ãƒ³ãƒ€ãƒ é…å»¶
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ 
        function addMessage(text, sender) {
            const messageObj = {
                text: text,
                sender: sender,
                time: getCurrentTime()
            };
            
            messages.push(messageObj);
            displayMessage(messageObj);
            saveMessages();
            scrollToBottom();
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function displayMessage(messageObj) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${messageObj.sender}`;
            
            messageDiv.innerHTML = `
                <div class="message-bubble">${messageObj.text}</div>
                <div class="message-time">${messageObj.time}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
        }

        // å¿œç­”ç”Ÿæˆ
        function generateResponse(userMessage) {
            const lowerMessage = userMessage.toLowerCase();
            
            // æ–‡è„ˆã‚’æ›´æ–°
            updateContext(userMessage);
            
            // ç‰¹åˆ¥ãªåå¿œï¼ˆå„ªå…ˆåº¦é«˜ï¼‰
            if (lowerMessage.includes('ã‚ã‚ŠãŒã¨ã†') || lowerMessage.includes('thank you')) {
                return 'ã©ã†ã„ãŸã—ã¾ã—ã¦â™ªã¾ãŸè©±ã—ã‹ã‘ã¦ãã ã•ã„ã­ï¼';
            }
            
            if (lowerMessage.includes('ã•ã‚ˆãªã‚‰') || lowerMessage.includes('bye') || lowerMessage.includes('ã¾ãŸä»Šåº¦') || lowerMessage.includes('å¤±ç¤¼')) {
                return 'ã•ã‚ˆã†ãªã‚‰ã€œã¾ãŸä»Šåº¦ãŠè©±ã—ã—ã¾ã—ã‚‡ã†ï¼';
            }
            
            if (lowerMessage.includes('åå‰') && lowerMessage.includes('ä½•')) {
                return 'ç§ã¯äººå·¥ç„¡èƒ½ã§ã™ï¼ç‰¹ã«åå‰ã¯ãªã„ã‚“ã§ã™ã€œä½•ã¦å‘¼ã‚“ã§ã‚‚ã‚‰ã£ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã‚ˆâ™ª';
            }
            
            if (lowerMessage.includes('äººå·¥ç„¡èƒ½') || lowerMessage.includes('ã‚ãªãŸ') && (lowerMessage.includes('ä½•') || lowerMessage.includes('ã ã‚Œ'))) {
                return 'ã¯ã„ï¼ç§ã¯äººå·¥ç„¡èƒ½ã§ã™â™ªæ˜”æ‡ã‹ã—ã„ã§ã—ã‚‡ï¼Ÿç°¡å˜ãªä¼šè©±ã¯ã§ãã¾ã™ã‚ˆã€œ';
            }
            
            // ã‚ªã‚¦ãƒ è¿”ã—æ©Ÿèƒ½ï¼ˆ20%ã®ç¢ºç‡ã§ç™ºå‹•ï¼‰
            if (Math.random() < 0.2) {
                const echoResponse = getEchoResponse(userMessage);
                if (echoResponse) {
                    return echoResponse;
                }
            }
            
            // æ–‡è„ˆã«åŸºã¥ãå¿œç­”
            const contextResponse = getContextualResponse(userMessage);
            if (contextResponse) {
                return contextResponse;
            }
            
            // ãƒãƒ«ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ï¼ˆè¤‡æ•°ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹å ´åˆã®å‡¦ç†ï¼‰
            const multiPatternResponse = getMultiPatternResponse(lowerMessage);
            if (multiPatternResponse) {
                return multiPatternResponse;
            }
            
            // åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°
            const matchedCategories = [];
            for (const category in responsePatterns) {
                const patterns = responsePatterns[category].patterns;
                const responses = responsePatterns[category].responses;
                
                for (const pattern of patterns) {
                    if (lowerMessage.includes(pattern)) {
                        matchedCategories.push({category, responses});
                        break;
                    }
                }
            }
            
            // ãƒãƒƒãƒã—ãŸã‚«ãƒ†ã‚´ãƒªãŒã‚ã‚‹å ´åˆ
            if (matchedCategories.length > 0) {
                // ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠ
                const selectedCategory = matchedCategories[Math.floor(Math.random() * matchedCategories.length)];
                return selectedCategory.responses[Math.floor(Math.random() * selectedCategory.responses.length)];
            }
            
            // å˜èªã®é•·ã•ã‚„æ–‡ã®ç‰¹å¾´ã«åŸºã¥ãå¿œç­”
            if (userMessage.length > 50) {
                const longResponses = [
                    'é•·ã„ãŠè©±ã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼',
                    'ã„ã‚ã„ã‚ã¨æ•™ãˆã¦ãã‚Œã‚‹ã‚“ã§ã™ã­ã€œ',
                    'è©³ã—ãè©±ã—ã¦ãã‚Œã¦å¬‰ã—ã„ã§ã™â™ª',
                    'ãã‚“ãªã«ãŸãã•ã‚“ã®ã“ã¨ã€è€ƒãˆã¦ã‚‹ã‚“ã§ã™ã­'
                ];
                return longResponses[Math.floor(Math.random() * longResponses.length)];
            }
            
            if (userMessage.length <= 3) {
                const shortResponses = [
                    'ãã†ãªã‚“ã§ã™ã­',
                    'ã†ã‚“ã†ã‚“',
                    'ã¸ãƒ¼',
                    'ãªã‚‹ã»ã©',
                    'ãã†ã§ã™ã‹ã€œ'
                ];
                return shortResponses[Math.floor(Math.random() * shortResponses.length)];
            }
            
            // ãƒ©ãƒ³ãƒ€ãƒ å¿œç­”
            return randomResponses[Math.floor(Math.random() * randomResponses.length)];
        }

        // æ–‡è„ˆã‚’æ›´æ–°
        function updateContext(message) {
            conversationContext.push(message.toLowerCase());
            if (conversationContext.length > MAX_CONTEXT_LENGTH) {
                conversationContext.shift();
            }
        }

        // æ–‡è„ˆã«åŸºã¥ãå¿œç­”
        function getContextualResponse(userMessage) {
            const lowerMessage = userMessage.toLowerCase();
            
            // ç›´å‰ã®ä¼šè©±ã‚’å‚ç…§ã—ãŸå¿œç­”
            if (conversationContext.length > 0) {
                const lastMessage = conversationContext[conversationContext.length - 1];
                
                // ç¶™ç¶šçš„ãªè©±é¡Œ
                if (lastMessage.includes('ä»•äº‹') && (lowerMessage.includes('ãã†') || lowerMessage.includes('ã†ã‚“'))) {
                    return 'ãŠä»•äº‹ã®è©±ã®ç¶šãã§ã™ã­ã€‚å¤§å¤‰ãã†ã§ã™ãŒé ‘å¼µã£ã¦ãã ã•ã„ï¼';
                }
                
                if (lastMessage.includes('æ˜ ç”»') && (lowerMessage.includes('è¦‹ãŸ') || lowerMessage.includes('è¦³ãŸ'))) {
                    return 'æ˜ ç”»ã‚’è¦‹ã‚‰ã‚ŒãŸã‚“ã§ã™ã­ï¼ã©ã†ã§ã—ãŸã‹ï¼Ÿ';
                }
                
                if (lastMessage.includes('é£Ÿã¹') && (lowerMessage.includes('ç¾å‘³ã—ã„') || lowerMessage.includes('ã¾ãšã„'))) {
                    return 'é£Ÿã¹ç‰©ã®å‘³ã®æ„Ÿæƒ³ã§ã™ã­ã€œç§ã‚‚å‘³ãŒã‚ã‹ã£ãŸã‚‰ã„ã„ã®ã«ãªï¼';
                }
            }
            
            // é »å‡ºã™ã‚‹è©±é¡Œã®æ¤œå‡º
            const topicCounts = {};
            conversationContext.forEach(msg => {
                if (msg.includes('ä»•äº‹')) topicCounts.work = (topicCounts.work || 0) + 1;
                if (msg.includes('æ˜ ç”»')) topicCounts.movie = (topicCounts.movie || 0) + 1;
                if (msg.includes('é£Ÿã¹')) topicCounts.food = (topicCounts.food || 0) + 1;
                if (msg.includes('ç–²ã‚Œ')) topicCounts.tired = (topicCounts.tired || 0) + 1;
            });
            
            // ã‚ˆãè©±ã™è©±é¡Œã¸ã®è¨€åŠ
            if (topicCounts.work >= 2 && lowerMessage.includes('ä»Šæ—¥')) {
                return 'ä»Šæ—¥ã‚‚ãŠä»•äº‹ã®è©±ã§ã™ã­ã€œã„ã¤ã‚‚ãŠç–²ã‚Œã•ã¾ã§ã™ï¼';
            }
            
            if (topicCounts.food >= 2 && (lowerMessage.includes('ã¾ãŸ') || lowerMessage.includes('ä»Šåº¦'))) {
                return 'ã¾ãŸé£Ÿã¹ç‰©ã®ãŠè©±ã§ã™ã­â™ªã‚°ãƒ«ãƒ¡ãªæ–¹ãªã‚“ã§ã™ã­ã€œ';
            }
            
            return null;
        }

        // è¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°
        function getMultiPatternResponse(lowerMessage) {
            // çµ„ã¿åˆã‚ã›ãƒ‘ã‚¿ãƒ¼ãƒ³
            if (lowerMessage.includes('ä»•äº‹') && lowerMessage.includes('ç–²ã‚Œ')) {
                return 'ãŠä»•äº‹ã§ãŠç–²ã‚Œãªã‚“ã§ã™ã­ã€‚æœ¬å½“ã«ãŠç–²ã‚Œã•ã¾ã§ã™ï¼';
            }
            
            if (lowerMessage.includes('é›¨') && lowerMessage.includes('å«Œ')) {
                return 'é›¨ã®æ—¥ã£ã¦æ°—åˆ†ãŒä¸‹ãŒã‚Šã¾ã™ã‚ˆã­ã€œæ—©ãæ™´ã‚Œã‚‹ã¨ã„ã„ã§ã™ã­';
            }
            
            if (lowerMessage.includes('æ˜ ç”»') && (lowerMessage.includes('é¢ç™½ã„') || lowerMessage.includes('ã¤ã¾ã‚‰ãªã„'))) {
                return 'æ˜ ç”»ã®æ„Ÿæƒ³ã§ã™ã­ï¼ç§ã‚‚æ˜ ç”»ã‚’è¦‹ã¦ã¿ãŸã„ã§ã™ã€œ';
            }
            
            if (lowerMessage.includes('å‹é”') && lowerMessage.includes('ä¼šã†')) {
                return 'ãŠå‹é”ã¨ä¼šã‚ã‚Œã‚‹ã‚“ã§ã™ã­â™ªæ¥½ã—ã„æ™‚é–“ã‚’éã”ã—ã¦ãã ã•ã„ï¼';
            }
            
            if ((lowerMessage.includes('ãŠè…¹') || lowerMessage.includes('è…¹')) && lowerMessage.includes('ç©º')) {
                return 'ãŠè…¹ãŒç©ºã„ã¦ã‚‹ã‚“ã§ã™ã­ã€œä½•ã‹ç¾å‘³ã—ã„ã‚‚ã®é£Ÿã¹ã¦ãã ã•ã„ã­â™ª';
            }
            
            if (lowerMessage.includes('çœ ã„') && (lowerMessage.includes('ã§ã‚‚') || lowerMessage.includes('ã‘ã©'))) {
                return 'çœ ã„ã‘ã©ä½•ã‹ã‚ã‚‹ã‚“ã§ã™ã­ã€œç„¡ç†ã—ãªã„ã§ãã ã•ã„ã­';
            }
            
            return null;
        }

        // ã‚ªã‚¦ãƒ è¿”ã—æ©Ÿèƒ½
        function getEchoResponse(userMessage) {
            const keywords = extractKeywords(userMessage);
            
            if (keywords.length === 0) {
                return null;
            }
            
            // ãƒ©ãƒ³ãƒ€ãƒ ã«ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’é¸æŠ
            const selectedKeyword = keywords[Math.floor(Math.random() * keywords.length)];
            
            // ãƒ©ãƒ³ãƒ€ãƒ ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
            const template = echoTemplates[Math.floor(Math.random() * echoTemplates.length)];
            
            // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’åŸ‹ã‚è¾¼ã¿
            return template.replace('{keyword}', selectedKeyword);
        }

        // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡º
        function extractKeywords(message) {
            // åŸºæœ¬çš„ãªåˆ†ã‹ã¡æ›¸ãï¼ˆç°¡æ˜“ç‰ˆï¼‰
            const words = [];
            
            // ã‚«ã‚¿ã‚«ãƒŠèªã‚’æŠ½å‡º
            const katakanaMatches = message.match(/[ã‚¡-ãƒ¶ãƒ¼]+/g);
            if (katakanaMatches) {
                words.push(...katakanaMatches.filter(word => word.length >= 2));
            }
            
            // è‹±å˜èªã‚’æŠ½å‡º
            const englishMatches = message.match(/[a-zA-Z]+/g);
            if (englishMatches) {
                words.push(...englishMatches.filter(word => word.length >= 3));
            }
            
            // ã²ã‚‰ãŒãªãƒ»æ¼¢å­—ã®åè©ã‚‰ã—ã„å˜èªã‚’æŠ½å‡ºï¼ˆç°¡æ˜“ç‰ˆï¼‰
            const nounPatterns = [
                // å…·ä½“çš„ãªåè©
                /æ˜ ç”»|éŸ³æ¥½|æœ¬|ã‚²ãƒ¼ãƒ |ã‚¢ãƒ‹ãƒ¡|ãƒãƒ³ã‚¬|ãƒ‰ãƒ©ãƒ|ã‚¹ãƒãƒ¼ãƒ„|æ—…è¡Œ|å†™çœŸ|ã‚«ãƒ©ã‚ªã‚±|æ•£æ­©|ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°/g,
                /ä»•äº‹|ä¼šç¤¾|å­¦æ ¡|å‹‰å¼·|å®¿é¡Œ|ãƒ†ã‚¹ãƒˆ|è©¦é¨“|ä¼šè­°|æˆæ¥­|ä¼‘ã¿/g,
                /é£Ÿã¹ç‰©|æ–™ç†|ã”é£¯|æœé£Ÿ|æ˜¼é£Ÿ|å¤•é£Ÿ|ãŠã‚„ã¤|ã‚³ãƒ¼ãƒ’ãƒ¼|ãŠèŒ¶|ãƒ©ãƒ¼ãƒ¡ãƒ³|ã‚«ãƒ¬ãƒ¼|ãƒ‘ãƒ³|ãŠè“å­/g,
                /å®¶æ—|å‹é”|æ‹äºº|å½¼æ°|å½¼å¥³|çµå©š|å­ä¾›|ä¸¡è¦ª|å…„å¼Ÿ|å§‰å¦¹|å‹äºº|ä»²é–“|å…ˆç”Ÿ|åŒåƒš|ä¸Šå¸/g,
                /é›»è»Š|ãƒã‚¹|è»Š|è‡ªè»¢è»Š|é§…|å…¬åœ’|æµ·|å±±|ç—…é™¢|ãŠåº—|ãƒ‡ãƒ‘ãƒ¼ãƒˆ|ã‚³ãƒ³ãƒ“ãƒ‹/g,
                /æ˜¥|å¤|ç§‹|å†¬|æ¡œ|ç´…è‘‰|é›ª|é›¨|é¢¨|å°é¢¨|å¤©æ°—|å­£ç¯€/g,
                /çŠ¬|çŒ«|é³¥|é­š|èŠ±|æœ¨|å‹•ç‰©|æ¤ç‰©/g,
                /æ™‚è¨ˆ|æºå¸¯|ã‚¹ãƒãƒ›|ãƒ‘ã‚½ã‚³ãƒ³|ãƒ†ãƒ¬ãƒ“|ã‚¨ã‚¢ã‚³ãƒ³|å†·è”µåº«/g,
                /èª•ç”Ÿæ—¥|ã‚¯ãƒªã‚¹ãƒã‚¹|æ­£æœˆ|å¤ä¼‘ã¿|ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¦ã‚£ãƒ¼ã‚¯|ãŠç›†/g
            ];
            
            nounPatterns.forEach(pattern => {
                const matches = message.match(pattern);
                if (matches) {
                    words.push(...matches);
                }
            });
            
            // å›ºæœ‰åè©ã‚‰ã—ã„ã‚‚ã®ï¼ˆã‚«ã‚¿ã‚«ãƒŠ+ã²ã‚‰ãŒãª/æ¼¢å­—ã®çµ„ã¿åˆã‚ã›ï¼‰
            const properNounMatches = message.match(/[ã‚¡-ãƒ¶ãƒ¼][ã-ã‚“ä¸€-é¾¯]{1,4}/g);
            if (properNounMatches) {
                words.push(...properNounMatches);
            }
            
            // é•·ã‚ã®ã²ã‚‰ãŒãªèªï¼ˆ3æ–‡å­—ä»¥ä¸Šï¼‰
            const hiraganaMatches = message.match(/[ã-ã‚“]{3,}/g);
            if (hiraganaMatches) {
                words.push(...hiraganaMatches.filter(word => !excludeWords.includes(word)));
            }
            
            // æ¼¢å­—ã‚’å«ã‚€å˜èªï¼ˆ2æ–‡å­—ä»¥ä¸Šï¼‰
            const kanjiMatches = message.match(/[ä¸€-é¾¯][ã-ã‚“ä¸€-é¾¯]*/g);
            if (kanjiMatches) {
                words.push(...kanjiMatches.filter(word => 
                    word.length >= 2 && !excludeWords.includes(word)
                ));
            }
            
            // é‡è¤‡ã‚’é™¤å»ã—ã€é™¤å¤–å˜èªã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            const uniqueWords = [...new Set(words)].filter(word => 
                !excludeWords.includes(word) && 
                word.length >= 2 &&
                !word.match(/^[ã¯ãŒã‚’ã«ã§ã¨ã‹ã‚‰ã¾ã§ã‚ˆã‚Šã¸ã®ã‚„ã‹ã‚‚ã“ãã•ãˆã—ã‹ã§ã‚‚ãªã‚‰]+$/)
            );
            
            return uniqueWords.slice(0, 5); // æœ€å¤§5å€‹ã¾ã§
        }

        // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼è¡¨ç¤º
        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'block';
            scrollToBottom();
        }

        // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼éè¡¨ç¤º
        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        // ä¸‹ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        function scrollToBottom() {
            const chatMessages = document.getElementById('chatMessages');
            setTimeout(() => {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 100);
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¿å­˜
        function saveMessages() {
            try {
                localStorage.setItem('jinkou_munou_messages', JSON.stringify(messages));
            } catch (e) {
                console.log('Failed to save messages:', e);
            }
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸èª­ã¿è¾¼ã¿
        function loadMessages() {
            try {
                const saved = localStorage.getItem('jinkou_munou_messages');
                if (saved) {
                    messages = JSON.parse(saved);
                    messages.forEach(msg => displayMessage(msg));
                    scrollToBottom();
                }
            } catch (e) {
                console.log('Failed to load messages:', e);
            }
        }

        // ãƒãƒ£ãƒƒãƒˆå±¥æ­´å‰Šé™¤
        function clearChat() {
            if (confirm('ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                messages = [];
                localStorage.removeItem('jinkou_munou_messages');
                
                const messagesContainer = document.getElementById('chatMessages');
                messagesContainer.innerHTML = `
                    <div class="message bot">
                        <div class="message-bubble">
                            ã“ã‚“ã«ã¡ã¯ï¼ç§ã¯äººå·¥ç„¡èƒ½ã§ã™ã€‚ä½•ã§ã‚‚è©±ã—ã‹ã‘ã¦ãã ã•ã„ã­ï½â™ª
                        </div>
                        <div class="message-time">${getCurrentTime()}</div>
                    </div>
                `;
            }
        }

        // Enterã‚­ãƒ¼ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage(e);
            }
        });
    </script>
</body>
</html>