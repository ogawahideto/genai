<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>惑星軌道アニメーション - 地球中心相対座標系</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: white;
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }

        #canvas {
            border: 1px solid #333;
            background: radial-gradient(circle at center, #001122, #000000);
            display: block;
            margin: 0 auto;
        }

        .controls {
            text-align: center;
            margin: 10px 0;
        }

        .control-group {
            display: inline-block;
            margin: 0 15px;
        }

        label {
            display: inline-block;
            width: 80px;
            font-size: 12px;
        }

        input[type="range"] {
            width: 100px;
        }

        input[type="number"] {
            width: 60px;
            background: #333;
            color: white;
            border: 1px solid #666;
        }

        button {
            background: #444;
            color: white;
            border: 1px solid #666;
            padding: 5px 10px;
            margin: 0 5px;
            cursor: pointer;
        }

        button:hover {
            background: #555;
        }

        .info {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            padding: 10px;
            font-size: 12px;
            border-radius: 5px;
        }

        .legend {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 10px;
            font-size: 12px;
            border-radius: 5px;
        }

        .planet-color {
            display: inline-block;
            width: 12px;
            height: 12px;
            margin-right: 5px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <!--
    AI Model: Claude 4 Sonnet
    User Prompt: 惑星の軌道を、地球上の一点を中心とした相対座標でアニメーションしてください（座標軸固定）
    AI Approach: 地球中心の相対座標系で惑星軌道を描画、座標軸は固定して惑星が移動
    Implementation Intent: 固定座標軸での地球中心惑星軌道アニメーション表示
    -->

    <div class="legend">
        <h3>惑星軌道 - 地球中心相対座標系</h3>
        <div><span class="planet-color" style="background: #ffff00"></span>太陽</div>
        <div><span class="planet-color" style="background: #ff6b35"></span>水星</div>
        <div><span class="planet-color" style="background: #f7931e"></span>金星</div>
        <div><span class="planet-color" style="background: #1f77b4"></span>地球 (中心)</div>
        <div><span class="planet-color" style="background: #d62728"></span>火星</div>
        <div><span class="planet-color" style="background: #ff7f0e"></span>木星</div>
        <div><span class="planet-color" style="background: #2ca02c"></span>土星</div>
        <div><span class="planet-color" style="background: #17becf"></span>天王星</div>
        <div><span class="planet-color" style="background: #9467bd"></span>海王星</div>
    </div>

    <div class="info">
        <div>時刻: <span id="currentTime">0</span> 日</div>
        <div>地球年: <span id="earthYear">0.00</span></div>
        <div>地球軌道角: <span id="axisRotation">0</span>°</div>
        <div>表示スケール: <span id="scaleValue">1.0</span>AU</div>
    </div>

    <canvas id="canvas" width="800" height="600"></canvas>

    <div class="controls">
        <div class="control-group">
            <label>速度:</label>
            <input type="range" id="speedSlider" min="0.1" max="10" value="1" step="0.1">
            <span id="speedValue">1.0</span>x
        </div>

        <div class="control-group">
            <label>スケール:</label>
            <input type="range" id="scaleSlider" min="0.1" max="3" value="1" step="0.1">
            <span id="scaleDisplay">1.0</span>AU
        </div>

        <div class="control-group">
            <button id="playPauseBtn">一時停止</button>
            <button id="resetBtn">リセット</button>
        </div>

        <div class="control-group">
            <label>軌道表示:</label>
            <input type="checkbox" id="showOrbits" checked>
        </div>

        <div class="control-group">
            <label>座標軸:</label>
            <input type="checkbox" id="showAxes">
        </div>
    </div>

    <script>
        // 天体データ (AU単位、太陽からの軌道半径と公転周期)
        const celestialBodies = {
            sun: {
                name: '太陽',
                radius: 0,
                period: 1, // 基準
                color: '#ffff00',
                size: 6
            },
            mercury: {
                name: '水星',
                radius: 0.387,
                period: 88,
                color: '#ff6b35',
                size: 3
            },
            venus: {
                name: '金星',
                radius: 0.723,
                period: 225,
                color: '#f7931e',
                size: 4
            },
            earth: {
                name: '地球',
                radius: 1.0,
                period: 365,
                color: '#1f77b4',
                size: 4
            },
            mars: {
                name: '火星',
                radius: 1.524,
                period: 687,
                color: '#d62728',
                size: 3
            },
            jupiter: {
                name: '木星',
                radius: 5.203,
                period: 4333,
                color: '#ff7f0e',
                size: 8
            },
            saturn: {
                name: '土星',
                radius: 9.537,
                period: 10759,
                color: '#2ca02c',
                size: 7
            },
            uranus: {
                name: '天王星',
                radius: 19.191,
                period: 30687,
                color: '#17becf',
                size: 5
            },
            neptune: {
                name: '海王星',
                radius: 30.069,
                period: 60190,
                color: '#9467bd',
                size: 5
            }
        };

        // キャンバス設定
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;

        // アニメーション制御
        let time = 0;  // 日数
        let animationSpeed = 1;
        let isPlaying = true;
        let scale = 50;  // AU to pixel scale
        let showOrbits = true;
        let showAxes = false;

        // UI要素
        const speedSlider = document.getElementById('speedSlider');
        const scaleSlider = document.getElementById('scaleSlider');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const showOrbitsCheck = document.getElementById('showOrbits');
        const showAxesCheck = document.getElementById('showAxes');

        // 軌道の軌跡を保存する配列
        const orbitTrails = {};
        Object.keys(celestialBodies).forEach(key => {
            if (key !== 'earth') { // 地球は中心に固定なので軌跡は不要
                orbitTrails[key] = [];
            }
        });

        // 天体位置を計算する関数（太陽中心座標系）
        function getCelestialPosition(body, days) {
            if (body.radius === 0) { // 太陽の場合
                return { x: 0, y: 0 };
            }
            const angle = (days / body.period) * 2 * Math.PI;
            return {
                x: body.radius * Math.cos(angle),
                y: body.radius * Math.sin(angle)
            };
        }

        // 地球中心の相対座標に変換する関数（座標軸固定）
        function getEarthCentricPosition(bodyPos, earthPos) {
            // 地球を原点とした座標（座標軸は固定）
            const relativeX = bodyPos.x - earthPos.x;
            const relativeY = bodyPos.y - earthPos.y;

            return {
                x: relativeX,
                y: relativeY
            };
        }

        // 描画関数
        function draw() {
            // 背景をクリア
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 地球の位置を計算（太陽中心座標系）
            const earthPos = getCelestialPosition(celestialBodies.earth, time);
            const earthAngle = (time / celestialBodies.earth.period) * 2 * Math.PI;

            // 座標軸を描画（固定）
            if (showAxes) {
                drawAxes();
            }

            // 地球を中心に描画
            const earthScreenX = centerX;
            const earthScreenY = centerY;
            ctx.fillStyle = celestialBodies.earth.color;
            ctx.beginPath();
            ctx.arc(earthScreenX, earthScreenY, celestialBodies.earth.size, 0, 2 * Math.PI);
            ctx.fill();
            ctx.fillStyle = 'white';
            ctx.font = '12px monospace';
            ctx.fillText(celestialBodies.earth.name, earthScreenX + 8, earthScreenY - 8);

            // 各天体を処理（地球以外）
            Object.entries(celestialBodies).forEach(([key, body]) => {
                if (key === 'earth') return; // 地球は既に描画済み

                // 太陽中心座標系での位置
                const bodyPos = getCelestialPosition(body, time);
                // 地球中心座標系での位置
                const earthCentricPos = getEarthCentricPosition(bodyPos, earthPos);
                const screenX = centerX + earthCentricPos.x * scale;
                const screenY = centerY + earthCentricPos.y * scale;

                // 軌道の軌跡を記録（画面内の場合のみ）
                if (screenX >= -100 && screenX <= canvas.width + 100 &&
                    screenY >= -100 && screenY <= canvas.height + 100) {
                    orbitTrails[key].push({ x: screenX, y: screenY });

                    // 軌跡の長さを制限
                    if (orbitTrails[key].length > 2000) {
                        orbitTrails[key].shift();
                    }
                }

                // 軌道の軌跡を描画
                if (showOrbits && orbitTrails[key].length > 1) {
                    ctx.strokeStyle = body.color + '60'; // 透明度を調整
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(orbitTrails[key][0].x, orbitTrails[key][0].y);
                    for (let i = 1; i < orbitTrails[key].length; i++) {
                        ctx.lineTo(orbitTrails[key][i].x, orbitTrails[key][i].y);
                    }
                    ctx.stroke();
                }

                // 天体を描画（画面内の場合のみ）
                if (screenX >= -100 && screenX <= canvas.width + 100 &&
                    screenY >= -100 && screenY <= canvas.height + 100) {
                    ctx.fillStyle = body.color;
                    ctx.beginPath();
                    ctx.arc(screenX, screenY, body.size, 0, 2 * Math.PI);
                    ctx.fill();

                    // 天体名を描画
                    ctx.fillStyle = 'white';
                    ctx.font = '12px monospace';
                    ctx.fillText(body.name, screenX + body.size + 3, screenY - 3);
                }
            });

            // 情報を更新
            updateInfo();
        }

        // 座標軸を描画する関数（固定）
        function drawAxes() {
            const axisLength = Math.min(canvas.width, canvas.height) / 3;

            // X軸（赤）- 右方向に固定
            ctx.strokeStyle = '#ff4444';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(centerX + axisLength, centerY);
            ctx.stroke();

            // Y軸（緑）- 上方向に固定
            ctx.strokeStyle = '#44ff44';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(centerX, centerY - axisLength);
            ctx.stroke();

            // 軸のラベル
            ctx.fillStyle = '#ff4444';
            ctx.font = '14px monospace';
            ctx.fillText('X', centerX + axisLength + 10, centerY);

            ctx.fillStyle = '#44ff44';
            ctx.fillText('Y', centerX, centerY - axisLength - 10);
        }

        // 情報更新関数
        function updateInfo() {
            document.getElementById('currentTime').textContent = Math.round(time);
            document.getElementById('earthYear').textContent = (time / 365).toFixed(2);
            document.getElementById('axisRotation').textContent =
                Math.round(((time / 365) * 360) % 360);
            document.getElementById('scaleValue').textContent = (scale / 50).toFixed(1);
        }

        // アニメーションループ
        function animate() {
            if (isPlaying) {
                time += animationSpeed;
            }
            draw();
            requestAnimationFrame(animate);
        }

        // イベントリスナー
        speedSlider.addEventListener('input', (e) => {
            animationSpeed = parseFloat(e.target.value);
            document.getElementById('speedValue').textContent = animationSpeed.toFixed(1);
        });

        scaleSlider.addEventListener('input', (e) => {
            const newScale = parseFloat(e.target.value) * 50;
            scale = newScale;
            document.getElementById('scaleDisplay').textContent = (newScale / 50).toFixed(1);

            // スケール変更時は軌跡をリセット
            Object.keys(orbitTrails).forEach(key => {
                orbitTrails[key] = [];
            });
        });

        playPauseBtn.addEventListener('click', () => {
            isPlaying = !isPlaying;
            playPauseBtn.textContent = isPlaying ? '一時停止' : '再生';
        });

        resetBtn.addEventListener('click', () => {
            time = 0;
            Object.keys(orbitTrails).forEach(key => {
                orbitTrails[key] = [];
            });
        });

        showOrbitsCheck.addEventListener('change', (e) => {
            showOrbits = e.target.checked;
            if (!showOrbits) {
                Object.keys(orbitTrails).forEach(key => {
                    orbitTrails[key] = [];
                });
            }
        });

        showAxesCheck.addEventListener('change', (e) => {
            showAxes = e.target.checked;
        });

        // 初期化
        animate();
    </script>
</body>
</html>